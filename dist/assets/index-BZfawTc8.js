(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ky(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Px(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Gy={exports:{}},cu={},Qy={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tl=Symbol.for("react.element"),Ix=Symbol.for("react.portal"),Rx=Symbol.for("react.fragment"),Dx=Symbol.for("react.strict_mode"),$x=Symbol.for("react.profiler"),Lx=Symbol.for("react.provider"),jx=Symbol.for("react.context"),Fx=Symbol.for("react.forward_ref"),zx=Symbol.for("react.suspense"),Bx=Symbol.for("react.memo"),Ux=Symbol.for("react.lazy"),jp=Symbol.iterator;function Vx(n){return n===null||typeof n!="object"?null:(n=jp&&n[jp]||n["@@iterator"],typeof n=="function"?n:null)}var Xy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Yy=Object.assign,Zy={};function _i(n,e,t){this.props=n,this.context=e,this.refs=Zy,this.updater=t||Xy}_i.prototype.isReactComponent={};_i.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};_i.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function e0(){}e0.prototype=_i.prototype;function Wf(n,e,t){this.props=n,this.context=e,this.refs=Zy,this.updater=t||Xy}var qf=Wf.prototype=new e0;qf.constructor=Wf;Yy(qf,_i.prototype);qf.isPureReactComponent=!0;var Fp=Array.isArray,t0=Object.prototype.hasOwnProperty,Jf={current:null},n0={key:!0,ref:!0,__self:!0,__source:!0};function r0(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)t0.call(e,r)&&!n0.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){for(var a=Array(l),u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:tl,type:n,key:i,ref:o,props:s,_owner:Jf.current}}function Hx(n,e){return{$$typeof:tl,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Kf(n){return typeof n=="object"&&n!==null&&n.$$typeof===tl}function Wx(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var zp=/\/+/g;function Xu(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Wx(""+n.key):e.toString(36)}function Xl(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case tl:case Ix:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Xu(o,0):r,Fp(s)?(t="",n!=null&&(t=n.replace(zp,"$&/")+"/"),Xl(s,e,t,"",function(u){return u})):s!=null&&(Kf(s)&&(s=Hx(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(zp,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Fp(n))for(var l=0;l<n.length;l++){i=n[l];var a=r+Xu(i,l);o+=Xl(i,e,t,a,s)}else if(a=Vx(n),typeof a=="function")for(n=a.call(n),l=0;!(i=n.next()).done;)i=i.value,a=r+Xu(i,l++),o+=Xl(i,e,t,a,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function gl(n,e,t){if(n==null)return n;var r=[],s=0;return Xl(n,r,"","",function(i){return e.call(t,i,s++)}),r}function qx(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var at={current:null},Yl={transition:null},Jx={ReactCurrentDispatcher:at,ReactCurrentBatchConfig:Yl,ReactCurrentOwner:Jf};function s0(){throw Error("act(...) is not supported in production builds of React.")}G.Children={map:gl,forEach:function(n,e,t){gl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return gl(n,function(){e++}),e},toArray:function(n){return gl(n,function(e){return e})||[]},only:function(n){if(!Kf(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};G.Component=_i;G.Fragment=Rx;G.Profiler=$x;G.PureComponent=Wf;G.StrictMode=Dx;G.Suspense=zx;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jx;G.act=s0;G.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Yy({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Jf.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(a in e)t0.call(e,a)&&!n0.hasOwnProperty(a)&&(r[a]=e[a]===void 0&&l!==void 0?l[a]:e[a])}var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){l=Array(a);for(var u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:tl,type:n.type,key:s,ref:i,props:r,_owner:o}};G.createContext=function(n){return n={$$typeof:jx,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Lx,_context:n},n.Consumer=n};G.createElement=r0;G.createFactory=function(n){var e=r0.bind(null,n);return e.type=n,e};G.createRef=function(){return{current:null}};G.forwardRef=function(n){return{$$typeof:Fx,render:n}};G.isValidElement=Kf;G.lazy=function(n){return{$$typeof:Ux,_payload:{_status:-1,_result:n},_init:qx}};G.memo=function(n,e){return{$$typeof:Bx,type:n,compare:e===void 0?null:e}};G.startTransition=function(n){var e=Yl.transition;Yl.transition={};try{n()}finally{Yl.transition=e}};G.unstable_act=s0;G.useCallback=function(n,e){return at.current.useCallback(n,e)};G.useContext=function(n){return at.current.useContext(n)};G.useDebugValue=function(){};G.useDeferredValue=function(n){return at.current.useDeferredValue(n)};G.useEffect=function(n,e){return at.current.useEffect(n,e)};G.useId=function(){return at.current.useId()};G.useImperativeHandle=function(n,e,t){return at.current.useImperativeHandle(n,e,t)};G.useInsertionEffect=function(n,e){return at.current.useInsertionEffect(n,e)};G.useLayoutEffect=function(n,e){return at.current.useLayoutEffect(n,e)};G.useMemo=function(n,e){return at.current.useMemo(n,e)};G.useReducer=function(n,e,t){return at.current.useReducer(n,e,t)};G.useRef=function(n){return at.current.useRef(n)};G.useState=function(n){return at.current.useState(n)};G.useSyncExternalStore=function(n,e,t){return at.current.useSyncExternalStore(n,e,t)};G.useTransition=function(){return at.current.useTransition()};G.version="18.3.1";Qy.exports=G;var z=Qy.exports;const Ne=Ky(z);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kx=z,Gx=Symbol.for("react.element"),Qx=Symbol.for("react.fragment"),Xx=Object.prototype.hasOwnProperty,Yx=Kx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zx={key:!0,ref:!0,__self:!0,__source:!0};function i0(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Xx.call(e,r)&&!Zx.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:Gx,type:n,key:i,ref:o,props:s,_owner:Yx.current}}cu.Fragment=Qx;cu.jsx=i0;cu.jsxs=i0;Gy.exports=cu;var x=Gy.exports,o0={exports:{}},Nt={},l0={exports:{}},a0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(I,V){var q=I.length;I.push(V);e:for(;0<q;){var ce=q-1>>>1,we=I[ce];if(0<s(we,V))I[ce]=V,I[q]=we,q=ce;else break e}}function t(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var V=I[0],q=I.pop();if(q!==V){I[0]=q;e:for(var ce=0,we=I.length,gs=we>>>1;ce<gs;){var bn=2*(ce+1)-1,Ri=I[bn],_n=bn+1,ys=I[_n];if(0>s(Ri,q))_n<we&&0>s(ys,Ri)?(I[ce]=ys,I[_n]=q,ce=_n):(I[ce]=Ri,I[bn]=q,ce=bn);else if(_n<we&&0>s(ys,q))I[ce]=ys,I[_n]=q,ce=_n;else break e}}return V}function s(I,V){var q=I.sortIndex-V.sortIndex;return q!==0?q:I.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var a=[],u=[],c=1,d=null,f=3,h=!1,p=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(I){for(var V=t(u);V!==null;){if(V.callback===null)r(u);else if(V.startTime<=I)r(u),V.sortIndex=V.expirationTime,e(a,V);else break;V=t(u)}}function k(I){if(m=!1,w(I),!p)if(t(a)!==null)p=!0,Ii(S);else{var V=t(u);V!==null&&ms(k,V.startTime-I)}}function S(I,V){p=!1,m&&(m=!1,y(C),C=-1),h=!0;var q=f;try{for(w(V),d=t(a);d!==null&&(!(d.expirationTime>V)||I&&!P());){var ce=d.callback;if(typeof ce=="function"){d.callback=null,f=d.priorityLevel;var we=ce(d.expirationTime<=V);V=n.unstable_now(),typeof we=="function"?d.callback=we:d===t(a)&&r(a),w(V)}else r(a);d=t(a)}if(d!==null)var gs=!0;else{var bn=t(u);bn!==null&&ms(k,bn.startTime-V),gs=!1}return gs}finally{d=null,f=q,h=!1}}var b=!1,_=null,C=-1,T=5,A=-1;function P(){return!(n.unstable_now()-A<T)}function ye(){if(_!==null){var I=n.unstable_now();A=I;var V=!0;try{V=_(!0,I)}finally{V?Le():(b=!1,_=null)}}else b=!1}var Le;if(typeof g=="function")Le=function(){g(ye)};else if(typeof MessageChannel<"u"){var hs=new MessageChannel,ps=hs.port2;hs.port1.onmessage=ye,Le=function(){ps.postMessage(null)}}else Le=function(){v(ye,0)};function Ii(I){_=I,b||(b=!0,Le())}function ms(I,V){C=v(function(){I(n.unstable_now())},V)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(I){I.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,Ii(S))},n.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<I?Math.floor(1e3/I):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(a)},n.unstable_next=function(I){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var q=f;f=V;try{return I()}finally{f=q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(I,V){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var q=f;f=I;try{return V()}finally{f=q}},n.unstable_scheduleCallback=function(I,V,q){var ce=n.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ce+q:ce):q=ce,I){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=q+we,I={id:c++,callback:V,priorityLevel:I,startTime:q,expirationTime:we,sortIndex:-1},q>ce?(I.sortIndex=q,e(u,I),t(a)===null&&I===t(u)&&(m?(y(C),C=-1):m=!0,ms(k,q-ce))):(I.sortIndex=we,e(a,I),p||h||(p=!0,Ii(S))),I},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(I){var V=f;return function(){var q=f;f=V;try{return I.apply(this,arguments)}finally{f=q}}}})(a0);l0.exports=a0;var eS=l0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tS=z,At=eS;function O(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u0=new Set,Eo={};function as(n,e){li(n,e),li(n+"Capture",e)}function li(n,e){for(Eo[n]=e,n=0;n<e.length;n++)u0.add(e[n])}var Ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ad=Object.prototype.hasOwnProperty,nS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bp={},Up={};function rS(n){return ad.call(Up,n)?!0:ad.call(Bp,n)?!1:nS.test(n)?Up[n]=!0:(Bp[n]=!0,!1)}function sS(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function iS(n,e,t,r){if(e===null||typeof e>"u"||sS(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ut(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var He={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){He[n]=new ut(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];He[e]=new ut(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){He[n]=new ut(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){He[n]=new ut(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){He[n]=new ut(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){He[n]=new ut(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){He[n]=new ut(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){He[n]=new ut(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){He[n]=new ut(n,5,!1,n.toLowerCase(),null,!1,!1)});var Gf=/[\-:]([a-z])/g;function Qf(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Gf,Qf);He[e]=new ut(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Gf,Qf);He[e]=new ut(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Gf,Qf);He[e]=new ut(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){He[n]=new ut(n,1,!1,n.toLowerCase(),null,!1,!1)});He.xlinkHref=new ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){He[n]=new ut(n,1,!1,n.toLowerCase(),null,!0,!0)});function Xf(n,e,t,r){var s=He.hasOwnProperty(e)?He[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iS(e,t,s,r)&&(t=null),r||s===null?rS(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Un=tS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yl=Symbol.for("react.element"),Ps=Symbol.for("react.portal"),Is=Symbol.for("react.fragment"),Yf=Symbol.for("react.strict_mode"),ud=Symbol.for("react.profiler"),c0=Symbol.for("react.provider"),d0=Symbol.for("react.context"),Zf=Symbol.for("react.forward_ref"),cd=Symbol.for("react.suspense"),dd=Symbol.for("react.suspense_list"),eh=Symbol.for("react.memo"),Kn=Symbol.for("react.lazy"),f0=Symbol.for("react.offscreen"),Vp=Symbol.iterator;function Di(n){return n===null||typeof n!="object"?null:(n=Vp&&n[Vp]||n["@@iterator"],typeof n=="function"?n:null)}var pe=Object.assign,Yu;function qi(n){if(Yu===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Yu=e&&e[1]||""}return`
`+Yu+n}var Zu=!1;function ec(n,e){if(!n||Zu)return"";Zu=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var a=`
`+s[o].replace(" at new "," at ");return n.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",n.displayName)),a}while(1<=o&&0<=l);break}}}finally{Zu=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?qi(n):""}function oS(n){switch(n.tag){case 5:return qi(n.type);case 16:return qi("Lazy");case 13:return qi("Suspense");case 19:return qi("SuspenseList");case 0:case 2:case 15:return n=ec(n.type,!1),n;case 11:return n=ec(n.type.render,!1),n;case 1:return n=ec(n.type,!0),n;default:return""}}function fd(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Is:return"Fragment";case Ps:return"Portal";case ud:return"Profiler";case Yf:return"StrictMode";case cd:return"Suspense";case dd:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case d0:return(n.displayName||"Context")+".Consumer";case c0:return(n._context.displayName||"Context")+".Provider";case Zf:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case eh:return e=n.displayName||null,e!==null?e:fd(n.type)||"Memo";case Kn:e=n._payload,n=n._init;try{return fd(n(e))}catch{}}return null}function lS(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fd(e);case 8:return e===Yf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function kr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function h0(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aS(n){var e=h0(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function vl(n){n._valueTracker||(n._valueTracker=aS(n))}function p0(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=h0(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function xa(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function hd(n,e){var t=e.checked;return pe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Hp(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=kr(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function m0(n,e){e=e.checked,e!=null&&Xf(n,"checked",e,!1)}function pd(n,e){m0(n,e);var t=kr(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?md(n,e.type,t):e.hasOwnProperty("defaultValue")&&md(n,e.type,kr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Wp(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function md(n,e,t){(e!=="number"||xa(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Ji=Array.isArray;function Js(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+kr(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function gd(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return pe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function qp(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(O(92));if(Ji(t)){if(1<t.length)throw Error(O(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:kr(t)}}function g0(n,e){var t=kr(e.value),r=kr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Jp(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function y0(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yd(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?y0(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var wl,v0=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(wl=wl||document.createElement("div"),wl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=wl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function To(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var oo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uS=["Webkit","ms","Moz","O"];Object.keys(oo).forEach(function(n){uS.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),oo[e]=oo[n]})});function w0(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||oo.hasOwnProperty(n)&&oo[n]?(""+e).trim():e+"px"}function k0(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=w0(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var cS=pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vd(n,e){if(e){if(cS[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function wd(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kd=null;function th(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var xd=null,Ks=null,Gs=null;function Kp(n){if(n=sl(n)){if(typeof xd!="function")throw Error(O(280));var e=n.stateNode;e&&(e=mu(e),xd(n.stateNode,n.type,e))}}function x0(n){Ks?Gs?Gs.push(n):Gs=[n]:Ks=n}function S0(){if(Ks){var n=Ks,e=Gs;if(Gs=Ks=null,Kp(n),e)for(n=0;n<e.length;n++)Kp(e[n])}}function b0(n,e){return n(e)}function _0(){}var tc=!1;function C0(n,e,t){if(tc)return n(e,t);tc=!0;try{return b0(n,e,t)}finally{tc=!1,(Ks!==null||Gs!==null)&&(_0(),S0())}}function Oo(n,e){var t=n.stateNode;if(t===null)return null;var r=mu(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(O(231,e,typeof t));return t}var Sd=!1;if(Ln)try{var $i={};Object.defineProperty($i,"passive",{get:function(){Sd=!0}}),window.addEventListener("test",$i,$i),window.removeEventListener("test",$i,$i)}catch{Sd=!1}function dS(n,e,t,r,s,i,o,l,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var lo=!1,Sa=null,ba=!1,bd=null,fS={onError:function(n){lo=!0,Sa=n}};function hS(n,e,t,r,s,i,o,l,a){lo=!1,Sa=null,dS.apply(fS,arguments)}function pS(n,e,t,r,s,i,o,l,a){if(hS.apply(this,arguments),lo){if(lo){var u=Sa;lo=!1,Sa=null}else throw Error(O(198));ba||(ba=!0,bd=u)}}function us(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function E0(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Gp(n){if(us(n)!==n)throw Error(O(188))}function mS(n){var e=n.alternate;if(!e){if(e=us(n),e===null)throw Error(O(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Gp(s),n;if(i===r)return Gp(s),e;i=i.sibling}throw Error(O(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===t){o=!0,t=s,r=i;break}if(l===r){o=!0,r=s,t=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===t){o=!0,t=i,r=s;break}if(l===r){o=!0,r=i,t=s;break}l=l.sibling}if(!o)throw Error(O(189))}}if(t.alternate!==r)throw Error(O(190))}if(t.tag!==3)throw Error(O(188));return t.stateNode.current===t?n:e}function T0(n){return n=mS(n),n!==null?O0(n):null}function O0(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=O0(n);if(e!==null)return e;n=n.sibling}return null}var M0=At.unstable_scheduleCallback,Qp=At.unstable_cancelCallback,gS=At.unstable_shouldYield,yS=At.unstable_requestPaint,ve=At.unstable_now,vS=At.unstable_getCurrentPriorityLevel,nh=At.unstable_ImmediatePriority,A0=At.unstable_UserBlockingPriority,_a=At.unstable_NormalPriority,wS=At.unstable_LowPriority,N0=At.unstable_IdlePriority,du=null,vn=null;function kS(n){if(vn&&typeof vn.onCommitFiberRoot=="function")try{vn.onCommitFiberRoot(du,n,void 0,(n.current.flags&128)===128)}catch{}}var tn=Math.clz32?Math.clz32:bS,xS=Math.log,SS=Math.LN2;function bS(n){return n>>>=0,n===0?32:31-(xS(n)/SS|0)|0}var kl=64,xl=4194304;function Ki(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ca(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var l=o&~s;l!==0?r=Ki(l):(i&=o,i!==0&&(r=Ki(i)))}else o=t&~s,o!==0?r=Ki(o):i!==0&&(r=Ki(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-tn(e),s=1<<t,r|=n[t],e&=~s;return r}function _S(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CS(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-tn(i),l=1<<o,a=s[o];a===-1?(!(l&t)||l&r)&&(s[o]=_S(l,e)):a<=e&&(n.expiredLanes|=l),i&=~l}}function _d(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function P0(){var n=kl;return kl<<=1,!(kl&4194240)&&(kl=64),n}function nc(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function nl(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-tn(e),n[e]=t}function ES(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-tn(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function rh(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-tn(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var te=0;function I0(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var R0,sh,D0,$0,L0,Cd=!1,Sl=[],ar=null,ur=null,cr=null,Mo=new Map,Ao=new Map,Zn=[],TS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xp(n,e){switch(n){case"focusin":case"focusout":ar=null;break;case"dragenter":case"dragleave":ur=null;break;case"mouseover":case"mouseout":cr=null;break;case"pointerover":case"pointerout":Mo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ao.delete(e.pointerId)}}function Li(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=sl(e),e!==null&&sh(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function OS(n,e,t,r,s){switch(e){case"focusin":return ar=Li(ar,n,e,t,r,s),!0;case"dragenter":return ur=Li(ur,n,e,t,r,s),!0;case"mouseover":return cr=Li(cr,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Mo.set(i,Li(Mo.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ao.set(i,Li(Ao.get(i)||null,n,e,t,r,s)),!0}return!1}function j0(n){var e=jr(n.target);if(e!==null){var t=us(e);if(t!==null){if(e=t.tag,e===13){if(e=E0(t),e!==null){n.blockedOn=e,L0(n.priority,function(){D0(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Zl(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Ed(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);kd=r,t.target.dispatchEvent(r),kd=null}else return e=sl(t),e!==null&&sh(e),n.blockedOn=t,!1;e.shift()}return!0}function Yp(n,e,t){Zl(n)&&t.delete(e)}function MS(){Cd=!1,ar!==null&&Zl(ar)&&(ar=null),ur!==null&&Zl(ur)&&(ur=null),cr!==null&&Zl(cr)&&(cr=null),Mo.forEach(Yp),Ao.forEach(Yp)}function ji(n,e){n.blockedOn===e&&(n.blockedOn=null,Cd||(Cd=!0,At.unstable_scheduleCallback(At.unstable_NormalPriority,MS)))}function No(n){function e(s){return ji(s,n)}if(0<Sl.length){ji(Sl[0],n);for(var t=1;t<Sl.length;t++){var r=Sl[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ar!==null&&ji(ar,n),ur!==null&&ji(ur,n),cr!==null&&ji(cr,n),Mo.forEach(e),Ao.forEach(e),t=0;t<Zn.length;t++)r=Zn[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Zn.length&&(t=Zn[0],t.blockedOn===null);)j0(t),t.blockedOn===null&&Zn.shift()}var Qs=Un.ReactCurrentBatchConfig,Ea=!0;function AS(n,e,t,r){var s=te,i=Qs.transition;Qs.transition=null;try{te=1,ih(n,e,t,r)}finally{te=s,Qs.transition=i}}function NS(n,e,t,r){var s=te,i=Qs.transition;Qs.transition=null;try{te=4,ih(n,e,t,r)}finally{te=s,Qs.transition=i}}function ih(n,e,t,r){if(Ea){var s=Ed(n,e,t,r);if(s===null)fc(n,e,r,Ta,t),Xp(n,r);else if(OS(s,n,e,t,r))r.stopPropagation();else if(Xp(n,r),e&4&&-1<TS.indexOf(n)){for(;s!==null;){var i=sl(s);if(i!==null&&R0(i),i=Ed(n,e,t,r),i===null&&fc(n,e,r,Ta,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else fc(n,e,r,null,t)}}var Ta=null;function Ed(n,e,t,r){if(Ta=null,n=th(r),n=jr(n),n!==null)if(e=us(n),e===null)n=null;else if(t=e.tag,t===13){if(n=E0(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Ta=n,null}function F0(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vS()){case nh:return 1;case A0:return 4;case _a:case wS:return 16;case N0:return 536870912;default:return 16}default:return 16}}var rr=null,oh=null,ea=null;function z0(){if(ea)return ea;var n,e=oh,t=e.length,r,s="value"in rr?rr.value:rr.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return ea=s.slice(n,1<r?1-r:void 0)}function ta(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function bl(){return!0}function Zp(){return!1}function Pt(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?bl:Zp,this.isPropagationStopped=Zp,this}return pe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=bl)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=bl)},persist:function(){},isPersistent:bl}),e}var Ci={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lh=Pt(Ci),rl=pe({},Ci,{view:0,detail:0}),PS=Pt(rl),rc,sc,Fi,fu=pe({},rl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ah,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Fi&&(Fi&&n.type==="mousemove"?(rc=n.screenX-Fi.screenX,sc=n.screenY-Fi.screenY):sc=rc=0,Fi=n),rc)},movementY:function(n){return"movementY"in n?n.movementY:sc}}),em=Pt(fu),IS=pe({},fu,{dataTransfer:0}),RS=Pt(IS),DS=pe({},rl,{relatedTarget:0}),ic=Pt(DS),$S=pe({},Ci,{animationName:0,elapsedTime:0,pseudoElement:0}),LS=Pt($S),jS=pe({},Ci,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),FS=Pt(jS),zS=pe({},Ci,{data:0}),tm=Pt(zS),BS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},US={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function HS(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=VS[n])?!!e[n]:!1}function ah(){return HS}var WS=pe({},rl,{key:function(n){if(n.key){var e=BS[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ta(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?US[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ah,charCode:function(n){return n.type==="keypress"?ta(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ta(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),qS=Pt(WS),JS=pe({},fu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nm=Pt(JS),KS=pe({},rl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ah}),GS=Pt(KS),QS=pe({},Ci,{propertyName:0,elapsedTime:0,pseudoElement:0}),XS=Pt(QS),YS=pe({},fu,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),ZS=Pt(YS),eb=[9,13,27,32],uh=Ln&&"CompositionEvent"in window,ao=null;Ln&&"documentMode"in document&&(ao=document.documentMode);var tb=Ln&&"TextEvent"in window&&!ao,B0=Ln&&(!uh||ao&&8<ao&&11>=ao),rm=" ",sm=!1;function U0(n,e){switch(n){case"keyup":return eb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function V0(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Rs=!1;function nb(n,e){switch(n){case"compositionend":return V0(e);case"keypress":return e.which!==32?null:(sm=!0,rm);case"textInput":return n=e.data,n===rm&&sm?null:n;default:return null}}function rb(n,e){if(Rs)return n==="compositionend"||!uh&&U0(n,e)?(n=z0(),ea=oh=rr=null,Rs=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return B0&&e.locale!=="ko"?null:e.data;default:return null}}var sb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function im(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!sb[n.type]:e==="textarea"}function H0(n,e,t,r){x0(r),e=Oa(e,"onChange"),0<e.length&&(t=new lh("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var uo=null,Po=null;function ib(n){tv(n,0)}function hu(n){var e=Ls(n);if(p0(e))return n}function ob(n,e){if(n==="change")return e}var W0=!1;if(Ln){var oc;if(Ln){var lc="oninput"in document;if(!lc){var om=document.createElement("div");om.setAttribute("oninput","return;"),lc=typeof om.oninput=="function"}oc=lc}else oc=!1;W0=oc&&(!document.documentMode||9<document.documentMode)}function lm(){uo&&(uo.detachEvent("onpropertychange",q0),Po=uo=null)}function q0(n){if(n.propertyName==="value"&&hu(Po)){var e=[];H0(e,Po,n,th(n)),C0(ib,e)}}function lb(n,e,t){n==="focusin"?(lm(),uo=e,Po=t,uo.attachEvent("onpropertychange",q0)):n==="focusout"&&lm()}function ab(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return hu(Po)}function ub(n,e){if(n==="click")return hu(e)}function cb(n,e){if(n==="input"||n==="change")return hu(e)}function db(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var rn=typeof Object.is=="function"?Object.is:db;function Io(n,e){if(rn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!ad.call(e,s)||!rn(n[s],e[s]))return!1}return!0}function am(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function um(n,e){var t=am(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=am(t)}}function J0(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?J0(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function K0(){for(var n=window,e=xa();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=xa(n.document)}return e}function ch(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function fb(n){var e=K0(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&J0(t.ownerDocument.documentElement,t)){if(r!==null&&ch(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=um(t,i);var o=um(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var hb=Ln&&"documentMode"in document&&11>=document.documentMode,Ds=null,Td=null,co=null,Od=!1;function cm(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Od||Ds==null||Ds!==xa(r)||(r=Ds,"selectionStart"in r&&ch(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),co&&Io(co,r)||(co=r,r=Oa(Td,"onSelect"),0<r.length&&(e=new lh("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ds)))}function _l(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var $s={animationend:_l("Animation","AnimationEnd"),animationiteration:_l("Animation","AnimationIteration"),animationstart:_l("Animation","AnimationStart"),transitionend:_l("Transition","TransitionEnd")},ac={},G0={};Ln&&(G0=document.createElement("div").style,"AnimationEvent"in window||(delete $s.animationend.animation,delete $s.animationiteration.animation,delete $s.animationstart.animation),"TransitionEvent"in window||delete $s.transitionend.transition);function pu(n){if(ac[n])return ac[n];if(!$s[n])return n;var e=$s[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in G0)return ac[n]=e[t];return n}var Q0=pu("animationend"),X0=pu("animationiteration"),Y0=pu("animationstart"),Z0=pu("transitionend"),ev=new Map,dm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function br(n,e){ev.set(n,e),as(e,[n])}for(var uc=0;uc<dm.length;uc++){var cc=dm[uc],pb=cc.toLowerCase(),mb=cc[0].toUpperCase()+cc.slice(1);br(pb,"on"+mb)}br(Q0,"onAnimationEnd");br(X0,"onAnimationIteration");br(Y0,"onAnimationStart");br("dblclick","onDoubleClick");br("focusin","onFocus");br("focusout","onBlur");br(Z0,"onTransitionEnd");li("onMouseEnter",["mouseout","mouseover"]);li("onMouseLeave",["mouseout","mouseover"]);li("onPointerEnter",["pointerout","pointerover"]);li("onPointerLeave",["pointerout","pointerover"]);as("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));as("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));as("onBeforeInput",["compositionend","keypress","textInput","paste"]);as("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));as("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));as("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gb=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gi));function fm(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,pS(r,e,void 0,n),n.currentTarget=null}function tv(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],a=l.instance,u=l.currentTarget;if(l=l.listener,a!==i&&s.isPropagationStopped())break e;fm(s,l,u),i=a}else for(o=0;o<r.length;o++){if(l=r[o],a=l.instance,u=l.currentTarget,l=l.listener,a!==i&&s.isPropagationStopped())break e;fm(s,l,u),i=a}}}if(ba)throw n=bd,ba=!1,bd=null,n}function le(n,e){var t=e[Id];t===void 0&&(t=e[Id]=new Set);var r=n+"__bubble";t.has(r)||(nv(e,n,2,!1),t.add(r))}function dc(n,e,t){var r=0;e&&(r|=4),nv(t,n,r,e)}var Cl="_reactListening"+Math.random().toString(36).slice(2);function Ro(n){if(!n[Cl]){n[Cl]=!0,u0.forEach(function(t){t!=="selectionchange"&&(gb.has(t)||dc(t,!1,n),dc(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Cl]||(e[Cl]=!0,dc("selectionchange",!1,e))}}function nv(n,e,t,r){switch(F0(e)){case 1:var s=AS;break;case 4:s=NS;break;default:s=ih}t=s.bind(null,e,t,n),s=void 0,!Sd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function fc(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var a=o.tag;if((a===3||a===4)&&(a=o.stateNode.containerInfo,a===s||a.nodeType===8&&a.parentNode===s))return;o=o.return}for(;l!==null;){if(o=jr(l),o===null)return;if(a=o.tag,a===5||a===6){r=i=o;continue e}l=l.parentNode}}r=r.return}C0(function(){var u=i,c=th(t),d=[];e:{var f=ev.get(n);if(f!==void 0){var h=lh,p=n;switch(n){case"keypress":if(ta(t)===0)break e;case"keydown":case"keyup":h=qS;break;case"focusin":p="focus",h=ic;break;case"focusout":p="blur",h=ic;break;case"beforeblur":case"afterblur":h=ic;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=em;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=RS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=GS;break;case Q0:case X0:case Y0:h=LS;break;case Z0:h=XS;break;case"scroll":h=PS;break;case"wheel":h=ZS;break;case"copy":case"cut":case"paste":h=FS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=nm}var m=(e&4)!==0,v=!m&&n==="scroll",y=m?f!==null?f+"Capture":null:f;m=[];for(var g=u,w;g!==null;){w=g;var k=w.stateNode;if(w.tag===5&&k!==null&&(w=k,y!==null&&(k=Oo(g,y),k!=null&&m.push(Do(g,k,w)))),v)break;g=g.return}0<m.length&&(f=new h(f,p,null,t,c),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==kd&&(p=t.relatedTarget||t.fromElement)&&(jr(p)||p[jn]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=u,p=p?jr(p):null,p!==null&&(v=us(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=u),h!==p)){if(m=em,k="onMouseLeave",y="onMouseEnter",g="mouse",(n==="pointerout"||n==="pointerover")&&(m=nm,k="onPointerLeave",y="onPointerEnter",g="pointer"),v=h==null?f:Ls(h),w=p==null?f:Ls(p),f=new m(k,g+"leave",h,t,c),f.target=v,f.relatedTarget=w,k=null,jr(c)===u&&(m=new m(y,g+"enter",p,t,c),m.target=w,m.relatedTarget=v,k=m),v=k,h&&p)t:{for(m=h,y=p,g=0,w=m;w;w=vs(w))g++;for(w=0,k=y;k;k=vs(k))w++;for(;0<g-w;)m=vs(m),g--;for(;0<w-g;)y=vs(y),w--;for(;g--;){if(m===y||y!==null&&m===y.alternate)break t;m=vs(m),y=vs(y)}m=null}else m=null;h!==null&&hm(d,f,h,m,!1),p!==null&&v!==null&&hm(d,v,p,m,!0)}}e:{if(f=u?Ls(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var S=ob;else if(im(f))if(W0)S=cb;else{S=ab;var b=lb}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=ub);if(S&&(S=S(n,u))){H0(d,S,t,c);break e}b&&b(n,f,u),n==="focusout"&&(b=f._wrapperState)&&b.controlled&&f.type==="number"&&md(f,"number",f.value)}switch(b=u?Ls(u):window,n){case"focusin":(im(b)||b.contentEditable==="true")&&(Ds=b,Td=u,co=null);break;case"focusout":co=Td=Ds=null;break;case"mousedown":Od=!0;break;case"contextmenu":case"mouseup":case"dragend":Od=!1,cm(d,t,c);break;case"selectionchange":if(hb)break;case"keydown":case"keyup":cm(d,t,c)}var _;if(uh)e:{switch(n){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Rs?U0(n,t)&&(C="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(B0&&t.locale!=="ko"&&(Rs||C!=="onCompositionStart"?C==="onCompositionEnd"&&Rs&&(_=z0()):(rr=c,oh="value"in rr?rr.value:rr.textContent,Rs=!0)),b=Oa(u,C),0<b.length&&(C=new tm(C,n,null,t,c),d.push({event:C,listeners:b}),_?C.data=_:(_=V0(t),_!==null&&(C.data=_)))),(_=tb?nb(n,t):rb(n,t))&&(u=Oa(u,"onBeforeInput"),0<u.length&&(c=new tm("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=_))}tv(d,e)})}function Do(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Oa(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Oo(n,t),i!=null&&r.unshift(Do(n,i,s)),i=Oo(n,e),i!=null&&r.push(Do(n,i,s))),n=n.return}return r}function vs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function hm(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var l=t,a=l.alternate,u=l.stateNode;if(a!==null&&a===r)break;l.tag===5&&u!==null&&(l=u,s?(a=Oo(t,i),a!=null&&o.unshift(Do(t,a,l))):s||(a=Oo(t,i),a!=null&&o.push(Do(t,a,l)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var yb=/\r\n?/g,vb=/\u0000|\uFFFD/g;function pm(n){return(typeof n=="string"?n:""+n).replace(yb,`
`).replace(vb,"")}function El(n,e,t){if(e=pm(e),pm(n)!==e&&t)throw Error(O(425))}function Ma(){}var Md=null,Ad=null;function Nd(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Pd=typeof setTimeout=="function"?setTimeout:void 0,wb=typeof clearTimeout=="function"?clearTimeout:void 0,mm=typeof Promise=="function"?Promise:void 0,kb=typeof queueMicrotask=="function"?queueMicrotask:typeof mm<"u"?function(n){return mm.resolve(null).then(n).catch(xb)}:Pd;function xb(n){setTimeout(function(){throw n})}function hc(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),No(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);No(e)}function dr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function gm(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ei=Math.random().toString(36).slice(2),mn="__reactFiber$"+Ei,$o="__reactProps$"+Ei,jn="__reactContainer$"+Ei,Id="__reactEvents$"+Ei,Sb="__reactListeners$"+Ei,bb="__reactHandles$"+Ei;function jr(n){var e=n[mn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[jn]||t[mn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=gm(n);n!==null;){if(t=n[mn])return t;n=gm(n)}return e}n=t,t=n.parentNode}return null}function sl(n){return n=n[mn]||n[jn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ls(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(O(33))}function mu(n){return n[$o]||null}var Rd=[],js=-1;function _r(n){return{current:n}}function ae(n){0>js||(n.current=Rd[js],Rd[js]=null,js--)}function oe(n,e){js++,Rd[js]=n.current,n.current=e}var xr={},Ye=_r(xr),mt=_r(!1),Yr=xr;function ai(n,e){var t=n.type.contextTypes;if(!t)return xr;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function gt(n){return n=n.childContextTypes,n!=null}function Aa(){ae(mt),ae(Ye)}function ym(n,e,t){if(Ye.current!==xr)throw Error(O(168));oe(Ye,e),oe(mt,t)}function rv(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(O(108,lS(n)||"Unknown",s));return pe({},t,r)}function Na(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||xr,Yr=Ye.current,oe(Ye,n),oe(mt,mt.current),!0}function vm(n,e,t){var r=n.stateNode;if(!r)throw Error(O(169));t?(n=rv(n,e,Yr),r.__reactInternalMemoizedMergedChildContext=n,ae(mt),ae(Ye),oe(Ye,n)):ae(mt),oe(mt,t)}var Nn=null,gu=!1,pc=!1;function sv(n){Nn===null?Nn=[n]:Nn.push(n)}function _b(n){gu=!0,sv(n)}function Cr(){if(!pc&&Nn!==null){pc=!0;var n=0,e=te;try{var t=Nn;for(te=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Nn=null,gu=!1}catch(s){throw Nn!==null&&(Nn=Nn.slice(n+1)),M0(nh,Cr),s}finally{te=e,pc=!1}}return null}var Fs=[],zs=0,Pa=null,Ia=0,Rt=[],Dt=0,Zr=null,Pn=1,In="";function Nr(n,e){Fs[zs++]=Ia,Fs[zs++]=Pa,Pa=n,Ia=e}function iv(n,e,t){Rt[Dt++]=Pn,Rt[Dt++]=In,Rt[Dt++]=Zr,Zr=n;var r=Pn;n=In;var s=32-tn(r)-1;r&=~(1<<s),t+=1;var i=32-tn(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Pn=1<<32-tn(e)+s|t<<s|r,In=i+n}else Pn=1<<i|t<<s|r,In=n}function dh(n){n.return!==null&&(Nr(n,1),iv(n,1,0))}function fh(n){for(;n===Pa;)Pa=Fs[--zs],Fs[zs]=null,Ia=Fs[--zs],Fs[zs]=null;for(;n===Zr;)Zr=Rt[--Dt],Rt[Dt]=null,In=Rt[--Dt],Rt[Dt]=null,Pn=Rt[--Dt],Rt[Dt]=null}var Mt=null,Ot=null,ue=!1,Xt=null;function ov(n,e){var t=Lt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function wm(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Mt=n,Ot=dr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Mt=n,Ot=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Zr!==null?{id:Pn,overflow:In}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Lt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Mt=n,Ot=null,!0):!1;default:return!1}}function Dd(n){return(n.mode&1)!==0&&(n.flags&128)===0}function $d(n){if(ue){var e=Ot;if(e){var t=e;if(!wm(n,e)){if(Dd(n))throw Error(O(418));e=dr(t.nextSibling);var r=Mt;e&&wm(n,e)?ov(r,t):(n.flags=n.flags&-4097|2,ue=!1,Mt=n)}}else{if(Dd(n))throw Error(O(418));n.flags=n.flags&-4097|2,ue=!1,Mt=n}}}function km(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Mt=n}function Tl(n){if(n!==Mt)return!1;if(!ue)return km(n),ue=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Nd(n.type,n.memoizedProps)),e&&(e=Ot)){if(Dd(n))throw lv(),Error(O(418));for(;e;)ov(n,e),e=dr(e.nextSibling)}if(km(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(O(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ot=dr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ot=null}}else Ot=Mt?dr(n.stateNode.nextSibling):null;return!0}function lv(){for(var n=Ot;n;)n=dr(n.nextSibling)}function ui(){Ot=Mt=null,ue=!1}function hh(n){Xt===null?Xt=[n]:Xt.push(n)}var Cb=Un.ReactCurrentBatchConfig;function zi(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(O(309));var r=t.stateNode}if(!r)throw Error(O(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(O(284));if(!t._owner)throw Error(O(290,n))}return n}function Ol(n,e){throw n=Object.prototype.toString.call(e),Error(O(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function xm(n){var e=n._init;return e(n._payload)}function av(n){function e(y,g){if(n){var w=y.deletions;w===null?(y.deletions=[g],y.flags|=16):w.push(g)}}function t(y,g){if(!n)return null;for(;g!==null;)e(y,g),g=g.sibling;return null}function r(y,g){for(y=new Map;g!==null;)g.key!==null?y.set(g.key,g):y.set(g.index,g),g=g.sibling;return y}function s(y,g){return y=mr(y,g),y.index=0,y.sibling=null,y}function i(y,g,w){return y.index=w,n?(w=y.alternate,w!==null?(w=w.index,w<g?(y.flags|=2,g):w):(y.flags|=2,g)):(y.flags|=1048576,g)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function l(y,g,w,k){return g===null||g.tag!==6?(g=xc(w,y.mode,k),g.return=y,g):(g=s(g,w),g.return=y,g)}function a(y,g,w,k){var S=w.type;return S===Is?c(y,g,w.props.children,k,w.key):g!==null&&(g.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Kn&&xm(S)===g.type)?(k=s(g,w.props),k.ref=zi(y,g,w),k.return=y,k):(k=aa(w.type,w.key,w.props,null,y.mode,k),k.ref=zi(y,g,w),k.return=y,k)}function u(y,g,w,k){return g===null||g.tag!==4||g.stateNode.containerInfo!==w.containerInfo||g.stateNode.implementation!==w.implementation?(g=Sc(w,y.mode,k),g.return=y,g):(g=s(g,w.children||[]),g.return=y,g)}function c(y,g,w,k,S){return g===null||g.tag!==7?(g=qr(w,y.mode,k,S),g.return=y,g):(g=s(g,w),g.return=y,g)}function d(y,g,w){if(typeof g=="string"&&g!==""||typeof g=="number")return g=xc(""+g,y.mode,w),g.return=y,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case yl:return w=aa(g.type,g.key,g.props,null,y.mode,w),w.ref=zi(y,null,g),w.return=y,w;case Ps:return g=Sc(g,y.mode,w),g.return=y,g;case Kn:var k=g._init;return d(y,k(g._payload),w)}if(Ji(g)||Di(g))return g=qr(g,y.mode,w,null),g.return=y,g;Ol(y,g)}return null}function f(y,g,w,k){var S=g!==null?g.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return S!==null?null:l(y,g,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case yl:return w.key===S?a(y,g,w,k):null;case Ps:return w.key===S?u(y,g,w,k):null;case Kn:return S=w._init,f(y,g,S(w._payload),k)}if(Ji(w)||Di(w))return S!==null?null:c(y,g,w,k,null);Ol(y,w)}return null}function h(y,g,w,k,S){if(typeof k=="string"&&k!==""||typeof k=="number")return y=y.get(w)||null,l(g,y,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case yl:return y=y.get(k.key===null?w:k.key)||null,a(g,y,k,S);case Ps:return y=y.get(k.key===null?w:k.key)||null,u(g,y,k,S);case Kn:var b=k._init;return h(y,g,w,b(k._payload),S)}if(Ji(k)||Di(k))return y=y.get(w)||null,c(g,y,k,S,null);Ol(g,k)}return null}function p(y,g,w,k){for(var S=null,b=null,_=g,C=g=0,T=null;_!==null&&C<w.length;C++){_.index>C?(T=_,_=null):T=_.sibling;var A=f(y,_,w[C],k);if(A===null){_===null&&(_=T);break}n&&_&&A.alternate===null&&e(y,_),g=i(A,g,C),b===null?S=A:b.sibling=A,b=A,_=T}if(C===w.length)return t(y,_),ue&&Nr(y,C),S;if(_===null){for(;C<w.length;C++)_=d(y,w[C],k),_!==null&&(g=i(_,g,C),b===null?S=_:b.sibling=_,b=_);return ue&&Nr(y,C),S}for(_=r(y,_);C<w.length;C++)T=h(_,y,C,w[C],k),T!==null&&(n&&T.alternate!==null&&_.delete(T.key===null?C:T.key),g=i(T,g,C),b===null?S=T:b.sibling=T,b=T);return n&&_.forEach(function(P){return e(y,P)}),ue&&Nr(y,C),S}function m(y,g,w,k){var S=Di(w);if(typeof S!="function")throw Error(O(150));if(w=S.call(w),w==null)throw Error(O(151));for(var b=S=null,_=g,C=g=0,T=null,A=w.next();_!==null&&!A.done;C++,A=w.next()){_.index>C?(T=_,_=null):T=_.sibling;var P=f(y,_,A.value,k);if(P===null){_===null&&(_=T);break}n&&_&&P.alternate===null&&e(y,_),g=i(P,g,C),b===null?S=P:b.sibling=P,b=P,_=T}if(A.done)return t(y,_),ue&&Nr(y,C),S;if(_===null){for(;!A.done;C++,A=w.next())A=d(y,A.value,k),A!==null&&(g=i(A,g,C),b===null?S=A:b.sibling=A,b=A);return ue&&Nr(y,C),S}for(_=r(y,_);!A.done;C++,A=w.next())A=h(_,y,C,A.value,k),A!==null&&(n&&A.alternate!==null&&_.delete(A.key===null?C:A.key),g=i(A,g,C),b===null?S=A:b.sibling=A,b=A);return n&&_.forEach(function(ye){return e(y,ye)}),ue&&Nr(y,C),S}function v(y,g,w,k){if(typeof w=="object"&&w!==null&&w.type===Is&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case yl:e:{for(var S=w.key,b=g;b!==null;){if(b.key===S){if(S=w.type,S===Is){if(b.tag===7){t(y,b.sibling),g=s(b,w.props.children),g.return=y,y=g;break e}}else if(b.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Kn&&xm(S)===b.type){t(y,b.sibling),g=s(b,w.props),g.ref=zi(y,b,w),g.return=y,y=g;break e}t(y,b);break}else e(y,b);b=b.sibling}w.type===Is?(g=qr(w.props.children,y.mode,k,w.key),g.return=y,y=g):(k=aa(w.type,w.key,w.props,null,y.mode,k),k.ref=zi(y,g,w),k.return=y,y=k)}return o(y);case Ps:e:{for(b=w.key;g!==null;){if(g.key===b)if(g.tag===4&&g.stateNode.containerInfo===w.containerInfo&&g.stateNode.implementation===w.implementation){t(y,g.sibling),g=s(g,w.children||[]),g.return=y,y=g;break e}else{t(y,g);break}else e(y,g);g=g.sibling}g=Sc(w,y.mode,k),g.return=y,y=g}return o(y);case Kn:return b=w._init,v(y,g,b(w._payload),k)}if(Ji(w))return p(y,g,w,k);if(Di(w))return m(y,g,w,k);Ol(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,g!==null&&g.tag===6?(t(y,g.sibling),g=s(g,w),g.return=y,y=g):(t(y,g),g=xc(w,y.mode,k),g.return=y,y=g),o(y)):t(y,g)}return v}var ci=av(!0),uv=av(!1),Ra=_r(null),Da=null,Bs=null,ph=null;function mh(){ph=Bs=Da=null}function gh(n){var e=Ra.current;ae(Ra),n._currentValue=e}function Ld(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Xs(n,e){Da=n,ph=Bs=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(pt=!0),n.firstContext=null)}function Vt(n){var e=n._currentValue;if(ph!==n)if(n={context:n,memoizedValue:e,next:null},Bs===null){if(Da===null)throw Error(O(308));Bs=n,Da.dependencies={lanes:0,firstContext:n}}else Bs=Bs.next=n;return e}var Fr=null;function yh(n){Fr===null?Fr=[n]:Fr.push(n)}function cv(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,yh(e)):(t.next=s.next,s.next=t),e.interleaved=t,Fn(n,r)}function Fn(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Gn=!1;function vh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dv(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Dn(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function fr(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Z&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Fn(n,t)}return s=r.interleaved,s===null?(e.next=e,yh(r)):(e.next=s.next,s.next=e),r.interleaved=e,Fn(n,t)}function na(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,rh(n,t)}}function Sm(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function $a(n,e,t,r){var s=n.updateQueue;Gn=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var a=l,u=a.next;a.next=null,o===null?i=u:o.next=u,o=a;var c=n.alternate;c!==null&&(c=c.updateQueue,l=c.lastBaseUpdate,l!==o&&(l===null?c.firstBaseUpdate=u:l.next=u,c.lastBaseUpdate=a))}if(i!==null){var d=s.baseState;o=0,c=u=a=null,l=i;do{var f=l.lane,h=l.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var p=n,m=l;switch(f=e,h=t,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=pe({},d,f);break e;case 2:Gn=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else h={eventTime:h,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},c===null?(u=c=h,a=d):c=c.next=h,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(a=d),s.baseState=a,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ts|=o,n.lanes=o,n.memoizedState=d}}function bm(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(O(191,s));s.call(r)}}}var il={},wn=_r(il),Lo=_r(il),jo=_r(il);function zr(n){if(n===il)throw Error(O(174));return n}function wh(n,e){switch(oe(jo,e),oe(Lo,n),oe(wn,il),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:yd(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=yd(e,n)}ae(wn),oe(wn,e)}function di(){ae(wn),ae(Lo),ae(jo)}function fv(n){zr(jo.current);var e=zr(wn.current),t=yd(e,n.type);e!==t&&(oe(Lo,n),oe(wn,t))}function kh(n){Lo.current===n&&(ae(wn),ae(Lo))}var fe=_r(0);function La(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mc=[];function xh(){for(var n=0;n<mc.length;n++)mc[n]._workInProgressVersionPrimary=null;mc.length=0}var ra=Un.ReactCurrentDispatcher,gc=Un.ReactCurrentBatchConfig,es=0,he=null,Ce=null,Ae=null,ja=!1,fo=!1,Fo=0,Eb=0;function qe(){throw Error(O(321))}function Sh(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!rn(n[t],e[t]))return!1;return!0}function bh(n,e,t,r,s,i){if(es=i,he=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ra.current=n===null||n.memoizedState===null?Ab:Nb,n=t(r,s),fo){i=0;do{if(fo=!1,Fo=0,25<=i)throw Error(O(301));i+=1,Ae=Ce=null,e.updateQueue=null,ra.current=Pb,n=t(r,s)}while(fo)}if(ra.current=Fa,e=Ce!==null&&Ce.next!==null,es=0,Ae=Ce=he=null,ja=!1,e)throw Error(O(300));return n}function _h(){var n=Fo!==0;return Fo=0,n}function dn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ae===null?he.memoizedState=Ae=n:Ae=Ae.next=n,Ae}function Ht(){if(Ce===null){var n=he.alternate;n=n!==null?n.memoizedState:null}else n=Ce.next;var e=Ae===null?he.memoizedState:Ae.next;if(e!==null)Ae=e,Ce=n;else{if(n===null)throw Error(O(310));Ce=n,n={memoizedState:Ce.memoizedState,baseState:Ce.baseState,baseQueue:Ce.baseQueue,queue:Ce.queue,next:null},Ae===null?he.memoizedState=Ae=n:Ae=Ae.next=n}return Ae}function zo(n,e){return typeof e=="function"?e(n):e}function yc(n){var e=Ht(),t=e.queue;if(t===null)throw Error(O(311));t.lastRenderedReducer=n;var r=Ce,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,a=null,u=i;do{var c=u.lane;if((es&c)===c)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(l=a=d,o=r):a=a.next=d,he.lanes|=c,ts|=c}u=u.next}while(u!==null&&u!==i);a===null?o=r:a.next=l,rn(r,e.memoizedState)||(pt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=a,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,he.lanes|=i,ts|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function vc(n){var e=Ht(),t=e.queue;if(t===null)throw Error(O(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);rn(i,e.memoizedState)||(pt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function hv(){}function pv(n,e){var t=he,r=Ht(),s=e(),i=!rn(r.memoizedState,s);if(i&&(r.memoizedState=s,pt=!0),r=r.queue,Ch(yv.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Ae!==null&&Ae.memoizedState.tag&1){if(t.flags|=2048,Bo(9,gv.bind(null,t,r,s,e),void 0,null),Ie===null)throw Error(O(349));es&30||mv(t,e,s)}return s}function mv(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=he.updateQueue,e===null?(e={lastEffect:null,stores:null},he.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function gv(n,e,t,r){e.value=t,e.getSnapshot=r,vv(e)&&wv(n)}function yv(n,e,t){return t(function(){vv(e)&&wv(n)})}function vv(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!rn(n,t)}catch{return!0}}function wv(n){var e=Fn(n,1);e!==null&&nn(e,n,1,-1)}function _m(n){var e=dn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:n},e.queue=n,n=n.dispatch=Mb.bind(null,he,n),[e.memoizedState,n]}function Bo(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=he.updateQueue,e===null?(e={lastEffect:null,stores:null},he.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function kv(){return Ht().memoizedState}function sa(n,e,t,r){var s=dn();he.flags|=n,s.memoizedState=Bo(1|e,t,void 0,r===void 0?null:r)}function yu(n,e,t,r){var s=Ht();r=r===void 0?null:r;var i=void 0;if(Ce!==null){var o=Ce.memoizedState;if(i=o.destroy,r!==null&&Sh(r,o.deps)){s.memoizedState=Bo(e,t,i,r);return}}he.flags|=n,s.memoizedState=Bo(1|e,t,i,r)}function Cm(n,e){return sa(8390656,8,n,e)}function Ch(n,e){return yu(2048,8,n,e)}function xv(n,e){return yu(4,2,n,e)}function Sv(n,e){return yu(4,4,n,e)}function bv(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function _v(n,e,t){return t=t!=null?t.concat([n]):null,yu(4,4,bv.bind(null,e,n),t)}function Eh(){}function Cv(n,e){var t=Ht();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Sh(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Ev(n,e){var t=Ht();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Sh(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Tv(n,e,t){return es&21?(rn(t,e)||(t=P0(),he.lanes|=t,ts|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,pt=!0),n.memoizedState=t)}function Tb(n,e){var t=te;te=t!==0&&4>t?t:4,n(!0);var r=gc.transition;gc.transition={};try{n(!1),e()}finally{te=t,gc.transition=r}}function Ov(){return Ht().memoizedState}function Ob(n,e,t){var r=pr(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Mv(n))Av(e,t);else if(t=cv(n,e,t,r),t!==null){var s=rt();nn(t,n,r,s),Nv(t,e,r)}}function Mb(n,e,t){var r=pr(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Mv(n))Av(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,t);if(s.hasEagerState=!0,s.eagerState=l,rn(l,o)){var a=e.interleaved;a===null?(s.next=s,yh(e)):(s.next=a.next,a.next=s),e.interleaved=s;return}}catch{}finally{}t=cv(n,e,s,r),t!==null&&(s=rt(),nn(t,n,r,s),Nv(t,e,r))}}function Mv(n){var e=n.alternate;return n===he||e!==null&&e===he}function Av(n,e){fo=ja=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Nv(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,rh(n,t)}}var Fa={readContext:Vt,useCallback:qe,useContext:qe,useEffect:qe,useImperativeHandle:qe,useInsertionEffect:qe,useLayoutEffect:qe,useMemo:qe,useReducer:qe,useRef:qe,useState:qe,useDebugValue:qe,useDeferredValue:qe,useTransition:qe,useMutableSource:qe,useSyncExternalStore:qe,useId:qe,unstable_isNewReconciler:!1},Ab={readContext:Vt,useCallback:function(n,e){return dn().memoizedState=[n,e===void 0?null:e],n},useContext:Vt,useEffect:Cm,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,sa(4194308,4,bv.bind(null,e,n),t)},useLayoutEffect:function(n,e){return sa(4194308,4,n,e)},useInsertionEffect:function(n,e){return sa(4,2,n,e)},useMemo:function(n,e){var t=dn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=dn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=Ob.bind(null,he,n),[r.memoizedState,n]},useRef:function(n){var e=dn();return n={current:n},e.memoizedState=n},useState:_m,useDebugValue:Eh,useDeferredValue:function(n){return dn().memoizedState=n},useTransition:function(){var n=_m(!1),e=n[0];return n=Tb.bind(null,n[1]),dn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=he,s=dn();if(ue){if(t===void 0)throw Error(O(407));t=t()}else{if(t=e(),Ie===null)throw Error(O(349));es&30||mv(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Cm(yv.bind(null,r,i,n),[n]),r.flags|=2048,Bo(9,gv.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=dn(),e=Ie.identifierPrefix;if(ue){var t=In,r=Pn;t=(r&~(1<<32-tn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Fo++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Eb++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Nb={readContext:Vt,useCallback:Cv,useContext:Vt,useEffect:Ch,useImperativeHandle:_v,useInsertionEffect:xv,useLayoutEffect:Sv,useMemo:Ev,useReducer:yc,useRef:kv,useState:function(){return yc(zo)},useDebugValue:Eh,useDeferredValue:function(n){var e=Ht();return Tv(e,Ce.memoizedState,n)},useTransition:function(){var n=yc(zo)[0],e=Ht().memoizedState;return[n,e]},useMutableSource:hv,useSyncExternalStore:pv,useId:Ov,unstable_isNewReconciler:!1},Pb={readContext:Vt,useCallback:Cv,useContext:Vt,useEffect:Ch,useImperativeHandle:_v,useInsertionEffect:xv,useLayoutEffect:Sv,useMemo:Ev,useReducer:vc,useRef:kv,useState:function(){return vc(zo)},useDebugValue:Eh,useDeferredValue:function(n){var e=Ht();return Ce===null?e.memoizedState=n:Tv(e,Ce.memoizedState,n)},useTransition:function(){var n=vc(zo)[0],e=Ht().memoizedState;return[n,e]},useMutableSource:hv,useSyncExternalStore:pv,useId:Ov,unstable_isNewReconciler:!1};function Jt(n,e){if(n&&n.defaultProps){e=pe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function jd(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:pe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var vu={isMounted:function(n){return(n=n._reactInternals)?us(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=rt(),s=pr(n),i=Dn(r,s);i.payload=e,t!=null&&(i.callback=t),e=fr(n,i,s),e!==null&&(nn(e,n,s,r),na(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=rt(),s=pr(n),i=Dn(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=fr(n,i,s),e!==null&&(nn(e,n,s,r),na(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=rt(),r=pr(n),s=Dn(t,r);s.tag=2,e!=null&&(s.callback=e),e=fr(n,s,r),e!==null&&(nn(e,n,r,t),na(e,n,r))}};function Em(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Io(t,r)||!Io(s,i):!0}function Pv(n,e,t){var r=!1,s=xr,i=e.contextType;return typeof i=="object"&&i!==null?i=Vt(i):(s=gt(e)?Yr:Ye.current,r=e.contextTypes,i=(r=r!=null)?ai(n,s):xr),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vu,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Tm(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&vu.enqueueReplaceState(e,e.state,null)}function Fd(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},vh(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Vt(i):(i=gt(e)?Yr:Ye.current,s.context=ai(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(jd(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&vu.enqueueReplaceState(s,s.state,null),$a(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function fi(n,e){try{var t="",r=e;do t+=oS(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function wc(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function zd(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Ib=typeof WeakMap=="function"?WeakMap:Map;function Iv(n,e,t){t=Dn(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ba||(Ba=!0,Qd=r),zd(n,e)},t}function Rv(n,e,t){t=Dn(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){zd(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){zd(n,e),typeof r!="function"&&(hr===null?hr=new Set([this]):hr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Om(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Ib;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=Jb.bind(null,n,e,t),e.then(n,n))}function Mm(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Am(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Dn(-1,1),e.tag=2,fr(t,e,1))),t.lanes|=1),n)}var Rb=Un.ReactCurrentOwner,pt=!1;function nt(n,e,t,r){e.child=n===null?uv(e,null,t,r):ci(e,n.child,t,r)}function Nm(n,e,t,r,s){t=t.render;var i=e.ref;return Xs(e,s),r=bh(n,e,t,r,i,s),t=_h(),n!==null&&!pt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,zn(n,e,s)):(ue&&t&&dh(e),e.flags|=1,nt(n,e,r,s),e.child)}function Pm(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!Rh(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Dv(n,e,i,r,s)):(n=aa(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Io,t(o,r)&&n.ref===e.ref)return zn(n,e,s)}return e.flags|=1,n=mr(i,r),n.ref=e.ref,n.return=e,e.child=n}function Dv(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Io(i,r)&&n.ref===e.ref)if(pt=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(pt=!0);else return e.lanes=n.lanes,zn(n,e,s)}return Bd(n,e,t,r,s)}function $v(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},oe(Vs,Et),Et|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,oe(Vs,Et),Et|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,oe(Vs,Et),Et|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,oe(Vs,Et),Et|=r;return nt(n,e,s,t),e.child}function Lv(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Bd(n,e,t,r,s){var i=gt(t)?Yr:Ye.current;return i=ai(e,i),Xs(e,s),t=bh(n,e,t,r,i,s),r=_h(),n!==null&&!pt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,zn(n,e,s)):(ue&&r&&dh(e),e.flags|=1,nt(n,e,t,s),e.child)}function Im(n,e,t,r,s){if(gt(t)){var i=!0;Na(e)}else i=!1;if(Xs(e,s),e.stateNode===null)ia(n,e),Pv(e,t,r),Fd(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var a=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Vt(u):(u=gt(t)?Yr:Ye.current,u=ai(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||a!==u)&&Tm(e,o,r,u),Gn=!1;var f=e.memoizedState;o.state=f,$a(e,r,o,s),a=e.memoizedState,l!==r||f!==a||mt.current||Gn?(typeof c=="function"&&(jd(e,t,c,r),a=e.memoizedState),(l=Gn||Em(e,t,l,r,f,a,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=a),o.props=r,o.state=a,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,dv(n,e),l=e.memoizedProps,u=e.type===e.elementType?l:Jt(e.type,l),o.props=u,d=e.pendingProps,f=o.context,a=t.contextType,typeof a=="object"&&a!==null?a=Vt(a):(a=gt(t)?Yr:Ye.current,a=ai(e,a));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==d||f!==a)&&Tm(e,o,r,a),Gn=!1,f=e.memoizedState,o.state=f,$a(e,r,o,s);var p=e.memoizedState;l!==d||f!==p||mt.current||Gn?(typeof h=="function"&&(jd(e,t,h,r),p=e.memoizedState),(u=Gn||Em(e,t,u,r,f,p,a)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,a),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,a)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=a,r=u):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Ud(n,e,t,r,i,s)}function Ud(n,e,t,r,s,i){Lv(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&vm(e,t,!1),zn(n,e,i);r=e.stateNode,Rb.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=ci(e,n.child,null,i),e.child=ci(e,null,l,i)):nt(n,e,l,i),e.memoizedState=r.state,s&&vm(e,t,!0),e.child}function jv(n){var e=n.stateNode;e.pendingContext?ym(n,e.pendingContext,e.pendingContext!==e.context):e.context&&ym(n,e.context,!1),wh(n,e.containerInfo)}function Rm(n,e,t,r,s){return ui(),hh(s),e.flags|=256,nt(n,e,t,r),e.child}var Vd={dehydrated:null,treeContext:null,retryLane:0};function Hd(n){return{baseLanes:n,cachePool:null,transitions:null}}function Fv(n,e,t){var r=e.pendingProps,s=fe.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=n!==null&&n.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),oe(fe,s&1),n===null)return $d(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=xu(o,r,0,null),n=qr(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=Hd(t),e.memoizedState=Vd,n):Th(e,o));if(s=n.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Db(n,e,o,r,l,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,l=s.sibling;var a={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=a,e.deletions=null):(r=mr(s,a),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=mr(l,i):(i=qr(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?Hd(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=Vd,r}return i=n.child,n=i.sibling,r=mr(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Th(n,e){return e=xu({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Ml(n,e,t,r){return r!==null&&hh(r),ci(e,n.child,null,t),n=Th(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Db(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=wc(Error(O(422))),Ml(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=xu({mode:"visible",children:r.children},s,0,null),i=qr(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ci(e,n.child,null,o),e.child.memoizedState=Hd(o),e.memoizedState=Vd,i);if(!(e.mode&1))return Ml(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(O(419)),r=wc(i,r,void 0),Ml(n,e,o,r)}if(l=(o&n.childLanes)!==0,pt||l){if(r=Ie,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Fn(n,s),nn(r,n,s,-1))}return Ih(),r=wc(Error(O(421))),Ml(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Kb.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Ot=dr(s.nextSibling),Mt=e,ue=!0,Xt=null,n!==null&&(Rt[Dt++]=Pn,Rt[Dt++]=In,Rt[Dt++]=Zr,Pn=n.id,In=n.overflow,Zr=e),e=Th(e,r.children),e.flags|=4096,e)}function Dm(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Ld(n.return,e,t)}function kc(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function zv(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(nt(n,e,r.children,t),r=fe.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Dm(n,t,e);else if(n.tag===19)Dm(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(oe(fe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&La(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),kc(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&La(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}kc(e,!0,t,null,i);break;case"together":kc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ia(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function zn(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ts|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(O(153));if(e.child!==null){for(n=e.child,t=mr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=mr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function $b(n,e,t){switch(e.tag){case 3:jv(e),ui();break;case 5:fv(e);break;case 1:gt(e.type)&&Na(e);break;case 4:wh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;oe(Ra,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(oe(fe,fe.current&1),e.flags|=128,null):t&e.child.childLanes?Fv(n,e,t):(oe(fe,fe.current&1),n=zn(n,e,t),n!==null?n.sibling:null);oe(fe,fe.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return zv(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),oe(fe,fe.current),r)break;return null;case 22:case 23:return e.lanes=0,$v(n,e,t)}return zn(n,e,t)}var Bv,Wd,Uv,Vv;Bv=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Wd=function(){};Uv=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,zr(wn.current);var i=null;switch(t){case"input":s=hd(n,s),r=hd(n,r),i=[];break;case"select":s=pe({},s,{value:void 0}),r=pe({},r,{value:void 0}),i=[];break;case"textarea":s=gd(n,s),r=gd(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Ma)}vd(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var l=s[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Eo.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var a=r[u];if(l=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&a!==l&&(a!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||a&&a.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in a)a.hasOwnProperty(o)&&l[o]!==a[o]&&(t||(t={}),t[o]=a[o])}else t||(i||(i=[]),i.push(u,t)),t=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,l=l?l.__html:void 0,a!=null&&l!==a&&(i=i||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(i=i||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Eo.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&le("scroll",n),i||l===a||(i=[])):(i=i||[]).push(u,a))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};Vv=function(n,e,t,r){t!==r&&(e.flags|=4)};function Bi(n,e){if(!ue)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Je(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Lb(n,e,t){var r=e.pendingProps;switch(fh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Je(e),null;case 1:return gt(e.type)&&Aa(),Je(e),null;case 3:return r=e.stateNode,di(),ae(mt),ae(Ye),xh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Tl(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Xt!==null&&(Zd(Xt),Xt=null))),Wd(n,e),Je(e),null;case 5:kh(e);var s=zr(jo.current);if(t=e.type,n!==null&&e.stateNode!=null)Uv(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(O(166));return Je(e),null}if(n=zr(wn.current),Tl(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[mn]=e,r[$o]=i,n=(e.mode&1)!==0,t){case"dialog":le("cancel",r),le("close",r);break;case"iframe":case"object":case"embed":le("load",r);break;case"video":case"audio":for(s=0;s<Gi.length;s++)le(Gi[s],r);break;case"source":le("error",r);break;case"img":case"image":case"link":le("error",r),le("load",r);break;case"details":le("toggle",r);break;case"input":Hp(r,i),le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},le("invalid",r);break;case"textarea":qp(r,i),le("invalid",r)}vd(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&El(r.textContent,l,n),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&El(r.textContent,l,n),s=["children",""+l]):Eo.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&le("scroll",r)}switch(t){case"input":vl(r),Wp(r,i,!0);break;case"textarea":vl(r),Jp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ma)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=y0(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[mn]=e,n[$o]=r,Bv(n,e,!1,!1),e.stateNode=n;e:{switch(o=wd(t,r),t){case"dialog":le("cancel",n),le("close",n),s=r;break;case"iframe":case"object":case"embed":le("load",n),s=r;break;case"video":case"audio":for(s=0;s<Gi.length;s++)le(Gi[s],n);s=r;break;case"source":le("error",n),s=r;break;case"img":case"image":case"link":le("error",n),le("load",n),s=r;break;case"details":le("toggle",n),s=r;break;case"input":Hp(n,r),s=hd(n,r),le("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=pe({},r,{value:void 0}),le("invalid",n);break;case"textarea":qp(n,r),s=gd(n,r),le("invalid",n);break;default:s=r}vd(t,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var a=l[i];i==="style"?k0(n,a):i==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&v0(n,a)):i==="children"?typeof a=="string"?(t!=="textarea"||a!=="")&&To(n,a):typeof a=="number"&&To(n,""+a):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Eo.hasOwnProperty(i)?a!=null&&i==="onScroll"&&le("scroll",n):a!=null&&Xf(n,i,a,o))}switch(t){case"input":vl(n),Wp(n,r,!1);break;case"textarea":vl(n),Jp(n);break;case"option":r.value!=null&&n.setAttribute("value",""+kr(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Js(n,!!r.multiple,i,!1):r.defaultValue!=null&&Js(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Ma)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Je(e),null;case 6:if(n&&e.stateNode!=null)Vv(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(O(166));if(t=zr(jo.current),zr(wn.current),Tl(e)){if(r=e.stateNode,t=e.memoizedProps,r[mn]=e,(i=r.nodeValue!==t)&&(n=Mt,n!==null))switch(n.tag){case 3:El(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&El(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[mn]=e,e.stateNode=r}return Je(e),null;case 13:if(ae(fe),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ue&&Ot!==null&&e.mode&1&&!(e.flags&128))lv(),ui(),e.flags|=98560,i=!1;else if(i=Tl(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(O(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(O(317));i[mn]=e}else ui(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Je(e),i=!1}else Xt!==null&&(Zd(Xt),Xt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||fe.current&1?Te===0&&(Te=3):Ih())),e.updateQueue!==null&&(e.flags|=4),Je(e),null);case 4:return di(),Wd(n,e),n===null&&Ro(e.stateNode.containerInfo),Je(e),null;case 10:return gh(e.type._context),Je(e),null;case 17:return gt(e.type)&&Aa(),Je(e),null;case 19:if(ae(fe),i=e.memoizedState,i===null)return Je(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Bi(i,!1);else{if(Te!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=La(n),o!==null){for(e.flags|=128,Bi(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return oe(fe,fe.current&1|2),e.child}n=n.sibling}i.tail!==null&&ve()>hi&&(e.flags|=128,r=!0,Bi(i,!1),e.lanes=4194304)}else{if(!r)if(n=La(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Bi(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ue)return Je(e),null}else 2*ve()-i.renderingStartTime>hi&&t!==1073741824&&(e.flags|=128,r=!0,Bi(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ve(),e.sibling=null,t=fe.current,oe(fe,r?t&1|2:t&1),e):(Je(e),null);case 22:case 23:return Ph(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Et&1073741824&&(Je(e),e.subtreeFlags&6&&(e.flags|=8192)):Je(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function jb(n,e){switch(fh(e),e.tag){case 1:return gt(e.type)&&Aa(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return di(),ae(mt),ae(Ye),xh(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return kh(e),null;case 13:if(ae(fe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(O(340));ui()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ae(fe),null;case 4:return di(),null;case 10:return gh(e.type._context),null;case 22:case 23:return Ph(),null;case 24:return null;default:return null}}var Al=!1,Qe=!1,Fb=typeof WeakSet=="function"?WeakSet:Set,R=null;function Us(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){me(n,e,r)}else t.current=null}function qd(n,e,t){try{t()}catch(r){me(n,e,r)}}var $m=!1;function zb(n,e){if(Md=Ea,n=K0(),ch(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,l=-1,a=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||s!==0&&d.nodeType!==3||(l=o+s),d!==i||r!==0&&d.nodeType!==3||(a=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++u===s&&(l=o),f===i&&++c===r&&(a=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=l===-1||a===-1?null:{start:l,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ad={focusedElem:n,selectionRange:t},Ea=!1,R=e;R!==null;)if(e=R,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,R=n;else for(;R!==null;){e=R;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,v=p.memoizedState,y=e.stateNode,g=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Jt(e.type,m),v);y.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(k){me(e,e.return,k)}if(n=e.sibling,n!==null){n.return=e.return,R=n;break}R=e.return}return p=$m,$m=!1,p}function ho(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&qd(e,t,i)}s=s.next}while(s!==r)}}function wu(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Jd(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Hv(n){var e=n.alternate;e!==null&&(n.alternate=null,Hv(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[mn],delete e[$o],delete e[Id],delete e[Sb],delete e[bb])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Wv(n){return n.tag===5||n.tag===3||n.tag===4}function Lm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Wv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Kd(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Ma));else if(r!==4&&(n=n.child,n!==null))for(Kd(n,e,t),n=n.sibling;n!==null;)Kd(n,e,t),n=n.sibling}function Gd(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Gd(n,e,t),n=n.sibling;n!==null;)Gd(n,e,t),n=n.sibling}var je=null,Gt=!1;function Vn(n,e,t){for(t=t.child;t!==null;)qv(n,e,t),t=t.sibling}function qv(n,e,t){if(vn&&typeof vn.onCommitFiberUnmount=="function")try{vn.onCommitFiberUnmount(du,t)}catch{}switch(t.tag){case 5:Qe||Us(t,e);case 6:var r=je,s=Gt;je=null,Vn(n,e,t),je=r,Gt=s,je!==null&&(Gt?(n=je,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):je.removeChild(t.stateNode));break;case 18:je!==null&&(Gt?(n=je,t=t.stateNode,n.nodeType===8?hc(n.parentNode,t):n.nodeType===1&&hc(n,t),No(n)):hc(je,t.stateNode));break;case 4:r=je,s=Gt,je=t.stateNode.containerInfo,Gt=!0,Vn(n,e,t),je=r,Gt=s;break;case 0:case 11:case 14:case 15:if(!Qe&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&qd(t,e,o),s=s.next}while(s!==r)}Vn(n,e,t);break;case 1:if(!Qe&&(Us(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(l){me(t,e,l)}Vn(n,e,t);break;case 21:Vn(n,e,t);break;case 22:t.mode&1?(Qe=(r=Qe)||t.memoizedState!==null,Vn(n,e,t),Qe=r):Vn(n,e,t);break;default:Vn(n,e,t)}}function jm(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Fb),e.forEach(function(r){var s=Gb.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function Wt(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:je=l.stateNode,Gt=!1;break e;case 3:je=l.stateNode.containerInfo,Gt=!0;break e;case 4:je=l.stateNode.containerInfo,Gt=!0;break e}l=l.return}if(je===null)throw Error(O(160));qv(i,o,s),je=null,Gt=!1;var a=s.alternate;a!==null&&(a.return=null),s.return=null}catch(u){me(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jv(e,n),e=e.sibling}function Jv(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Wt(e,n),ln(n),r&4){try{ho(3,n,n.return),wu(3,n)}catch(m){me(n,n.return,m)}try{ho(5,n,n.return)}catch(m){me(n,n.return,m)}}break;case 1:Wt(e,n),ln(n),r&512&&t!==null&&Us(t,t.return);break;case 5:if(Wt(e,n),ln(n),r&512&&t!==null&&Us(t,t.return),n.flags&32){var s=n.stateNode;try{To(s,"")}catch(m){me(n,n.return,m)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,l=n.type,a=n.updateQueue;if(n.updateQueue=null,a!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&m0(s,i),wd(l,o);var u=wd(l,i);for(o=0;o<a.length;o+=2){var c=a[o],d=a[o+1];c==="style"?k0(s,d):c==="dangerouslySetInnerHTML"?v0(s,d):c==="children"?To(s,d):Xf(s,c,d,u)}switch(l){case"input":pd(s,i);break;case"textarea":g0(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?Js(s,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?Js(s,!!i.multiple,i.defaultValue,!0):Js(s,!!i.multiple,i.multiple?[]:"",!1))}s[$o]=i}catch(m){me(n,n.return,m)}}break;case 6:if(Wt(e,n),ln(n),r&4){if(n.stateNode===null)throw Error(O(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(m){me(n,n.return,m)}}break;case 3:if(Wt(e,n),ln(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{No(e.containerInfo)}catch(m){me(n,n.return,m)}break;case 4:Wt(e,n),ln(n);break;case 13:Wt(e,n),ln(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ah=ve())),r&4&&jm(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Qe=(u=Qe)||c,Wt(e,n),Qe=u):Wt(e,n),ln(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(R=n,c=n.child;c!==null;){for(d=R=c;R!==null;){switch(f=R,h=f.child,f.tag){case 0:case 11:case 14:case 15:ho(4,f,f.return);break;case 1:Us(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){me(r,t,m)}}break;case 5:Us(f,f.return);break;case 22:if(f.memoizedState!==null){zm(d);continue}}h!==null?(h.return=f,R=h):zm(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=d.stateNode,a=d.memoizedProps.style,o=a!=null&&a.hasOwnProperty("display")?a.display:null,l.style.display=w0("display",o))}catch(m){me(n,n.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){me(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Wt(e,n),ln(n),r&4&&jm(n);break;case 21:break;default:Wt(e,n),ln(n)}}function ln(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Wv(t)){var r=t;break e}t=t.return}throw Error(O(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(To(s,""),r.flags&=-33);var i=Lm(n);Gd(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Lm(n);Kd(n,l,o);break;default:throw Error(O(161))}}catch(a){me(n,n.return,a)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Bb(n,e,t){R=n,Kv(n)}function Kv(n,e,t){for(var r=(n.mode&1)!==0;R!==null;){var s=R,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Al;if(!o){var l=s.alternate,a=l!==null&&l.memoizedState!==null||Qe;l=Al;var u=Qe;if(Al=o,(Qe=a)&&!u)for(R=s;R!==null;)o=R,a=o.child,o.tag===22&&o.memoizedState!==null?Bm(s):a!==null?(a.return=o,R=a):Bm(s);for(;i!==null;)R=i,Kv(i),i=i.sibling;R=s,Al=l,Qe=u}Fm(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,R=i):Fm(n)}}function Fm(n){for(;R!==null;){var e=R;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Qe||wu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Qe)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Jt(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&bm(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}bm(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&t.focus();break;case"img":a.src&&(t.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&No(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}Qe||e.flags&512&&Jd(e)}catch(f){me(e,e.return,f)}}if(e===n){R=null;break}if(t=e.sibling,t!==null){t.return=e.return,R=t;break}R=e.return}}function zm(n){for(;R!==null;){var e=R;if(e===n){R=null;break}var t=e.sibling;if(t!==null){t.return=e.return,R=t;break}R=e.return}}function Bm(n){for(;R!==null;){var e=R;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{wu(4,e)}catch(a){me(e,t,a)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(a){me(e,s,a)}}var i=e.return;try{Jd(e)}catch(a){me(e,i,a)}break;case 5:var o=e.return;try{Jd(e)}catch(a){me(e,o,a)}}}catch(a){me(e,e.return,a)}if(e===n){R=null;break}var l=e.sibling;if(l!==null){l.return=e.return,R=l;break}R=e.return}}var Ub=Math.ceil,za=Un.ReactCurrentDispatcher,Oh=Un.ReactCurrentOwner,Ft=Un.ReactCurrentBatchConfig,Z=0,Ie=null,ke=null,Ve=0,Et=0,Vs=_r(0),Te=0,Uo=null,ts=0,ku=0,Mh=0,po=null,ft=null,Ah=0,hi=1/0,On=null,Ba=!1,Qd=null,hr=null,Nl=!1,sr=null,Ua=0,mo=0,Xd=null,oa=-1,la=0;function rt(){return Z&6?ve():oa!==-1?oa:oa=ve()}function pr(n){return n.mode&1?Z&2&&Ve!==0?Ve&-Ve:Cb.transition!==null?(la===0&&(la=P0()),la):(n=te,n!==0||(n=window.event,n=n===void 0?16:F0(n.type)),n):1}function nn(n,e,t,r){if(50<mo)throw mo=0,Xd=null,Error(O(185));nl(n,t,r),(!(Z&2)||n!==Ie)&&(n===Ie&&(!(Z&2)&&(ku|=t),Te===4&&er(n,Ve)),yt(n,r),t===1&&Z===0&&!(e.mode&1)&&(hi=ve()+500,gu&&Cr()))}function yt(n,e){var t=n.callbackNode;CS(n,e);var r=Ca(n,n===Ie?Ve:0);if(r===0)t!==null&&Qp(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Qp(t),e===1)n.tag===0?_b(Um.bind(null,n)):sv(Um.bind(null,n)),kb(function(){!(Z&6)&&Cr()}),t=null;else{switch(I0(r)){case 1:t=nh;break;case 4:t=A0;break;case 16:t=_a;break;case 536870912:t=N0;break;default:t=_a}t=nw(t,Gv.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Gv(n,e){if(oa=-1,la=0,Z&6)throw Error(O(327));var t=n.callbackNode;if(Ys()&&n.callbackNode!==t)return null;var r=Ca(n,n===Ie?Ve:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Va(n,r);else{e=r;var s=Z;Z|=2;var i=Xv();(Ie!==n||Ve!==e)&&(On=null,hi=ve()+500,Wr(n,e));do try{Wb();break}catch(l){Qv(n,l)}while(!0);mh(),za.current=i,Z=s,ke!==null?e=0:(Ie=null,Ve=0,e=Te)}if(e!==0){if(e===2&&(s=_d(n),s!==0&&(r=s,e=Yd(n,s))),e===1)throw t=Uo,Wr(n,0),er(n,r),yt(n,ve()),t;if(e===6)er(n,r);else{if(s=n.current.alternate,!(r&30)&&!Vb(s)&&(e=Va(n,r),e===2&&(i=_d(n),i!==0&&(r=i,e=Yd(n,i))),e===1))throw t=Uo,Wr(n,0),er(n,r),yt(n,ve()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(O(345));case 2:Pr(n,ft,On);break;case 3:if(er(n,r),(r&130023424)===r&&(e=Ah+500-ve(),10<e)){if(Ca(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){rt(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Pd(Pr.bind(null,n,ft,On),e);break}Pr(n,ft,On);break;case 4:if(er(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-tn(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=ve()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ub(r/1960))-r,10<r){n.timeoutHandle=Pd(Pr.bind(null,n,ft,On),r);break}Pr(n,ft,On);break;case 5:Pr(n,ft,On);break;default:throw Error(O(329))}}}return yt(n,ve()),n.callbackNode===t?Gv.bind(null,n):null}function Yd(n,e){var t=po;return n.current.memoizedState.isDehydrated&&(Wr(n,e).flags|=256),n=Va(n,e),n!==2&&(e=ft,ft=t,e!==null&&Zd(e)),n}function Zd(n){ft===null?ft=n:ft.push.apply(ft,n)}function Vb(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!rn(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function er(n,e){for(e&=~Mh,e&=~ku,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-tn(e),r=1<<t;n[t]=-1,e&=~r}}function Um(n){if(Z&6)throw Error(O(327));Ys();var e=Ca(n,0);if(!(e&1))return yt(n,ve()),null;var t=Va(n,e);if(n.tag!==0&&t===2){var r=_d(n);r!==0&&(e=r,t=Yd(n,r))}if(t===1)throw t=Uo,Wr(n,0),er(n,e),yt(n,ve()),t;if(t===6)throw Error(O(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Pr(n,ft,On),yt(n,ve()),null}function Nh(n,e){var t=Z;Z|=1;try{return n(e)}finally{Z=t,Z===0&&(hi=ve()+500,gu&&Cr())}}function ns(n){sr!==null&&sr.tag===0&&!(Z&6)&&Ys();var e=Z;Z|=1;var t=Ft.transition,r=te;try{if(Ft.transition=null,te=1,n)return n()}finally{te=r,Ft.transition=t,Z=e,!(Z&6)&&Cr()}}function Ph(){Et=Vs.current,ae(Vs)}function Wr(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,wb(t)),ke!==null)for(t=ke.return;t!==null;){var r=t;switch(fh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Aa();break;case 3:di(),ae(mt),ae(Ye),xh();break;case 5:kh(r);break;case 4:di();break;case 13:ae(fe);break;case 19:ae(fe);break;case 10:gh(r.type._context);break;case 22:case 23:Ph()}t=t.return}if(Ie=n,ke=n=mr(n.current,null),Ve=Et=e,Te=0,Uo=null,Mh=ku=ts=0,ft=po=null,Fr!==null){for(e=0;e<Fr.length;e++)if(t=Fr[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Fr=null}return n}function Qv(n,e){do{var t=ke;try{if(mh(),ra.current=Fa,ja){for(var r=he.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ja=!1}if(es=0,Ae=Ce=he=null,fo=!1,Fo=0,Oh.current=null,t===null||t.return===null){Te=1,Uo=e,ke=null;break}e:{var i=n,o=t.return,l=t,a=e;if(e=Ve,l.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,c=l,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=Mm(o);if(h!==null){h.flags&=-257,Am(h,o,l,i,e),h.mode&1&&Om(i,u,e),e=h,a=u;var p=e.updateQueue;if(p===null){var m=new Set;m.add(a),e.updateQueue=m}else p.add(a);break e}else{if(!(e&1)){Om(i,u,e),Ih();break e}a=Error(O(426))}}else if(ue&&l.mode&1){var v=Mm(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Am(v,o,l,i,e),hh(fi(a,l));break e}}i=a=fi(a,l),Te!==4&&(Te=2),po===null?po=[i]:po.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=Iv(i,a,e);Sm(i,y);break e;case 1:l=a;var g=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(hr===null||!hr.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=Rv(i,l,e);Sm(i,k);break e}}i=i.return}while(i!==null)}Zv(t)}catch(S){e=S,ke===t&&t!==null&&(ke=t=t.return);continue}break}while(!0)}function Xv(){var n=za.current;return za.current=Fa,n===null?Fa:n}function Ih(){(Te===0||Te===3||Te===2)&&(Te=4),Ie===null||!(ts&268435455)&&!(ku&268435455)||er(Ie,Ve)}function Va(n,e){var t=Z;Z|=2;var r=Xv();(Ie!==n||Ve!==e)&&(On=null,Wr(n,e));do try{Hb();break}catch(s){Qv(n,s)}while(!0);if(mh(),Z=t,za.current=r,ke!==null)throw Error(O(261));return Ie=null,Ve=0,Te}function Hb(){for(;ke!==null;)Yv(ke)}function Wb(){for(;ke!==null&&!gS();)Yv(ke)}function Yv(n){var e=tw(n.alternate,n,Et);n.memoizedProps=n.pendingProps,e===null?Zv(n):ke=e,Oh.current=null}function Zv(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=jb(t,e),t!==null){t.flags&=32767,ke=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Te=6,ke=null;return}}else if(t=Lb(t,e,Et),t!==null){ke=t;return}if(e=e.sibling,e!==null){ke=e;return}ke=e=n}while(e!==null);Te===0&&(Te=5)}function Pr(n,e,t){var r=te,s=Ft.transition;try{Ft.transition=null,te=1,qb(n,e,t,r)}finally{Ft.transition=s,te=r}return null}function qb(n,e,t,r){do Ys();while(sr!==null);if(Z&6)throw Error(O(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(O(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(ES(n,i),n===Ie&&(ke=Ie=null,Ve=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Nl||(Nl=!0,nw(_a,function(){return Ys(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Ft.transition,Ft.transition=null;var o=te;te=1;var l=Z;Z|=4,Oh.current=null,zb(n,t),Jv(t,n),fb(Ad),Ea=!!Md,Ad=Md=null,n.current=t,Bb(t),yS(),Z=l,te=o,Ft.transition=i}else n.current=t;if(Nl&&(Nl=!1,sr=n,Ua=s),i=n.pendingLanes,i===0&&(hr=null),kS(t.stateNode),yt(n,ve()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ba)throw Ba=!1,n=Qd,Qd=null,n;return Ua&1&&n.tag!==0&&Ys(),i=n.pendingLanes,i&1?n===Xd?mo++:(mo=0,Xd=n):mo=0,Cr(),null}function Ys(){if(sr!==null){var n=I0(Ua),e=Ft.transition,t=te;try{if(Ft.transition=null,te=16>n?16:n,sr===null)var r=!1;else{if(n=sr,sr=null,Ua=0,Z&6)throw Error(O(331));var s=Z;for(Z|=4,R=n.current;R!==null;){var i=R,o=i.child;if(R.flags&16){var l=i.deletions;if(l!==null){for(var a=0;a<l.length;a++){var u=l[a];for(R=u;R!==null;){var c=R;switch(c.tag){case 0:case 11:case 15:ho(8,c,i)}var d=c.child;if(d!==null)d.return=c,R=d;else for(;R!==null;){c=R;var f=c.sibling,h=c.return;if(Hv(c),c===u){R=null;break}if(f!==null){f.return=h,R=f;break}R=h}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}R=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,R=o;else e:for(;R!==null;){if(i=R,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ho(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,R=y;break e}R=i.return}}var g=n.current;for(R=g;R!==null;){o=R;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,R=w;else e:for(o=g;R!==null;){if(l=R,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:wu(9,l)}}catch(S){me(l,l.return,S)}if(l===o){R=null;break e}var k=l.sibling;if(k!==null){k.return=l.return,R=k;break e}R=l.return}}if(Z=s,Cr(),vn&&typeof vn.onPostCommitFiberRoot=="function")try{vn.onPostCommitFiberRoot(du,n)}catch{}r=!0}return r}finally{te=t,Ft.transition=e}}return!1}function Vm(n,e,t){e=fi(t,e),e=Iv(n,e,1),n=fr(n,e,1),e=rt(),n!==null&&(nl(n,1,e),yt(n,e))}function me(n,e,t){if(n.tag===3)Vm(n,n,t);else for(;e!==null;){if(e.tag===3){Vm(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(hr===null||!hr.has(r))){n=fi(t,n),n=Rv(e,n,1),e=fr(e,n,1),n=rt(),e!==null&&(nl(e,1,n),yt(e,n));break}}e=e.return}}function Jb(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=rt(),n.pingedLanes|=n.suspendedLanes&t,Ie===n&&(Ve&t)===t&&(Te===4||Te===3&&(Ve&130023424)===Ve&&500>ve()-Ah?Wr(n,0):Mh|=t),yt(n,e)}function ew(n,e){e===0&&(n.mode&1?(e=xl,xl<<=1,!(xl&130023424)&&(xl=4194304)):e=1);var t=rt();n=Fn(n,e),n!==null&&(nl(n,e,t),yt(n,t))}function Kb(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),ew(n,t)}function Gb(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(O(314))}r!==null&&r.delete(e),ew(n,t)}var tw;tw=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||mt.current)pt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return pt=!1,$b(n,e,t);pt=!!(n.flags&131072)}else pt=!1,ue&&e.flags&1048576&&iv(e,Ia,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ia(n,e),n=e.pendingProps;var s=ai(e,Ye.current);Xs(e,t),s=bh(null,e,r,n,s,t);var i=_h();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gt(r)?(i=!0,Na(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,vh(e),s.updater=vu,e.stateNode=s,s._reactInternals=e,Fd(e,r,n,t),e=Ud(null,e,r,!0,i,t)):(e.tag=0,ue&&i&&dh(e),nt(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(ia(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Xb(r),n=Jt(r,n),s){case 0:e=Bd(null,e,r,n,t);break e;case 1:e=Im(null,e,r,n,t);break e;case 11:e=Nm(null,e,r,n,t);break e;case 14:e=Pm(null,e,r,Jt(r.type,n),t);break e}throw Error(O(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Jt(r,s),Bd(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Jt(r,s),Im(n,e,r,s,t);case 3:e:{if(jv(e),n===null)throw Error(O(387));r=e.pendingProps,i=e.memoizedState,s=i.element,dv(n,e),$a(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=fi(Error(O(423)),e),e=Rm(n,e,r,t,s);break e}else if(r!==s){s=fi(Error(O(424)),e),e=Rm(n,e,r,t,s);break e}else for(Ot=dr(e.stateNode.containerInfo.firstChild),Mt=e,ue=!0,Xt=null,t=uv(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ui(),r===s){e=zn(n,e,t);break e}nt(n,e,r,t)}e=e.child}return e;case 5:return fv(e),n===null&&$d(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,Nd(r,s)?o=null:i!==null&&Nd(r,i)&&(e.flags|=32),Lv(n,e),nt(n,e,o,t),e.child;case 6:return n===null&&$d(e),null;case 13:return Fv(n,e,t);case 4:return wh(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ci(e,null,r,t):nt(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Jt(r,s),Nm(n,e,r,s,t);case 7:return nt(n,e,e.pendingProps,t),e.child;case 8:return nt(n,e,e.pendingProps.children,t),e.child;case 12:return nt(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,oe(Ra,r._currentValue),r._currentValue=o,i!==null)if(rn(i.value,o)){if(i.children===s.children&&!mt.current){e=zn(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var a=l.firstContext;a!==null;){if(a.context===r){if(i.tag===1){a=Dn(-1,t&-t),a.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?a.next=a:(a.next=c.next,c.next=a),u.pending=a}}i.lanes|=t,a=i.alternate,a!==null&&(a.lanes|=t),Ld(i.return,t,e),l.lanes|=t;break}a=a.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(O(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Ld(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}nt(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xs(e,t),s=Vt(s),r=r(s),e.flags|=1,nt(n,e,r,t),e.child;case 14:return r=e.type,s=Jt(r,e.pendingProps),s=Jt(r.type,s),Pm(n,e,r,s,t);case 15:return Dv(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Jt(r,s),ia(n,e),e.tag=1,gt(r)?(n=!0,Na(e)):n=!1,Xs(e,t),Pv(e,r,s),Fd(e,r,s,t),Ud(null,e,r,!0,n,t);case 19:return zv(n,e,t);case 22:return $v(n,e,t)}throw Error(O(156,e.tag))};function nw(n,e){return M0(n,e)}function Qb(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lt(n,e,t,r){return new Qb(n,e,t,r)}function Rh(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Xb(n){if(typeof n=="function")return Rh(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Zf)return 11;if(n===eh)return 14}return 2}function mr(n,e){var t=n.alternate;return t===null?(t=Lt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function aa(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")Rh(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Is:return qr(t.children,s,i,e);case Yf:o=8,s|=8;break;case ud:return n=Lt(12,t,e,s|2),n.elementType=ud,n.lanes=i,n;case cd:return n=Lt(13,t,e,s),n.elementType=cd,n.lanes=i,n;case dd:return n=Lt(19,t,e,s),n.elementType=dd,n.lanes=i,n;case f0:return xu(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case c0:o=10;break e;case d0:o=9;break e;case Zf:o=11;break e;case eh:o=14;break e;case Kn:o=16,r=null;break e}throw Error(O(130,n==null?n:typeof n,""))}return e=Lt(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function qr(n,e,t,r){return n=Lt(7,n,r,e),n.lanes=t,n}function xu(n,e,t,r){return n=Lt(22,n,r,e),n.elementType=f0,n.lanes=t,n.stateNode={isHidden:!1},n}function xc(n,e,t){return n=Lt(6,n,null,e),n.lanes=t,n}function Sc(n,e,t){return e=Lt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Yb(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nc(0),this.expirationTimes=nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nc(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Dh(n,e,t,r,s,i,o,l,a){return n=new Yb(n,e,t,l,a),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Lt(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},vh(i),n}function Zb(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ps,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function rw(n){if(!n)return xr;n=n._reactInternals;e:{if(us(n)!==n||n.tag!==1)throw Error(O(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(n.tag===1){var t=n.type;if(gt(t))return rv(n,t,e)}return e}function sw(n,e,t,r,s,i,o,l,a){return n=Dh(t,r,!0,n,s,i,o,l,a),n.context=rw(null),t=n.current,r=rt(),s=pr(t),i=Dn(r,s),i.callback=e??null,fr(t,i,s),n.current.lanes=s,nl(n,s,r),yt(n,r),n}function Su(n,e,t,r){var s=e.current,i=rt(),o=pr(s);return t=rw(t),e.context===null?e.context=t:e.pendingContext=t,e=Dn(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=fr(s,e,o),n!==null&&(nn(n,s,o,i),na(n,s,o)),o}function Ha(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Hm(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function $h(n,e){Hm(n,e),(n=n.alternate)&&Hm(n,e)}function e_(){return null}var iw=typeof reportError=="function"?reportError:function(n){console.error(n)};function Lh(n){this._internalRoot=n}bu.prototype.render=Lh.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(O(409));Su(n,e,null,null)};bu.prototype.unmount=Lh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;ns(function(){Su(null,n,null,null)}),e[jn]=null}};function bu(n){this._internalRoot=n}bu.prototype.unstable_scheduleHydration=function(n){if(n){var e=$0();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Zn.length&&e!==0&&e<Zn[t].priority;t++);Zn.splice(t,0,n),t===0&&j0(n)}};function jh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function _u(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Wm(){}function t_(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Ha(o);i.call(u)}}var o=sw(e,r,n,0,null,!1,!1,"",Wm);return n._reactRootContainer=o,n[jn]=o.current,Ro(n.nodeType===8?n.parentNode:n),ns(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var u=Ha(a);l.call(u)}}var a=Dh(n,0,!1,null,null,!1,!1,"",Wm);return n._reactRootContainer=a,n[jn]=a.current,Ro(n.nodeType===8?n.parentNode:n),ns(function(){Su(e,a,t,r)}),a}function Cu(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var a=Ha(o);l.call(a)}}Su(e,o,n,s)}else o=t_(t,e,n,s,r);return Ha(o)}R0=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ki(e.pendingLanes);t!==0&&(rh(e,t|1),yt(e,ve()),!(Z&6)&&(hi=ve()+500,Cr()))}break;case 13:ns(function(){var r=Fn(n,1);if(r!==null){var s=rt();nn(r,n,1,s)}}),$h(n,1)}};sh=function(n){if(n.tag===13){var e=Fn(n,134217728);if(e!==null){var t=rt();nn(e,n,134217728,t)}$h(n,134217728)}};D0=function(n){if(n.tag===13){var e=pr(n),t=Fn(n,e);if(t!==null){var r=rt();nn(t,n,e,r)}$h(n,e)}};$0=function(){return te};L0=function(n,e){var t=te;try{return te=n,e()}finally{te=t}};xd=function(n,e,t){switch(e){case"input":if(pd(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=mu(r);if(!s)throw Error(O(90));p0(r),pd(r,s)}}}break;case"textarea":g0(n,t);break;case"select":e=t.value,e!=null&&Js(n,!!t.multiple,e,!1)}};b0=Nh;_0=ns;var n_={usingClientEntryPoint:!1,Events:[sl,Ls,mu,x0,S0,Nh]},Ui={findFiberByHostInstance:jr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},r_={bundleType:Ui.bundleType,version:Ui.version,rendererPackageName:Ui.rendererPackageName,rendererConfig:Ui.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Un.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=T0(n),n===null?null:n.stateNode},findFiberByHostInstance:Ui.findFiberByHostInstance||e_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pl.isDisabled&&Pl.supportsFiber)try{du=Pl.inject(r_),vn=Pl}catch{}}Nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n_;Nt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jh(e))throw Error(O(200));return Zb(n,e,null,t)};Nt.createRoot=function(n,e){if(!jh(n))throw Error(O(299));var t=!1,r="",s=iw;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Dh(n,1,!1,null,null,t,!1,r,s),n[jn]=e.current,Ro(n.nodeType===8?n.parentNode:n),new Lh(e)};Nt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(O(188)):(n=Object.keys(n).join(","),Error(O(268,n)));return n=T0(e),n=n===null?null:n.stateNode,n};Nt.flushSync=function(n){return ns(n)};Nt.hydrate=function(n,e,t){if(!_u(e))throw Error(O(200));return Cu(null,n,e,!0,t)};Nt.hydrateRoot=function(n,e,t){if(!jh(n))throw Error(O(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=iw;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=sw(e,null,n,1,t??null,s,!1,i,o),n[jn]=e.current,Ro(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new bu(e)};Nt.render=function(n,e,t){if(!_u(e))throw Error(O(200));return Cu(null,n,e,!1,t)};Nt.unmountComponentAtNode=function(n){if(!_u(n))throw Error(O(40));return n._reactRootContainer?(ns(function(){Cu(null,null,n,!1,function(){n._reactRootContainer=null,n[jn]=null})}),!0):!1};Nt.unstable_batchedUpdates=Nh;Nt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!_u(t))throw Error(O(200));if(n==null||n._reactInternals===void 0)throw Error(O(38));return Cu(n,e,t,!1,r)};Nt.version="18.3.1-next-f1338f8080-20240426";function ow(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ow)}catch(n){console.error(n)}}ow(),o0.exports=Nt;var lw=o0.exports;const s_=Ky(lw);var aw,qm=lw;aw=qm.createRoot,qm.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i_={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ee=(n,e)=>{const t=z.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:a,...u},c)=>z.createElement("svg",{ref:c,...i_,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:["lucide",`lucide-${o_(n)}`,l].join(" "),...u},[...e.map(([d,f])=>z.createElement(d,f)),...Array.isArray(a)?a:[a]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=ee("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l_=ee("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a_=ee("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jm=ee("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Km=ee("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u_=ee("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c_=ee("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=ee("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d_=ee("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f_=ee("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h_=ee("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p_=ee("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m_=ee("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gm=ee("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g_=ee("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y_=ee("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v_=ee("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w_=ee("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qm=ee("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_=ee("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x_=ee("Quote",[["path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z",key:"4rm80e"}],["path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z",key:"10za9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=ee("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S_=ee("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b_=ee("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fw=ee("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const __=ee("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=ee("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_=ee("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=ee("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=ee("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),O_=[{key:"facts",label:"Facts"},{key:"concepts",label:"Concepts"},{key:"opinions",label:"Opinions"},{key:"examples",label:"Examples"},{key:"other",label:"Other"}];function M_({rows:n,onAddRow:e,onDeleteRow:t,onUpdateTitle:r,onUpdateInput:s,onUpdatePrompt:i,onUpdateOutput:o,onToggleExpand:l,onToggleInputExpand:a,onUpdateSectionInput:u,onAddSectionInput:c,onRemoveSectionInput:d,onGenerateText:f,onImportDocument:h,isGeneratingDisabled:p=!1}){const m=z.useRef({}),v=async(g,w)=>{var S;const k=(S=g.target.files)==null?void 0:S[0];if(k)try{const b=await k.text();h(b),m.current[w]&&(m.current[w].value="")}catch(b){console.error("Error reading file:",b)}},y=(g,w,k)=>{const S=g.sectionInputs[w],b=g.expandedInputs[w];return x.jsxs("div",{className:"mb-4",children:[x.jsxs("div",{className:"flex items-center justify-between cursor-pointer p-2 bg-gray-700 rounded-lg hover:bg-gray-600",onClick:()=>a(g.id,w),children:[x.jsx("span",{className:"text-white font-medium",children:k}),b?x.jsx(Km,{className:"w-4 h-4 text-gray-300"}):x.jsx(Jm,{className:"w-4 h-4 text-gray-300"})]}),b&&x.jsxs("div",{className:"mt-2 space-y-2",children:[S.map((_,C)=>x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("textarea",{value:_,onChange:T=>u(g.id,w,C,T.target.value),className:"flex-1 p-2 bg-gray-600 text-white rounded custom-scrollbar min-h-[60px] resize-y border border-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:`Enter ${k.toLowerCase()}...`,rows:2}),S.length>1&&x.jsx("button",{onClick:()=>d(g.id,w,C),className:"p-1 text-gray-400 hover:text-red-400",title:`Remove ${k}`,children:x.jsx(Eu,{className:"w-4 h-4"})})]},C)),x.jsxs("button",{onClick:()=>c(g.id,w),className:"w-full p-2 bg-gray-600 text-gray-300 rounded hover:bg-gray-500 flex items-center justify-center text-sm",children:[x.jsx(Qm,{className:"w-4 h-4 mr-1"})," Add ",k]})]})]},w)};return x.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-4",children:[n.map((g,w)=>x.jsxs("div",{className:"bg-gray-200 dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[x.jsxs("div",{className:"p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-4",children:[x.jsxs("div",{className:"flex-grow flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 w-full sm:w-auto",children:[x.jsxs("span",{className:"text-lg font-semibold text-gray-900 dark:text-white whitespace-nowrap",children:["Section ",w+1]}),x.jsx("input",{type:"text",value:g.title,onChange:k=>r(g.id,k.target.value),className:"flex-grow w-full sm:w-auto p-1.5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 text-sm sm:text-base",placeholder:"Enter section title..."}),x.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 dark:text-gray-400 text-sm whitespace-nowrap",children:[x.jsxs("span",{children:[g.aiPrompt.wordCount," words"]}),x.jsx("span",{children:""}),x.jsxs("span",{className:"capitalize",children:[g.aiPrompt.tone," tone"]})]})]}),x.jsxs("div",{className:"flex items-center space-x-2 self-end sm:self-center",children:[x.jsx("button",{onClick:()=>l(g.id),className:"flex items-center px-2 py-1 sm:px-3 sm:py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs sm:text-sm",children:g.isExpanded?x.jsxs(x.Fragment,{children:[x.jsx(Km,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"})," Collapse"]}):x.jsxs(x.Fragment,{children:[x.jsx(Jm,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"})," Expand"]})}),x.jsxs("button",{onClick:()=>t(g.id),disabled:n.length<=1,className:`flex items-center px-2 py-1 sm:px-3 sm:py-1 bg-red-600 text-white rounded hover:bg-red-700 text-xs sm:text-sm ${n.length<=1?"opacity-50 cursor-not-allowed":""}`,children:[x.jsx(fw,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"})," Delete"]})]})]}),g.isExpanded&&x.jsx("div",{className:"px-4 pb-4 pt-2 border-t border-gray-300 dark:border-gray-700",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-black dark:text-white mb-3",children:"Context"}),x.jsx("div",{className:"space-y-2",children:O_.map(k=>y(g,k.key,k.label))}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("input",{type:"file",ref:k=>m.current[g.id]=k,onChange:k=>v(k,g.id),accept:".txt,.md,.rtf",className:"hidden"}),x.jsxs("button",{onClick:()=>{var k;return(k=m.current[g.id])==null?void 0:k.click()},className:"w-full p-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-gray-300 rounded hover:bg-gray-400 dark:hover:bg-gray-500 flex items-center justify-center text-sm",children:[x.jsx(C_,{className:"w-4 h-4 mr-1"})," Import Text File (.txt, .md)"]}),x.jsx("textarea",{value:g.input,onChange:k=>s(g.id,k.target.value),className:"w-full h-20 p-3 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg resize-y custom-scrollbar border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Enter your base text or import a file..."})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-black dark:text-white mb-3",children:"Prompt"}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Word Count Target"}),x.jsx("input",{type:"number",value:g.aiPrompt.wordCount,onChange:k=>i(g.id,"wordCount",parseInt(k.target.value)||0),className:"w-full p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Approx words",min:"10"}),x.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tone"}),x.jsxs("select",{value:g.aiPrompt.tone,onChange:k=>i(g.id,"tone",k.target.value),className:"w-full p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:[x.jsx("option",{value:"professional",children:"Professional"}),x.jsx("option",{value:"casual",children:"Casual"}),x.jsx("option",{value:"formal",children:"Formal"}),x.jsx("option",{value:"friendly",children:"Friendly"}),x.jsx("option",{value:"informative",children:"Informative"}),x.jsx("option",{value:"persuasive",children:"Persuasive"})]}),x.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Prompt"}),x.jsx("textarea",{value:g.aiPrompt.prompt,onChange:k=>i(g.id,"prompt",k.target.value),className:"w-full h-40 p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded resize-y custom-scrollbar border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"e.g., focus on benefits, mention specific product..."}),x.jsx("button",{onClick:()=>f(g.id),disabled:g.isLoading||p,className:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",title:p?"OpenAI not initialized. Check .env settings.":"Generate text for this section",children:g.isLoading?x.jsx(cw,{className:"w-5 h-5 animate-spin"}):"Generate Text"})]})]})]})}),x.jsx("div",{className:`px-4 pb-4 ${g.isExpanded?"pt-4 border-t border-gray-300 dark:border-gray-700":"pt-2"}`,children:x.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] p-4",children:g.error?x.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm",children:g.error}):x.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-gray-800 dark:text-gray-300 custom-scrollbar leading-relaxed",dangerouslySetInnerHTML:{__html:g.output||'<p class="text-gray-500 dark:text-gray-400 italic">No output generated yet.</p>'}})})})]},g.id)),x.jsxs("button",{onClick:e,className:"w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center",children:[x.jsx(Qm,{className:"w-5 h-5 mr-2"})," Add New Section"]})]})}function A_({theme:n,onThemeChange:e}){return x.jsx("button",{onClick:()=>e(n==="dark"?"light":"dark"),className:"fixed top-4 right-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:n==="dark"?x.jsx(b_,{className:"w-5 h-5 text-yellow-500"}):x.jsx(v_,{className:"w-5 h-5 text-gray-700"})})}function Fe(n){this.content=n}Fe.prototype={constructor:Fe,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,s=r.find(n),i=r.content.slice();return s==-1?i.push(t||n,e):(i[s+1]=e,t&&(i[s]=t)),new Fe(i)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new Fe(t)},addToStart:function(n,e){return new Fe([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new Fe(t)},addBefore:function(n,e,t){var r=this.remove(e),s=r.content.slice(),i=r.find(n);return s.splice(i==-1?s.length:i,0,e,t),new Fe(s)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=Fe.from(n),n.size?new Fe(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Fe.from(n),n.size?new Fe(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=Fe.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};Fe.from=function(n){if(n instanceof Fe)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new Fe(e)};function hw(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let s=n.child(r),i=e.child(r);if(s==i){t+=s.nodeSize;continue}if(!s.sameMarkup(i))return t;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)t++;return t}if(s.content.size||i.content.size){let o=hw(s.content,i.content,t+1);if(o!=null)return o}t+=s.nodeSize}}function pw(n,e,t,r){for(let s=n.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:t,b:r};let o=n.child(--s),l=e.child(--i),a=o.nodeSize;if(o==l){t-=a,r-=a;continue}if(!o.sameMarkup(l))return{a:t,b:r};if(o.isText&&o.text!=l.text){let u=0,c=Math.min(o.text.length,l.text.length);for(;u<c&&o.text[o.text.length-u-1]==l.text[l.text.length-u-1];)u++,t--,r--;return{a:t,b:r}}if(o.content.size||l.content.size){let u=pw(o.content,l.content,t-1,r-1);if(u)return u}t-=a,r-=a}}class E{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,s=0,i){for(let o=0,l=0;l<t;o++){let a=this.content[o],u=l+a.nodeSize;if(u>e&&r(a,s+l,i||null,o)!==!1&&a.content.size){let c=l+1;a.nodesBetween(Math.max(0,e-c),Math.min(a.content.size,t-c),r,s+c)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,s){let i="",o=!0;return this.nodesBetween(e,t,(l,a)=>{let u=l.isText?l.text.slice(Math.max(e,a)-a,t-a):l.isLeaf?s?typeof s=="function"?s(l):s:l.type.spec.leafText?l.type.spec.leafText(l):"":"";l.isBlock&&(l.isLeaf&&u||l.isTextblock)&&r&&(o?o=!1:i+=r),i+=u},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(r)&&(s[s.length-1]=t.withText(t.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new E(s,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],s=0;if(t>e)for(let i=0,o=0;o<t;i++){let l=this.content[i],a=o+l.nodeSize;a>e&&((o<e||a>t)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,t-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,t-o-1))),r.push(l),s+=l.nodeSize),o=a}return new E(r,s)}cutByIndex(e,t){return e==t?E.empty:e==0&&t==this.content.length?this:new E(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let s=this.content.slice(),i=this.size+t.nodeSize-r.nodeSize;return s[e]=t,new E(s,i)}addToStart(e){return new E([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new E(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let s=this.content[t];e(s,r,t),r+=s.nodeSize}}findDiffStart(e,t=0){return hw(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return pw(this,e,t,r)}findIndex(e,t=-1){if(e==0)return Il(0,e);if(e==this.size)return Il(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,s=0;;r++){let i=this.child(r),o=s+i.nodeSize;if(o>=e)return o==e||t>0?Il(r+1,o):Il(r,s);s=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return E.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new E(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return E.empty;let t,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(t||(t=e.slice(0,s)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new E(t||e,r)}static from(e){if(!e)return E.empty;if(e instanceof E)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new E([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}E.empty=new E([],0);const bc={index:0,offset:0};function Il(n,e){return bc.index=n,bc.offset=e,bc}function Wa(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!Wa(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!Wa(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}let se=class ef{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),r=!0),t&&t.push(i)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Wa(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=r.create(t.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return ef.none;if(e instanceof ef)return[e];let t=e.slice();return t.sort((r,s)=>r.type.rank-s.type.rank),t}};se.none=[];class qa extends Error{}class N{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=gw(this.content,e+this.openStart,t);return r&&new N(r,this.openStart,this.openEnd)}removeBetween(e,t){return new N(mw(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return N.empty;let r=t.openStart||0,s=t.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new N(E.fromJSON(e,t.content),r,s)}static maxOpen(e,t=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)s++;return new N(e,r,s)}}N.empty=new N(E.empty,0,0);function mw(n,e,t){let{index:r,offset:s}=n.findIndex(e),i=n.maybeChild(r),{index:o,offset:l}=n.findIndex(t);if(s==e||i.isText){if(l!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,i.copy(mw(i.content,e-s-1,t-s-1)))}function gw(n,e,t,r){let{index:s,offset:i}=n.findIndex(e),o=n.maybeChild(s);if(i==e||o.isText)return n.cut(0,e).append(t).append(n.cut(e));let l=gw(o.content,e-i-1,t);return l&&n.replaceChild(s,o.copy(l))}function N_(n,e,t){if(t.openStart>n.depth)throw new qa("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new qa("Inconsistent open depths");return yw(n,e,t,0)}function yw(n,e,t,r){let s=n.index(r),i=n.node(r);if(s==e.index(r)&&r<n.depth-t.openStart){let o=yw(n,e,t,r+1);return i.copy(i.content.replaceChild(s,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let o=n.parent,l=o.content;return Kr(o,l.cut(0,n.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=P_(t,n);return Kr(i,ww(n,o,l,e,r))}else return Kr(i,Ja(n,e,r))}function vw(n,e){if(!e.type.compatibleContent(n.type))throw new qa("Cannot join "+e.type.name+" onto "+n.type.name)}function tf(n,e,t){let r=n.node(t);return vw(r,e.node(t)),r}function Jr(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function go(n,e,t,r){let s=(e||n).node(t),i=0,o=e?e.index(t):s.childCount;n&&(i=n.index(t),n.depth>t?i++:n.textOffset&&(Jr(n.nodeAfter,r),i++));for(let l=i;l<o;l++)Jr(s.child(l),r);e&&e.depth==t&&e.textOffset&&Jr(e.nodeBefore,r)}function Kr(n,e){return n.type.checkContent(e),n.copy(e)}function ww(n,e,t,r,s){let i=n.depth>s&&tf(n,e,s+1),o=r.depth>s&&tf(t,r,s+1),l=[];return go(null,n,s,l),i&&o&&e.index(s)==t.index(s)?(vw(i,o),Jr(Kr(i,ww(n,e,t,r,s+1)),l)):(i&&Jr(Kr(i,Ja(n,e,s+1)),l),go(e,t,s,l),o&&Jr(Kr(o,Ja(t,r,s+1)),l)),go(r,null,s,l),new E(l)}function Ja(n,e,t){let r=[];if(go(null,n,t,r),n.depth>t){let s=tf(n,e,t+1);Jr(Kr(s,Ja(n,e,t+1)),r)}return go(e,null,t,r),new E(r)}function P_(n,e){let t=e.depth-n.openStart,s=e.node(t).copy(n.content);for(let i=t-1;i>=0;i--)s=e.node(i).copy(E.from(s));return{start:s.resolveNoCache(n.openStart+t),end:s.resolveNoCache(s.content.size-n.openEnd-t)}}class Vo{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(t);return r?e.child(t).cut(r):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],s=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return se.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),s=e.maybeChild(t);if(!r){let l=r;r=s,s=l}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new Ka(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],s=0,i=t;for(let o=e;;){let{index:l,offset:a}=o.content.findIndex(i),u=i-a;if(r.push(o,l,s+a),!u||(o=o.child(l),o.isText))break;i=u-1,s+=a+1}return new Vo(t,r,i)}static resolveCached(e,t){let r=Xm.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==t)return o}else Xm.set(e,r=new I_);let s=r.elts[r.i]=Vo.resolve(e,t);return r.i=(r.i+1)%R_,s}}class I_{constructor(){this.elts=[],this.i=0}}const R_=12,Xm=new WeakMap;class Ka{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const D_=Object.create(null);let gr=class nf{constructor(e,t,r,s=se.none){this.type=e,this.attrs=t,this.marks=s,this.content=r||E.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,s=0){this.content.nodesBetween(e,t,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,s){return this.content.textBetween(e,t,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&Wa(this.attrs,t||e.defaultAttrs||D_)&&se.sameSet(this.marks,r||se.none)}copy(e=null){return e==this.content?this:new nf(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new nf(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return N.empty;let s=this.resolve(e),i=this.resolve(t),o=r?0:s.sharedDepth(t),l=s.start(o),u=s.node(o).content.cut(s.pos-l,i.pos-l);return new N(u,s.depth-o,i.depth-o)}replace(e,t,r){return N_(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let s=this.content.child(t-1);return{node:s,index:t-1,offset:r-s.nodeSize}}resolve(e){return Vo.resolveCached(this,e)}resolveNoCache(e){return Vo.resolve(this,e)}rangeHasMark(e,t,r){let s=!1;return t>e&&this.nodesBetween(e,t,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),kw(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=E.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),l=o&&o.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let a=s;a<i;a++)if(!this.type.allowsMarks(r.child(a).marks))return!1;return!0}canReplaceWith(e,t,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=se.none;for(let t=0;t<this.marks.length;t++){let r=this.marks[t];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!se.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let s=E.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};gr.prototype.text=void 0;class Ga extends gr{constructor(e,t,r,s){if(super(e,t,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):kw(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ga(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ga(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function kw(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class rs{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new $_(e,t);if(r.next==null)return rs.empty;let s=xw(r);r.next&&r.err("Unexpected trailing text");let i=V_(U_(s));return H_(i,r),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let s=this;for(let i=t;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let s=[this];function i(o,l){let a=o.matchFragment(e,r);if(a&&(!t||a.validEnd))return E.from(l.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:c,next:d}=o.next[u];if(!(c.isText||c.hasRequiredAttrs())&&s.indexOf(d)==-1){s.push(d);let f=i(d,l.concat(c));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let l=s;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:l,next:a}=i.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!s.type||a.validEnd)&&(r.push({match:l.contentMatch,type:l,via:s}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&t(r.next[s].next)}return t(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}rs.empty=new rs(!0);class $_{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function xw(n){let e=[];do e.push(L_(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function L_(n){let e=[];do e.push(j_(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function j_(n){let e=B_(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=F_(n,e);else break;return e}function Ym(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function F_(n,e){let t=Ym(n),r=t;return n.eat(",")&&(n.next!="}"?r=Ym(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function z_(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let s=[];for(let i in t){let o=t[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&n.err("No node type or group '"+e+"' found"),s}function B_(n){if(n.eat("(")){let e=xw(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=z_(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function U_(n){let e=[[]];return s(i(n,0),t()),e;function t(){return e.push([])-1}function r(o,l,a){let u={term:a,to:l};return e[o].push(u),u}function s(o,l){o.forEach(a=>a.to=l)}function i(o,l){if(o.type=="choice")return o.exprs.reduce((a,u)=>a.concat(i(u,l)),[]);if(o.type=="seq")for(let a=0;;a++){let u=i(o.exprs[a],l);if(a==o.exprs.length-1)return u;s(u,l=t())}else if(o.type=="star"){let a=t();return r(l,a),s(i(o.expr,a),a),[r(a)]}else if(o.type=="plus"){let a=t();return s(i(o.expr,l),a),s(i(o.expr,a),a),[r(a)]}else{if(o.type=="opt")return[r(l)].concat(i(o.expr,l));if(o.type=="range"){let a=l;for(let u=0;u<o.min;u++){let c=t();s(i(o.expr,a),c),a=c}if(o.max==-1)s(i(o.expr,a),a);else for(let u=o.min;u<o.max;u++){let c=t();r(a,c),s(i(o.expr,a),c),a=c}return[r(a)]}else{if(o.type=="name")return[r(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Sw(n,e){return e-n}function Zm(n,e){let t=[];return r(e),t.sort(Sw);function r(s){let i=n[s];if(i.length==1&&!i[0].term)return r(i[0].to);t.push(s);for(let o=0;o<i.length;o++){let{term:l,to:a}=i[o];!l&&t.indexOf(a)==-1&&r(a)}}}function V_(n){let e=Object.create(null);return t(Zm(n,0));function t(r){let s=[];r.forEach(o=>{n[o].forEach(({term:l,to:a})=>{if(!l)return;let u;for(let c=0;c<s.length;c++)s[c][0]==l&&(u=s[c][1]);Zm(n,a).forEach(c=>{u||s.push([l,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let i=e[r.join(",")]=new rs(r.indexOf(n.length-1)>-1);for(let o=0;o<s.length;o++){let l=s[o][1].sort(Sw);i.next.push({type:s[o][0],next:e[l.join(",")]||t(l)})}return i}}function H_(n,e){for(let t=0,r=[n];t<r.length;t++){let s=r[t],i=!s.validEnd,o=[];for(let l=0;l<s.next.length;l++){let{type:a,next:u}=s.next[l];o.push(a.name),i&&!(a.isText||a.hasRequiredAttrs())&&(i=!1),r.indexOf(u)==-1&&r.push(u)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function bw(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}function _w(n,e){let t=Object.create(null);for(let r in n){let s=e&&e[r];if(s===void 0){let i=n[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=s}return t}function Cw(n,e,t,r){for(let s in e)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${t} of type ${s}`);for(let s in n){let i=n[s];i.validate&&i.validate(e[s])}}function Ew(n,e){let t=Object.create(null);if(e)for(let r in e)t[r]=new q_(n,r,e[r]);return t}let eg=class Tw{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Ew(e,r.attrs),this.defaultAttrs=bw(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==rs.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:_w(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new gr(this,this.computeAttrs(e),E.from(t),se.setFrom(r))}createChecked(e=null,t,r){return t=E.from(t),this.checkContent(t),new gr(this,this.computeAttrs(e),t,se.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=E.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let s=this.contentMatch.matchFragment(t),i=s&&s.fillBefore(E.empty,!0);return i?new gr(this,e,t.append(i),se.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Cw(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:se.none:e}static compile(e,t){let r=Object.create(null);e.forEach((i,o)=>r[i]=new Tw(i,t,o));let s=t.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function W_(n,e,t){let r=t.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${n}, got ${i}`)}}class q_{constructor(e,t,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?W_(e,t,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Tu{constructor(e,t,r,s){this.name=e,this.rank=t,this.schema=r,this.spec=s,this.attrs=Ew(e,s.attrs),this.excluded=null;let i=bw(this.attrs);this.instance=i?new se(this,i):null}create(e=null){return!e&&this.instance?this.instance:new se(this,_w(this.attrs,e))}static compile(e,t){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Tu(i,s++,t,o)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Cw(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Ow{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=Fe.from(e.nodes),t.marks=Fe.from(e.marks||{}),this.nodes=eg.compile(this.spec.nodes,this),this.marks=Tu.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",l=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=rs.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=l=="_"?null:l?tg(this,l.split(" ")):l==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:tg(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof eg){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,s)}text(e,t){let r=this.nodes.text;return new Ga(r,r.defaultAttrs,e,se.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return gr.fromJSON(this,e)}markFromJSON(e){return se.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function tg(n,e){let t=[];for(let r=0;r<e.length;r++){let s=e[r],i=n.marks[s],o=i;if(i)t.push(i);else for(let l in n.marks){let a=n.marks[l];(s=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(s)>-1)&&t.push(o=a)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}function J_(n){return n.tag!=null}function K_(n){return n.style!=null}let yo=class rf{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let r=this.matchedStyles=[];t.forEach(s=>{if(J_(s))this.tags.push(s);else if(K_(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new rg(this,t,!1);return r.addAll(e,se.none,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new rg(this,t,!0);return r.addAll(e,se.none,t.from,t.to),N.maxOpen(r.finish())}matchTag(e,t,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(X_(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,t,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(o.getAttrs){let a=o.getAttrs(t);if(a===!1)continue;o.attrs=a||void 0}return o}}}static schemaRules(e){let t=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<t.length;o++){let l=t[o];if((l.priority==null?50:l.priority)<i)break}t.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=sg(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=sg(o)),o.node||o.ignore||o.mark||(o.node=s)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new rf(e,rf.schemaRules(e)))}};const Mw={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},G_={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Aw={ol:!0,ul:!0},Ho=1,sf=2,vo=4;function ng(n,e,t){return e!=null?(e?Ho:0)|(e==="full"?sf:0):n&&n.whitespace=="pre"?Ho|sf:t&~vo}class Rl{constructor(e,t,r,s,i,o){this.type=e,this.attrs=t,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=se.none,this.match=i||(o&vo?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(E.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Ho)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let t=E.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(E.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Mw.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class rg{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=t.topNode,i,o=ng(null,t.preserveWhitespace,0)|(r?vo:0);s?i=new Rl(s.type,s.attrs,se.none,!0,t.topMatch||s.type.contentMatch,o):r?i=new Rl(null,null,se.none,!0,null,o):i=new Rl(e.schema.topNodeType,null,se.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let r=e.nodeValue,s=this.top,i=s.options&sf?"full":this.localPreserveWS||(s.options&Ho)>0;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)i!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let o=s.content[s.content.length-1],l=e.previousSibling;(!o||l&&l.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),t),this.findInText(e)}else this.findInside(e)}addElement(e,t,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),l;Aw.hasOwnProperty(o)&&this.parser.normalizeLists&&Q_(e);let a=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(l=this.parser.matchTag(e,this,r));e:if(a?a.ignore:G_.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(e=a.skip);let u,c=this.needsBlock;if(Mw.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),u=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=a&&a.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),u&&this.sync(i),this.needsBlock=c}else{let u=this.readStyles(e,t);u&&this.addElementByRule(e,a,u,a.consuming===!1?l:void 0)}this.localPreserveWS=s}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t)}readStyles(e,t){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let l=void 0;;){let a=this.parser.matchStyle(i,o,this,l);if(!a)break;if(a.ignore)return null;if(a.clearMark?t=t.filter(u=>!a.clearMark(u)):t=t.concat(this.parser.schema.marks[a.mark].create(a.attrs)),a.consuming===!1)l=a;else break}}return t}addElementByRule(e,t,r,s){let i,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),r)||this.leafFallback(e,r);else{let a=this.enter(o,t.attrs||null,r,t.preserveWhitespace);a&&(i=!0,r=a)}else{let a=this.parser.schema.marks[t.mark];r=r.concat(a.create(t.attrs))}let l=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a,r));else{let a=e;typeof t.contentElement=="string"?a=e.querySelector(t.contentElement):typeof t.contentElement=="function"?a=t.contentElement(e):t.contentElement&&(a=t.contentElement),this.findAround(e,a,!0),this.addAll(a,r),this.findAround(e,a,!1)}i&&this.sync(l)&&this.open--}addAll(e,t,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,l=s==null?null:e.childNodes[s];o!=l;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t){let r,s;for(let i=this.open;i>=0;i--){let o=this.nodes[i],l=o.findWrapping(e);if(l&&(!r||r.length>l.length)&&(r=l,s=o,!l.length)||o.solid)break}if(!r)return null;this.sync(s);for(let i=0;i<r.length;i++)t=this.enterInner(r[i],null,t,!1);return t}insertNode(e,t){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(t=this.enterInner(s,null,t))}let r=this.findPlace(e,t);if(r){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let i=se.none;for(let o of r.concat(e.marks))(s.type?s.type.allowsMarkType(o.type):ig(o.type,e.type))&&(i=o.addToSet(i));return s.content.push(e.mark(i)),!0}return!1}enter(e,t,r,s){let i=this.findPlace(e.create(t),r);return i&&(i=this.enterInner(e,t,r,!0,s)),i}enterInner(e,t,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let l=ng(e,i,o.options);o.options&vo&&o.content.length==0&&(l|=vo);let a=se.none;return r=r.filter(u=>(o.type?o.type.allowsMarkType(u.type):ig(u.type,e))?(a=u.addToSet(a),!1):!0),this.nodes.push(new Rl(e,t,a,s,null,l)),this.open++,r}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Ho)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&t.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(l,a)=>{for(;l>=0;l--){let u=t[l];if(u==""){if(l==t.length-1||l==0)continue;for(;a>=i;a--)if(o(l-1,a))return!0;return!1}else{let c=a>0||a==0&&s?this.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;a--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}}function Q_(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Aw.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function X_(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function sg(n){let e={};for(let t in n)e[t]=n[t];return e}function ig(n,e){let t=e.schema.nodes;for(let r in t){let s=t[r];if(!s.allowsMarkType(n))continue;let i=[],o=l=>{i.push(l);for(let a=0;a<l.edgeCount;a++){let{type:u,next:c}=l.edge(a);if(u==e||i.indexOf(c)<0&&o(c))return!0}};if(o(s.contentMatch))return!0}}class cs{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=_c(t).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let l=0,a=0;for(;l<i.length&&a<o.marks.length;){let u=o.marks[a];if(!this.marks[u.type.name]){a++;continue}if(!u.eq(i[l][0])||u.type.spec.spanning===!1)break;l++,a++}for(;l<i.length;)s=i.pop()[1];for(;a<o.marks.length;){let u=o.marks[a++],c=this.serializeMark(u,o.isInline,t);c&&(i.push([u,s]),s.appendChild(c.dom),s=c.contentDOM||c.dom)}}s.appendChild(this.serializeNodeInner(o,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:s}=ca(_c(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,t,r={}){let s=this.marks[e.type.name];return s&&ca(_c(r),s(e,t),null,e.attrs)}static renderSpec(e,t,r=null,s){return ca(e,t,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new cs(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=og(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return og(e.marks)}}function og(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function _c(n){return n.document||window.document}const lg=new WeakMap;function Y_(n){let e=lg.get(n);return e===void 0&&lg.set(n,e=Z_(n)),e}function Z_(n){let e=null;function t(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)t(r[s]);else for(let s in r)t(r[s])}return t(n),e}function ca(n,e,t,r){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=Y_(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(t=s.slice(0,o),s=s.slice(o+1));let l,a=t?n.createElementNS(t,s):n.createElement(s),u=e[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let d in u)if(u[d]!=null){let f=d.indexOf(" ");f>0?a.setAttributeNS(d.slice(0,f),d.slice(f+1),u[d]):a.setAttribute(d,u[d])}}for(let d=c;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:h,contentDOM:p}=ca(n,f,t,r);if(a.appendChild(h),p){if(l)throw new RangeError("Multiple content holes");l=p}}}return{dom:a,contentDOM:l}}const Nw=65535,Pw=Math.pow(2,16);function eC(n,e){return n+e*Pw}function ag(n){return n&Nw}function tC(n){return(n-(n&Nw))/Pw}const Iw=1,Rw=2,da=4,Dw=8;class of{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&Dw)>0}get deletedBefore(){return(this.delInfo&(Iw|da))>0}get deletedAfter(){return(this.delInfo&(Rw|da))>0}get deletedAcross(){return(this.delInfo&da)>0}}class Tt{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Tt.empty)return Tt.empty}recover(e){let t=0,r=ag(e);if(!this.inverted)for(let s=0;s<r;s++)t+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+t+tC(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?s:0);if(a>e)break;let u=this.ranges[l+i],c=this.ranges[l+o],d=a+u;if(e<=d){let f=u?e==a?-1:e==d?1:t:t,h=a+s+(f<0?0:c);if(r)return h;let p=e==(t<0?a:d)?null:eC(l/3,e-a),m=e==a?Rw:e==d?Iw:da;return(t<0?e!=a:e!=d)&&(m|=Dw),new of(h,m,p)}s+=c-u}return r?e+s:new of(e+s,0,null)}touches(e,t){let r=0,s=ag(t),i=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?r:0);if(a>e)break;let u=this.ranges[l+i],c=a+u;if(e<=c&&l==s*3)return!0;r+=this.ranges[l+o]-u}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],l=o-(this.inverted?i:0),a=o+(this.inverted?0:i),u=this.ranges[s+t],c=this.ranges[s+r];e(l,l+u,a,a+c),i+=c-u}}invert(){return new Tt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Tt.empty:new Tt(e<0?[0,-e,0]:[0,0,e])}}Tt.empty=new Tt([]);class Wo{constructor(e,t,r=0,s=e?e.length:0){this.mirror=t,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Wo(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,r=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],s!=null&&s<t?r+s:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),s!=null&&s>t?r-s-1:void 0)}}invert(){let e=new Wo;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],l=o.mapResult(e,t);if(l.recover!=null){let a=this.getMirror(i);if(a!=null&&a>i&&a<this.to){i=a,e=this._maps[a].recover(l.recover);continue}}s|=l.delInfo,e=l.pos}return r?e:new of(e,s,null)}}const Cc=Object.create(null);class et{getMap(){return Tt.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Cc[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Cc)throw new RangeError("Duplicate use of step JSON ID "+e);return Cc[e]=t,t.prototype.jsonID=e,t}}class xe{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new xe(e,null)}static fail(e){return new xe(null,e)}static fromReplace(e,t,r,s){try{return xe.ok(e.replace(t,r,s))}catch(i){if(i instanceof qa)return xe.fail(i.message);throw i}}}function Fh(n,e,t){let r=[];for(let s=0;s<n.childCount;s++){let i=n.child(s);i.content.size&&(i=i.copy(Fh(i.content,e,i))),i.isInline&&(i=e(i,t,s)),r.push(i)}return E.fromArray(r)}class ir extends et{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new N(Fh(t.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),t.openStart,t.openEnd);return xe.fromReplace(e,this.from,this.to,i)}invert(){return new gn(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new ir(t.pos,r.pos,this.mark)}merge(e){return e instanceof ir&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ir(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ir(t.from,t.to,e.markFromJSON(t.mark))}}et.jsonID("addMark",ir);class gn extends et{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new N(Fh(t.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),t.openStart,t.openEnd);return xe.fromReplace(e,this.from,this.to,r)}invert(){return new ir(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new gn(t.pos,r.pos,this.mark)}merge(e){return e instanceof gn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new gn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new gn(t.from,t.to,e.markFromJSON(t.mark))}}et.jsonID("removeMark",gn);class or extends et{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return xe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return xe.fromReplace(e,this.pos,this.pos+1,new N(E.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let s=0;s<t.marks.length;s++)if(!t.marks[s].isInSet(r))return new or(this.pos,t.marks[s]);return new or(this.pos,this.mark)}}return new pi(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new or(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new or(t.pos,e.markFromJSON(t.mark))}}et.jsonID("addNodeMark",or);class pi extends et{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return xe.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return xe.fromReplace(e,this.pos,this.pos+1,new N(E.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new or(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new pi(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new pi(t.pos,e.markFromJSON(t.mark))}}et.jsonID("removeNodeMark",pi);class Pe extends et{constructor(e,t,r,s=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=s}apply(e){return this.structure&&lf(e,this.from,this.to)?xe.fail("Structure replace would overwrite content"):xe.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Tt([this.from,this.to-this.from,this.slice.size])}invert(e){return new Pe(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new Pe(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof Pe)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?N.empty:new N(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Pe(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?N.empty:new N(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Pe(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Pe(t.from,t.to,N.fromJSON(e,t.slice),!!t.structure)}}et.jsonID("replace",Pe);class Re extends et{constructor(e,t,r,s,i,o,l=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=l}apply(e){if(this.structure&&(lf(e,this.from,this.gapFrom)||lf(e,this.gapTo,this.to)))return xe.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return xe.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?xe.fromReplace(e,this.from,this.to,r):xe.fail("Content does not fit in gap")}getMap(){return new Tt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Re(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||s<t.pos||i>r.pos?null:new Re(t.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Re(t.from,t.to,t.gapFrom,t.gapTo,N.fromJSON(e,t.slice),t.insert,!!t.structure)}}et.jsonID("replaceAround",Re);function lf(n,e,t){let r=n.resolve(e),s=t-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function nC(n,e,t,r){let s=[],i=[],o,l;n.doc.nodesBetween(e,t,(a,u,c)=>{if(!a.isInline)return;let d=a.marks;if(!r.isInSet(d)&&c.type.allowsMarkType(r.type)){let f=Math.max(u,e),h=Math.min(u+a.nodeSize,t),p=r.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:s.push(o=new gn(f,h,d[m])));l&&l.to==f?l.to=h:i.push(l=new ir(f,h,r))}}),s.forEach(a=>n.step(a)),i.forEach(a=>n.step(a))}function rC(n,e,t,r){let s=[],i=0;n.doc.nodesBetween(e,t,(o,l)=>{if(!o.isInline)return;i++;let a=null;if(r instanceof Tu){let u=o.marks,c;for(;c=r.isInSet(u);)(a||(a=[])).push(c),u=c.removeFromSet(u)}else r?r.isInSet(o.marks)&&(a=[r]):a=o.marks;if(a&&a.length){let u=Math.min(l+o.nodeSize,t);for(let c=0;c<a.length;c++){let d=a[c],f;for(let h=0;h<s.length;h++){let p=s[h];p.step==i-1&&d.eq(s[h].style)&&(f=p)}f?(f.to=u,f.step=i):s.push({style:d,from:Math.max(l,e),to:u,step:i})}}}),s.forEach(o=>n.step(new gn(o.from,o.to,o.style)))}function zh(n,e,t,r=t.contentMatch,s=!0){let i=n.doc.nodeAt(e),o=[],l=e+1;for(let a=0;a<i.childCount;a++){let u=i.child(a),c=l+u.nodeSize,d=r.matchType(u.type);if(!d)o.push(new Pe(l,c,N.empty));else{r=d;for(let f=0;f<u.marks.length;f++)t.allowsMarkType(u.marks[f].type)||n.step(new gn(l,c,u.marks[f]));if(s&&u.isText&&t.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(u.text);)p||(p=new N(E.from(t.schema.text(" ",t.allowedMarks(u.marks))),0,0)),o.push(new Pe(l+f.index,l+f.index+f[0].length,p))}}l=c}if(!r.validEnd){let a=r.fillBefore(E.empty,!0);n.replace(l,l,new N(a,0,0))}for(let a=o.length-1;a>=0;a--)n.step(o[a])}function sC(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function Ti(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth;;--r){let s=n.$from.node(r),i=n.$from.index(r),o=n.$to.indexAfter(r);if(r<n.depth&&s.canReplace(i,o,t))return r;if(r==0||s.type.spec.isolating||!sC(s,i,o))break}return null}function iC(n,e,t){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),l=s.after(i+1),a=o,u=l,c=E.empty,d=0;for(let p=i,m=!1;p>t;p--)m||r.index(p)>0?(m=!0,c=E.from(r.node(p).copy(c)),d++):a--;let f=E.empty,h=0;for(let p=i,m=!1;p>t;p--)m||s.after(p+1)<s.end(p)?(m=!0,f=E.from(s.node(p).copy(f)),h++):u++;n.step(new Re(a,u,o,l,new N(c.append(f),d,h),c.size-d,!0))}function Bh(n,e,t=null,r=n){let s=oC(n,e),i=s&&lC(r,e);return i?s.map(ug).concat({type:e,attrs:t}).concat(i.map(ug)):null}function ug(n){return{type:n,attrs:null}}function oC(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return t.canReplaceWith(r,s,o)?i:null}function lC(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let a=(o.length?o[o.length-1]:e).contentMatch;for(let u=r;a&&u<s;u++)a=a.matchType(t.child(u).type);return!a||!a.validEnd?null:o}function aC(n,e,t){let r=E.empty;for(let o=t.length-1;o>=0;o--){if(r.size){let l=t[o].type.contentMatch.matchFragment(r);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=E.from(t[o].type.create(t[o].attrs,r))}let s=e.start,i=e.end;n.step(new Re(s,i,s,i,new N(r,0,0),t.length,!0))}function uC(n,e,t,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=n.steps.length;n.doc.nodesBetween(e,t,(o,l)=>{let a=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,a)&&cC(n.doc,n.mapping.slice(i).map(l),r)){let u=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?u=!1:!h&&p&&(u=!0)}u===!1&&Lw(n,o,l,i),zh(n,n.mapping.slice(i).map(l,1),r,void 0,u===null);let c=n.mapping.slice(i),d=c.map(l,1),f=c.map(l+o.nodeSize,1);return n.step(new Re(d,f,d+1,f-1,new N(E.from(r.create(a,null,o.marks)),0,0),1,!0)),u===!0&&$w(n,o,l,i),!1}})}function $w(n,e,t,r){e.forEach((s,i)=>{if(s.isText){let o,l=/\r?\n|\r/g;for(;o=l.exec(s.text);){let a=n.mapping.slice(r).map(t+1+i+o.index);n.replaceWith(a,a+1,e.type.schema.linebreakReplacement.create())}}})}function Lw(n,e,t,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=n.mapping.slice(r).map(t+1+i);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function cC(n,e,t){let r=n.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,t)}function dC(n,e,t,r,s){let i=n.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let o=t.create(r,null,s||i.marks);if(i.isLeaf)return n.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new Re(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new N(E.from(o),0,0),1,!0))}function Zs(n,e,t=1,r){let s=n.resolve(e),i=s.depth-t,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,c=t-2;u>i;u--,c--){let d=s.node(u),f=s.index(u);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[c+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let m=r&&r[c]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(h))return!1}let l=s.indexAfter(i),a=r&&r[0];return s.node(i).canReplaceWith(l,l,a?a.type:s.node(i+1).type)}function fC(n,e,t=1,r){let s=n.doc.resolve(e),i=E.empty,o=E.empty;for(let l=s.depth,a=s.depth-t,u=t-1;l>a;l--,u--){i=E.from(s.node(l).copy(i));let c=r&&r[u];o=E.from(c?c.type.create(c.attrs,o):s.node(l).copy(o))}n.step(new Pe(e,e,new N(i.append(o),t,t),!0))}function Er(n,e){let t=n.resolve(e),r=t.index();return jw(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}function hC(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:r}=n.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?n.type.schema.nodes.text:i.type;if(t=t.matchType(o),!t||!n.type.allowsMarks(i.marks))return!1}return t.validEnd}function jw(n,e){return!!(n&&e&&!n.isLeaf&&hC(n,e))}function Ou(n,e,t=-1){let r=n.resolve(e);for(let s=r.depth;;s--){let i,o,l=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):t>0?(i=r.node(s+1),l++,o=r.node(s).maybeChild(l)):(i=r.node(s).maybeChild(l-1),o=r.node(s+1)),i&&!i.isTextblock&&jw(i,o)&&r.node(s).canReplace(l,l+1))return e;if(s==0)break;e=t<0?r.before(s):r.after(s)}}function pC(n,e,t){let r=null,{linebreakReplacement:s}=n.doc.type.schema,i=n.doc.resolve(e-t),o=i.node().type;if(s&&o.inlineContent){let c=o.whitespace=="pre",d=!!o.contentMatch.matchType(s);c&&!d?r=!1:!c&&d&&(r=!0)}let l=n.steps.length;if(r===!1){let c=n.doc.resolve(e+t);Lw(n,c.node(),c.before(),l)}o.inlineContent&&zh(n,e+t-1,o,i.node().contentMatchAt(i.index()),r==null);let a=n.mapping.slice(l),u=a.map(e-t);if(n.step(new Pe(u,a.map(e+t,-1),N.empty,!0)),r===!0){let c=n.doc.resolve(u);$w(n,c.node(),c.before(),n.steps.length)}return n}function mC(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,t))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,t))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function Fw(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let s=t.content;for(let i=0;i<t.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let o=r.depth;o>=0;o--){let l=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,a=r.index(o)+(l>0?1:0),u=r.node(o),c=!1;if(i==1)c=u.canReplace(a,a,s);else{let d=u.contentMatchAt(a).findWrapping(s.firstChild.type);c=d&&u.canReplaceWith(a,a,d[0])}if(c)return l==0?r.pos:l<0?r.before(o+1):r.after(o+1)}return null}function Mu(n,e,t=e,r=N.empty){if(e==t&&!r.size)return null;let s=n.resolve(e),i=n.resolve(t);return zw(s,i,r)?new Pe(e,t,r):new gC(s,i,r).fit()}function zw(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class gC{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=E.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=E.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,l=s.depth;for(;o&&l&&i.childCount==1;)i=i.firstChild.content,o--,l--;let a=new N(i,o,l);return e>-1?new Re(r.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||r.pos!=this.$to.pos?new Pe(r.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=t.firstChild;if(t.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}t=i.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=Ec(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let l=this.depth;l>=0;l--){let{type:a,match:u}=this.frontier[l],c,d=null;if(t==1&&(o?u.matchType(o.type)||(d=u.fillBefore(E.from(o),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:l,parent:i,inject:d};if(t==2&&o&&(c=u.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:l,parent:i,wrap:c};if(i&&u.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=Ec(e,t);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new N(e,t+1,Math.max(r,s.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=Ec(e,t);if(s.childCount<=1&&t>0){let i=e.size-t<=t+s.size;this.unplaced=new N(Qi(e,t-1,1),t-1,i?t-1:r)}else this.unplaced=new N(Qi(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:s,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let m=0;m<i.length;m++)this.openFrontierNode(i[m]);let o=this.unplaced,l=r?r.content:o.content,a=o.openStart-e,u=0,c=[],{match:d,type:f}=this.frontier[t];if(s){for(let m=0;m<s.childCount;m++)c.push(s.child(m));d=d.matchFragment(s)}let h=l.size+e-(o.content.size-o.openEnd);for(;u<l.childCount;){let m=l.child(u),v=d.matchType(m.type);if(!v)break;u++,(u>1||a==0||m.content.size)&&(d=v,c.push(Bw(m.mark(f.allowedMarks(m.marks)),u==1?a:0,u==l.childCount?h:-1)))}let p=u==l.childCount;p||(h=-1),this.placed=Xi(this.placed,t,E.from(c)),this.frontier[t].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,v=l;m<h;m++){let y=v.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),v=y.content}this.unplaced=p?e==0?N.empty:new N(Qi(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new N(Qi(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Tc(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:s}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=Tc(e,t,s,r,i);if(o){for(let l=t-1;l>=0;l--){let{match:a,type:u}=this.frontier[l],c=Tc(e,l,u,a,!0);if(!c||c.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Xi(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,t=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Xi(this.placed,this.depth,E.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(E.empty,!0);t.childCount&&(this.placed=Xi(this.placed,this.frontier.length,t))}}function Qi(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(Qi(n.firstChild.content,e-1,t)))}function Xi(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Xi(n.lastChild.content,e-1,t)))}function Ec(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function Bw(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,Bw(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(E.empty,!0)))),n.copy(r)}function Tc(n,e,t,r,s){let i=n.node(e),o=s?n.indexAfter(e):n.index(e);if(o==i.childCount&&!t.compatibleContent(i.type))return null;let l=r.fillBefore(i.content,!0,o);return l&&!yC(t,i.content,o)?l:null}function yC(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}function vC(n){return n.spec.defining||n.spec.definingForContent}function wC(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let s=n.doc.resolve(e),i=n.doc.resolve(t);if(zw(s,i,r))return n.step(new Pe(e,t,r));let o=Vw(s,n.doc.resolve(t));o[o.length-1]==0&&o.pop();let l=-(s.depth+1);o.unshift(l);for(let f=s.depth,h=s.pos-1;f>0;f--,h--){let p=s.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?l=f:s.before(f)==h&&o.splice(1,0,-f)}let a=o.indexOf(l),u=[],c=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(u.push(p),h==r.openStart)break;f=p.content}for(let f=c-1;f>=0;f--){let h=u[f],p=vC(h.type);if(p&&!h.sameMarkup(s.node(Math.abs(l)-1)))c=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+c+1)%(r.openStart+1),p=u[h];if(p)for(let m=0;m<o.length;m++){let v=o[(m+a)%o.length],y=!0;v<0&&(y=!1,v=-v);let g=s.node(v-1),w=s.index(v-1);if(g.canReplaceWith(w,w,p.type,p.marks))return n.replace(s.before(v),y?i.after(v):t,new N(Uw(r.content,0,r.openStart,h),h,r.openEnd))}}let d=n.steps.length;for(let f=o.length-1;f>=0&&(n.replace(e,t,r),!(n.steps.length>d));f--){let h=o[f];h<0||(e=s.before(h),t=i.after(h))}}function Uw(n,e,t,r,s){if(e<t){let i=n.firstChild;n=n.replaceChild(0,i.copy(Uw(i.content,e+1,t,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(n).append(n);n=o.append(i.matchFragment(o).fillBefore(E.empty,!0))}return n}function kC(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let s=mC(n.doc,e,r.type);s!=null&&(e=t=s)}n.replaceRange(e,t,new N(E.from(r),0,0))}function xC(n,e,t){let r=n.doc.resolve(e),s=n.doc.resolve(t),i=Vw(r,s);for(let o=0;o<i.length;o++){let l=i[o],a=o==i.length-1;if(a&&l==0||r.node(l).type.contentMatch.validEnd)return n.delete(r.start(l),s.end(l));if(l>0&&(a||r.node(l-1).canReplace(r.index(l-1),s.indexAfter(l-1))))return n.delete(r.before(l),s.after(l))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&t>r.end(o)&&s.end(o)-t!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return n.delete(r.before(o),t);n.delete(e,t)}function Vw(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let s=r;s>=0;s--){let i=n.start(s);if(i<n.pos-(n.depth-s)||e.end(s)>e.pos+(e.depth-s)||n.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==n.depth&&s==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&t.push(s)}return t}class ei extends et{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return xe.fail("No node at attribute step's position");let r=Object.create(null);for(let i in t.attrs)r[i]=t.attrs[i];r[this.attr]=this.value;let s=t.type.create(r,null,t.marks);return xe.fromReplace(e,this.pos,this.pos+1,new N(E.from(s),0,t.isLeaf?0:1))}getMap(){return Tt.empty}invert(e){return new ei(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ei(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ei(t.pos,t.attr,t.value)}}et.jsonID("attr",ei);class qo extends et{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return xe.ok(r)}getMap(){return Tt.empty}invert(e){return new qo(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new qo(t.attr,t.value)}}et.jsonID("docAttr",qo);let mi=class extends Error{};mi=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};mi.prototype=Object.create(Error.prototype);mi.prototype.constructor=mi;mi.prototype.name="TransformError";class SC{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Wo}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new mi(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=N.empty){let s=Mu(this.doc,e,t,r);return s&&this.step(s),this}replaceWith(e,t,r){return this.replace(e,t,new N(E.from(r),0,0))}delete(e,t){return this.replace(e,t,N.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return wC(this,e,t,r),this}replaceRangeWith(e,t,r){return kC(this,e,t,r),this}deleteRange(e,t){return xC(this,e,t),this}lift(e,t){return iC(this,e,t),this}join(e,t=1){return pC(this,e,t),this}wrap(e,t){return aC(this,e,t),this}setBlockType(e,t=e,r,s=null){return uC(this,e,t,r,s),this}setNodeMarkup(e,t,r=null,s){return dC(this,e,t,r,s),this}setNodeAttribute(e,t,r){return this.step(new ei(e,t,r)),this}setDocAttribute(e,t){return this.step(new qo(e,t)),this}addNodeMark(e,t){return this.step(new or(e,t)),this}removeNodeMark(e,t){if(!(t instanceof se)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t=t.isInSet(r.marks),!t)return this}return this.step(new pi(e,t)),this}split(e,t=1,r){return fC(this,e,t,r),this}addMark(e,t,r){return nC(this,e,t,r),this}removeMark(e,t,r){return rC(this,e,t,r),this}clearIncompatible(e,t,r){return zh(this,e,t,r),this}}const Oc=Object.create(null);class W{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new bC(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=N.empty){let r=t.content.lastChild,s=null;for(let l=0;l<t.openEnd;l++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:a,$to:u}=o[l],c=e.mapping.slice(i);e.replaceRange(c.map(a.pos),c.map(u.pos),l?N.empty:t),l==0&&fg(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:l}=s[i],a=e.mapping.slice(r),u=a.map(o.pos),c=a.map(l.pos);i?e.deleteRange(u,c):(e.replaceRangeWith(u,c,t),fg(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let s=e.parent.inlineContent?new U(e):Ts(e.node(0),e.parent,e.pos,e.index(),t,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=t<0?Ts(e.node(0),e.node(i),e.before(i+1),e.index(i),t,r):Ts(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new zt(e.node(0))}static atStart(e){return Ts(e,e,0,0,1)||new zt(e)}static atEnd(e){return Ts(e,e,e.content.size,e.childCount,-1)||new zt(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Oc[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in Oc)throw new RangeError("Duplicate use of selection JSON ID "+e);return Oc[e]=t,t.prototype.jsonID=e,t}getBookmark(){return U.between(this.$anchor,this.$head).getBookmark()}}W.prototype.visible=!0;class bC{constructor(e,t){this.$from=e,this.$to=t}}let cg=!1;function dg(n){!cg&&!n.parent.inlineContent&&(cg=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class U extends W{constructor(e,t=e){dg(e),dg(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return W.near(r);let s=e.resolve(t.map(this.anchor));return new U(s.parent.inlineContent?s:r,r)}replace(e,t=N.empty){if(super.replace(e,t),t==N.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof U&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Au(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new U(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let s=e.resolve(t);return new this(s,r==t?s:e.resolve(r))}static between(e,t,r){let s=e.pos-t.pos;if((!r||s)&&(r=s>=0?1:-1),!t.parent.inlineContent){let i=W.findFrom(t,r,!0)||W.findFrom(t,-r,!0);if(i)t=i.$head;else return W.near(t,r)}return e.parent.inlineContent||(s==0?e=t:(e=(W.findFrom(e,-r,!0)||W.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=s<0&&(e=t))),new U(e,t)}}W.jsonID("text",U);class Au{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Au(e.map(this.anchor),e.map(this.head))}resolve(e){return U.between(e.resolve(this.anchor),e.resolve(this.head))}}class B extends W{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:s}=t.mapResult(this.anchor),i=e.resolve(s);return r?W.near(i):new B(i)}content(){return new N(E.from(this.node),0,0)}eq(e){return e instanceof B&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Uh(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new B(e.resolve(t.anchor))}static create(e,t){return new B(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}B.prototype.visible=!1;W.jsonID("node",B);class Uh{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new Au(r,r):new Uh(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&B.isSelectable(r)?new B(t):W.near(t)}}class zt extends W{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=N.empty){if(t==N.empty){e.delete(0,e.doc.content.size);let r=W.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new zt(e)}map(e){return new zt(e)}eq(e){return e instanceof zt}getBookmark(){return _C}}W.jsonID("all",zt);const _C={map(){return this},resolve(n){return new zt(n)}};function Ts(n,e,t,r,s,i=!1){if(e.inlineContent)return U.create(n,t);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let l=e.child(o);if(l.isAtom){if(!i&&B.isSelectable(l))return B.create(n,t-(s<0?l.nodeSize:0))}else{let a=Ts(n,l,t+s,s<0?l.childCount:0,s,i);if(a)return a}t+=l.nodeSize*s}return null}function fg(n,e,t){let r=n.steps.length-1;if(r<e)return;let s=n.steps[r];if(!(s instanceof Pe||s instanceof Re))return;let i=n.mapping.maps[r],o;i.forEach((l,a,u,c)=>{o==null&&(o=c)}),n.setSelection(W.near(n.doc.resolve(o),t))}const hg=1,Dl=2,pg=4;class CC extends SC{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|hg)&~Dl,this.storedMarks=null,this}get selectionSet(){return(this.updated&hg)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Dl,this}ensureMarks(e){return se.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Dl)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Dl,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||se.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let s=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),r=r??t,!e)return this.deleteRange(t,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(t);i=r==t?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,s.text(e,i)),this.selection.empty||this.setSelection(W.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=pg,this}get scrolledIntoView(){return(this.updated&pg)>0}}function mg(n,e){return!e||!n?n:n.bind(e)}class Yi{constructor(e,t,r){this.name=e,this.init=mg(t.init,r),this.apply=mg(t.apply,r)}}const EC=[new Yi("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Yi("selection",{init(n,e){return n.selection||W.atStart(e.doc)},apply(n){return n.selection}}),new Yi("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new Yi("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class Mc{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=EC.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Yi(r.key,r.spec.state,r))})}}class Hs{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let l=this.config.plugins[o];if(l.spec.appendTransaction){let a=s?s[o].n:0,u=s?s[o].state:this,c=a<t.length&&l.spec.appendTransaction.call(l,a?t.slice(a):t,u,r);if(c&&r.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!s){s=[];for(let d=0;d<this.config.plugins.length;d++)s.push(d<o?{state:r,n:t.length}:{state:this,n:0})}t.push(c),r=r.applyInner(c),i=!0}s&&(s[o]={state:r,n:t.length})}}if(!i)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Hs(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new CC(this)}static create(e){let t=new Mc(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Hs(t);for(let s=0;s<t.fields.length;s++)r[t.fields[s].name]=t.fields[s].init(e,r);return r}reconfigure(e){let t=new Mc(this.schema,e.plugins),r=t.fields,s=new Hs(t);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(t[r]=i.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Mc(e.schema,e.plugins),i=new Hs(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=gr.fromJSON(e.schema,t.doc);else if(o.name=="selection")i.selection=W.fromJSON(i.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let l in r){let a=r[l],u=a.spec.state;if(a.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){i[o.name]=u.fromJSON.call(a,e,t[l],i);return}}i[o.name]=o.init(e,i)}}),i}}function Hw(n,e,t){for(let r in n){let s=n[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=Hw(s,e,{})),t[r]=s}return t}class xt{constructor(e){this.spec=e,this.props={},e.props&&Hw(e.props,this,this.props),this.key=e.key?e.key.key:Ww("plugin")}getState(e){return e[this.key]}}const Ac=Object.create(null);function Ww(n){return n in Ac?n+"$"+ ++Ac[n]:(Ac[n]=0,n+"$")}class Sn{constructor(e="key"){this.key=Ww(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Be=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},gi=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let af=null;const Mn=function(n,e,t){let r=af||(af=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},TC=function(){af=null},ss=function(n,e,t,r){return t&&(gg(n,e,t,r,-1)||gg(n,e,t,r,1))},OC=/^(img|br|input|textarea|hr)$/i;function gg(n,e,t,r,s){for(;;){if(n==t&&e==r)return!0;if(e==(s<0?0:$t(n))){let i=n.parentNode;if(!i||i.nodeType!=1||ol(n)||OC.test(n.nodeName)||n.contentEditable=="false")return!1;e=Be(n)+(s<0?0:1),n=i}else if(n.nodeType==1){if(n=n.childNodes[e+(s<0?-1:0)],n.contentEditable=="false")return!1;e=s<0?$t(n):0}else return!1}}function $t(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function MC(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=$t(n)}else if(n.parentNode&&!ol(n))e=Be(n),n=n.parentNode;else return null}}function AC(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!ol(n))e=Be(n)+1,n=n.parentNode;else return null}}function NC(n,e,t){for(let r=e==0,s=e==$t(n);r||s;){if(n==t)return!0;let i=Be(n);if(n=n.parentNode,!n)return!1;r=r&&i==0,s=s&&i==$t(n)}}function ol(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const Nu=function(n){return n.focusNode&&ss(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function Rr(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function PC(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function IC(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:Math.min($t(r.offsetNode),r.offset)}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:Math.min($t(r.startContainer),r.startOffset)}}}const kn=typeof navigator<"u"?navigator:null,yg=typeof document<"u"?document:null,Tr=kn&&kn.userAgent||"",uf=/Edge\/(\d+)/.exec(Tr),qw=/MSIE \d/.exec(Tr),cf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Tr),vt=!!(qw||cf||uf),yr=qw?document.documentMode:cf?+cf[1]:uf?+uf[1]:0,sn=!vt&&/gecko\/(\d+)/i.test(Tr);sn&&+(/Firefox\/(\d+)/.exec(Tr)||[0,0])[1];const df=!vt&&/Chrome\/(\d+)/.exec(Tr),Xe=!!df,Jw=df?+df[1]:0,st=!vt&&!!kn&&/Apple Computer/.test(kn.vendor),yi=st&&(/Mobile\/\w+/.test(Tr)||!!kn&&kn.maxTouchPoints>2),It=yi||(kn?/Mac/.test(kn.platform):!1),RC=kn?/Win/.test(kn.platform):!1,Rn=/Android \d/.test(Tr),ll=!!yg&&"webkitFontSmoothing"in yg.documentElement.style,DC=ll?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function $C(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Cn(n,e){return typeof n=="number"?n:n[e]}function LC(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}function vg(n,e,t){let r=n.someProp("scrollThreshold")||0,s=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument;for(let o=t||n.dom;o;){if(o.nodeType!=1){o=gi(o);continue}let l=o,a=l==i.body,u=a?$C(i):LC(l),c=0,d=0;if(e.top<u.top+Cn(r,"top")?d=-(u.top-e.top+Cn(s,"top")):e.bottom>u.bottom-Cn(r,"bottom")&&(d=e.bottom-e.top>u.bottom-u.top?e.top+Cn(s,"top")-u.top:e.bottom-u.bottom+Cn(s,"bottom")),e.left<u.left+Cn(r,"left")?c=-(u.left-e.left+Cn(s,"left")):e.right>u.right-Cn(r,"right")&&(c=e.right-u.right+Cn(s,"right")),c||d)if(a)i.defaultView.scrollBy(c,d);else{let h=l.scrollLeft,p=l.scrollTop;d&&(l.scrollTop+=d),c&&(l.scrollLeft+=c);let m=l.scrollLeft-h,v=l.scrollTop-p;e={left:e.left-m,top:e.top-v,right:e.right-m,bottom:e.bottom-v}}let f=a?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:gi(o)}}function jC(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let l=n.root.elementFromPoint(i,o);if(!l||l==n.dom||!n.dom.contains(l))continue;let a=l.getBoundingClientRect();if(a.top>=t-20){r=l,s=a.top;break}}return{refDOM:r,refTop:s,stack:Kw(n.dom)}}function Kw(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=gi(r));return e}function FC({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;Gw(t,r==0?0:r-e)}function Gw(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:s,left:i}=n[t];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let ws=null;function zC(n){if(n.setActive)return n.setActive();if(ws)return n.focus(ws);let e=Kw(n);n.focus(ws==null?{get preventScroll(){return ws={preventScroll:!0},!0}}:void 0),ws||(ws=!1,Gw(e,0))}function Qw(n,e){let t,r=2e8,s,i=0,o=e.top,l=e.top,a,u;for(let c=n.firstChild,d=0;c;c=c.nextSibling,d++){let f;if(c.nodeType==1)f=c.getClientRects();else if(c.nodeType==3)f=Mn(c).getClientRects();else continue;for(let h=0;h<f.length;h++){let p=f[h];if(p.top<=o&&p.bottom>=l){o=Math.max(p.bottom,o),l=Math.min(p.top,l);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<r){t=c,r=m,s=m&&t.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,c.nodeType==1&&m&&(i=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!a&&p.left<=e.left&&p.right>=e.left&&(a=c,u={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!t&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(i=d+1)}}return!t&&a&&(t=a,s=u,r=0),t&&t.nodeType==3?BC(t,s):!t||r&&t.nodeType==1?{node:n,offset:i}:Qw(t,s)}function BC(n,e){let t=n.nodeValue.length,r=document.createRange();for(let s=0;s<t;s++){r.setEnd(n,s+1),r.setStart(n,s);let i=Wn(r,1);if(i.top!=i.bottom&&Vh(e,i))return{node:n,offset:s+(e.left>=(i.left+i.right)/2?1:0)}}return{node:n,offset:0}}function Vh(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function UC(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function VC(n,e,t){let{node:r,offset:s}=Qw(e,t),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(r,s,i)}function HC(n,e,t,r){let s=-1;for(let i=e,o=!1;i!=n.dom;){let l=n.docView.nearestDesc(i,!0),a;if(!l)return null;if(l.dom.nodeType==1&&(l.node.isBlock&&l.parent||!l.contentDOM)&&((a=l.dom.getBoundingClientRect()).width||a.height)&&(l.node.isBlock&&l.parent&&(!o&&a.left>r.left||a.top>r.top?s=l.posBefore:(!o&&a.right<r.left||a.bottom<r.top)&&(s=l.posAfter),o=!0),!l.contentDOM&&s<0&&!l.node.isText))return(l.node.isBlock?r.top<(a.top+a.bottom)/2:r.left<(a.left+a.right)/2)?l.posBefore:l.posAfter;i=l.dom.parentNode}return s>-1?s:n.docView.posFromDOM(e,t,-1)}function Xw(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),i=s;;){let o=n.childNodes[i];if(o.nodeType==1){let l=o.getClientRects();for(let a=0;a<l.length;a++){let u=l[a];if(Vh(e,u))return Xw(o,e,u)}}if((i=(i+1)%r)==s)break}return n}function WC(n,e){let t=n.dom.ownerDocument,r,s=0,i=IC(t,e.left,e.top);i&&({node:r,offset:s}=i);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),l;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=n.dom.getBoundingClientRect();if(!Vh(e,u)||(o=Xw(n.dom,e,u),!o))return null}if(st)for(let u=o;r&&u;u=gi(u))u.draggable&&(r=void 0);if(o=UC(o,e),r){if(sn&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let c=r.childNodes[s],d;c.nodeName=="IMG"&&(d=c.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&s++}let u;ll&&s&&r.nodeType==1&&(u=r.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,r==n.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?l=n.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(l=HC(n,r,s,e))}l==null&&(l=VC(n,o,e));let a=n.docView.nearestDesc(o,!0);return{pos:l,inside:a?a.posAtStart-a.border:-1}}function wg(n){return n.top<n.bottom||n.left<n.right}function Wn(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(wg(r))return r}return Array.prototype.find.call(t,wg)||n.getBoundingClientRect()}const qC=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Yw(n,e,t){let{node:r,offset:s,atom:i}=n.docView.domFromPos(e,t<0?-1:1),o=ll||sn;if(r.nodeType==3)if(o&&(qC.test(r.nodeValue)||(t<0?!s:s==r.nodeValue.length))){let a=Wn(Mn(r,s,s),t);if(sn&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let u=Wn(Mn(r,s-1,s-1),-1);if(u.top==a.top){let c=Wn(Mn(r,s,s+1),-1);if(c.top!=a.top)return Vi(c,c.left<u.left)}}return a}else{let a=s,u=s,c=t<0?1:-1;return t<0&&!s?(u++,c=-1):t>=0&&s==r.nodeValue.length?(a--,c=1):t<0?a--:u++,Vi(Wn(Mn(r,a,u),c),c<0)}if(!n.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(t<0||s==$t(r))){let a=r.childNodes[s-1];if(a.nodeType==1)return Nc(a.getBoundingClientRect(),!1)}if(i==null&&s<$t(r)){let a=r.childNodes[s];if(a.nodeType==1)return Nc(a.getBoundingClientRect(),!0)}return Nc(r.getBoundingClientRect(),t>=0)}if(i==null&&s&&(t<0||s==$t(r))){let a=r.childNodes[s-1],u=a.nodeType==3?Mn(a,$t(a)-(o?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(u)return Vi(Wn(u,1),!1)}if(i==null&&s<$t(r)){let a=r.childNodes[s];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let u=a?a.nodeType==3?Mn(a,0,o?0:1):a.nodeType==1?a:null:null;if(u)return Vi(Wn(u,-1),!0)}return Vi(Wn(r.nodeType==3?Mn(r):r,-t),t>=0)}function Vi(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function Nc(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function Zw(n,e,t){let r=n.state,s=n.root.activeElement;r!=e&&n.updateState(e),s!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),s!=n.dom&&s&&s.focus()}}function JC(n,e,t){let r=e.selection,s=t=="up"?r.$from:r.$to;return Zw(n,e,()=>{let{node:i}=n.docView.domFromPos(s.pos,t=="up"?-1:1);for(;;){let l=n.docView.nearestDesc(i,!0);if(!l)break;if(l.node.isBlock){i=l.contentDOM||l.dom;break}i=l.dom.parentNode}let o=Yw(n,s.pos,1);for(let l=i.firstChild;l;l=l.nextSibling){let a;if(l.nodeType==1)a=l.getClientRects();else if(l.nodeType==3)a=Mn(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<a.length;u++){let c=a[u];if(c.bottom>c.top+1&&(t=="up"?o.top-c.top>(c.bottom-o.top)*2:c.bottom-o.bottom>(o.bottom-c.top)*2))return!1}}return!0})}const KC=/[\u0590-\u08ac]/;function GC(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,l=n.domSelection();return l?!KC.test(r.parent.textContent)||!l.modify?t=="left"||t=="backward"?i:o:Zw(n,e,()=>{let{focusNode:a,focusOffset:u,anchorNode:c,anchorOffset:d}=n.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let h=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:p,focusOffset:m}=n.domSelectionRange(),v=p&&!h.contains(p.nodeType==1?p:p.parentNode)||a==p&&u==m;try{l.collapse(c,d),a&&(a!=c||u!=d)&&l.extend&&l.extend(a,u)}catch{}return f!=null&&(l.caretBidiLevel=f),v}):r.pos==r.start()||r.pos==r.end()}let kg=null,xg=null,Sg=!1;function QC(n,e,t){return kg==e&&xg==t?Sg:(kg=e,xg=t,Sg=t=="up"||t=="down"?JC(n,e,t):GC(n,e,t))}const Bt=0,bg=1,Br=2,xn=3;class al{constructor(e,t,r,s){this.parent=e,this.children=t,this.dom=r,this.contentDOM=s,this.dirty=Bt,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let s=this.children[t];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=t>Be(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!t||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let s=this.children[t],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let l=s.children[o];if(l.size){s=l;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],l=i+o.size;if(l>e||o instanceof t1){s=e-i;break}i=l}if(s)return this.children[r].domFromPos(s-this.children[r].border,t);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof e1&&i.side>=0;r--);if(t<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&t&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?Be(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?Be(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,l=0;;l++){let a=this.children[l],u=o+a.size;if(s==-1&&e<=u){let c=o+a.border;if(e>=c&&t<=u-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(e,t,c);e=o;for(let d=l;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=Be(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(u>t||l==this.children.length-1)){t=u;for(let c=l+1;c<this.children.length;c++){let d=this.children[c];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){i=Be(d.dom);break}t+=d.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,s=!1){let i=Math.min(e,t),o=Math.max(e,t);for(let h=0,p=0;h<this.children.length;h++){let m=this.children[h],v=p+m.size;if(i>p&&o<v)return m.setSelection(e-p-m.border,t-p-m.border,r,s);p=v}let l=this.domFromPos(e,e?-1:1),a=t==e?l:this.domFromPos(t,t?-1:1),u=r.root.getSelection(),c=r.domSelectionRange(),d=!1;if((sn||st)&&e==t){let{node:h,offset:p}=l;if(h.nodeType==3){if(d=!!(p&&h.nodeValue[p-1]==`
`),d&&p==h.nodeValue.length)for(let m=h,v;m;m=m.parentNode){if(v=m.nextSibling){v.nodeName=="BR"&&(l=a={node:v.parentNode,offset:Be(v)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=h.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(sn&&c.focusNode&&c.focusNode!=a.node&&c.focusNode.nodeType==1){let h=c.focusNode.childNodes[c.focusOffset];h&&h.contentEditable=="false"&&(s=!0)}if(!(s||d&&st)&&ss(l.node,l.offset,c.anchorNode,c.anchorOffset)&&ss(a.node,a.offset,c.focusNode,c.focusOffset))return;let f=!1;if((u.extend||e==t)&&!d){u.collapse(l.node,l.offset);try{e!=t&&u.extend(a.node,a.offset),f=!0}catch{}}if(!f){if(e>t){let p=l;l=a,a=p}let h=document.createRange();h.setEnd(a.node,a.offset),h.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&t>=r:e<o&&t>r){let l=r+i.border,a=o-i.border;if(e>=l&&t<=a){this.dirty=e==r||t==o?Br:bg,e==l&&t==a&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=xn:i.markDirty(e-l,t-l);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Br:xn}r=o}this.dirty=Br}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?Br:bg;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class e1 extends al{constructor(e,t,r,s){let i,o=t.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(o.nodeType!=1){let l=document.createElement("span");l.appendChild(o),o=l}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Bt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class XC extends al{constructor(e,t,r,s){super(e,[],t,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class is extends al{constructor(e,t,r,s,i){super(e,[],r,s),this.mark=t,this.spec=i}static create(e,t,r,s){let i=s.nodeViews[t.type.name],o=i&&i(t,s,r);return(!o||!o.dom)&&(o=cs.renderSpec(document,t.type.spec.toDOM(t,r),null,t.attrs)),new is(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&xn||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=xn&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Bt){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Bt}}slice(e,t,r){let s=is.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;t<o&&(i=hf(i,t,o,r)),e>0&&(i=hf(i,0,e,r));for(let l=0;l<i.length;l++)i[l].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class vr extends al{constructor(e,t,r,s,i,o,l,a,u){super(e,[],i,o),this.node=t,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=l}static create(e,t,r,s,i,o){let l=i.nodeViews[t.type.name],a,u=l&&l(t,i,()=>{if(!a)return o;if(a.parent)return a.parent.posBeforeChild(a)},r,s),c=u&&u.dom,d=u&&u.contentDOM;if(t.isText){if(!c)c=document.createTextNode(t.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:d}=cs.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!d&&!t.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let f=c;return c=s1(c,r,t),u?a=new YC(e,t,r,s,c,d||null,f,u,i,o+1):t.isText?new Pu(e,t,r,s,c,f,i):new vr(e,t,r,s,c,d||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>E.empty)}return e}matchesNode(e,t,r){return this.dirty==Bt&&e.eq(this.node)&&Qa(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,s=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,l=i&&i.pos<0,a=new eE(this,o&&o.node,e);rE(this.node,this.innerDeco,(u,c,d)=>{u.spec.marks?a.syncToMarks(u.spec.marks,r,e):u.type.side>=0&&!d&&a.syncToMarks(c==this.node.childCount?se.none:this.node.child(c).marks,r,e),a.placeWidget(u,e,s)},(u,c,d,f)=>{a.syncToMarks(u.marks,r,e);let h;a.findNodeMatch(u,c,d,f)||l&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(h=a.findIndexWithChild(i.node))>-1&&a.updateNodeAt(u,c,d,h,e)||a.updateNextNode(u,c,d,e,f,s)||a.addNode(u,c,d,e,s),s+=u.nodeSize}),a.syncToMarks([],r,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||this.dirty==Br)&&(o&&this.protectLocalComposition(e,o),n1(this.contentDOM,this.children,e),yi&&sE(this.dom))}localCompositionInfo(e,t){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof U)||r<t||s>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,l=iE(this.node.content,o,r-t,s-t);return l<0?null:{node:i,pos:l,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:s}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new XC(this,i,t,s);e.input.compositionNodes.push(o),this.children=hf(this.children,r,r+s.length,e,o)}update(e,t,r,s){return this.dirty==xn||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,s),!0)}updateInner(e,t,r,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Bt}updateOuterDeco(e){if(Qa(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=r1(this.dom,this.nodeDOM,ff(this.outerDeco,this.node,t),ff(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function _g(n,e,t,r,s){s1(r,e,n);let i=new vr(void 0,n,e,t,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Pu extends vr{constructor(e,t,r,s,i,o,l){super(e,t,r,s,i,null,o,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,s){return this.dirty==xn||this.dirty!=Bt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Bt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Bt,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let s=this.node.cut(e,t),i=document.createTextNode(s.text);return new Pu(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=xn)}get domAtom(){return!1}isText(e){return this.node.text==e}}class t1 extends al{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Bt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class YC extends vr{constructor(e,t,r,s,i,o,l,a,u,c){super(e,t,r,s,i,o,l,u,c),this.spec=a}update(e,t,r,s){if(this.dirty==xn)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,r);return i&&this.updateInner(e,t,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,s){this.spec.setSelection?this.spec.setSelection(e,t,r.root):super.setSelection(e,t,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function n1(n,e,t){let r=n.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],l=o.dom;if(l.parentNode==n){for(;l!=r;)r=Cg(r),s=!0;r=r.nextSibling}else s=!0,n.insertBefore(l,r);if(o instanceof is){let a=r?r.previousSibling:n.lastChild;n1(o.contentDOM,o.children,t),r=a?a.nextSibling:n.firstChild}}for(;r;)r=Cg(r),s=!0;s&&t.trackWrites==n&&(t.trackWrites=null)}const wo=function(n){n&&(this.nodeName=n)};wo.prototype=Object.create(null);const Ur=[new wo];function ff(n,e,t){if(n.length==0)return Ur;let r=t?Ur[0]:new wo,s=[r];for(let i=0;i<n.length;i++){let o=n[i].type.attrs;if(o){o.nodeName&&s.push(r=new wo(o.nodeName));for(let l in o){let a=o[l];a!=null&&(t&&s.length==1&&s.push(r=new wo(e.isInline?"span":"div")),l=="class"?r.class=(r.class?r.class+" ":"")+a:l=="style"?r.style=(r.style?r.style+";":"")+a:l!="nodeName"&&(r[l]=a))}}}return s}function r1(n,e,t,r){if(t==Ur&&r==Ur)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],l=t[i];if(i){let a;l&&l.nodeName==o.nodeName&&s!=n&&(a=s.parentNode)&&a.nodeName.toLowerCase()==o.nodeName||(a=document.createElement(o.nodeName),a.pmIsDeco=!0,a.appendChild(s),l=Ur[0]),s=a}ZC(s,l||Ur[0],o)}return s}function ZC(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&n.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&n.classList.add(s[i]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)n.style.removeProperty(s[1])}t.style&&(n.style.cssText+=t.style)}}function s1(n,e,t){return r1(n,n,Ur,ff(e,t,n.nodeType!=1))}function Qa(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function Cg(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class eE{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=tE(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Bt,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let a=this.index;a<Math.min(this.index+3,this.top.children.length);a++){let u=this.top.children[a];if(u.matchesMark(e[i])&&!this.isLocked(u.dom)){l=a;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let a=is.create(this.top,e[i],t,r);this.top.children.splice(this.index,0,a),this.top=a,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,r))i=this.top.children.indexOf(o,this.index);else for(let l=this.index,a=Math.min(this.top.children.length,l+5);l<a;l++){let u=this.top.children[l];if(u.matchesNode(e,t,r)&&!this.preMatch.matched.has(u)){i=l;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,r,s,i){let o=this.top.children[s];return o.dirty==xn&&o.dom==o.contentDOM&&(o.dirty=Br),o.update(e,t,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=t}}updateNextNode(e,t,r,s,i,o){for(let l=this.index;l<this.top.children.length;l++){let a=this.top.children[l];if(a instanceof vr){let u=this.preMatch.matched.get(a);if(u!=null&&u!=i)return!1;let c=a.dom,d,f=this.isLocked(c)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=xn&&Qa(t,a.outerDeco));if(!f&&a.update(e,t,r,s))return this.destroyBetween(this.index,l),a.dom!=c&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(a,e,t,r,s,o)))return this.destroyBetween(this.index,l),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Br,d.updateChildren(s,o+1),d.dirty=Bt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,s,i,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!Qa(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let l=vr.create(this.top,t,r,s,i,o);if(l.contentDOM){l.children=e.children,e.children=[];for(let a of l.children)a.parent=l}return e.destroy(),l}addNode(e,t,r,s,i){let o=vr.create(this.top,e,t,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new e1(this.top,e,t,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof is;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Pu)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((st||Xe)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new t1(this.top,[],r,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function tE(n,e){let t=e,r=t.children.length,s=n.childCount,i=new Map,o=[];e:for(;s>0;){let l;for(;;)if(r){let u=t.children[r-1];if(u instanceof is)t=u,r=u.children.length;else{l=u,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let a=l.node;if(a){if(a!=n.child(s-1))break;--s,i.set(l,s),o.push(l)}}return{index:s,matched:i,matches:o.reverse()}}function nE(n,e){return n.type.side-e.type.side}function rE(n,e,t,r){let s=e.locals(n),i=0;if(s.length==0){for(let u=0;u<n.childCount;u++){let c=n.child(u);r(c,s,e.forChild(i,c),u),i+=c.nodeSize}return}let o=0,l=[],a=null;for(let u=0;;){let c,d;for(;o<s.length&&s[o].to==i;){let v=s[o++];v.widget&&(c?(d||(d=[c])).push(v):c=v)}if(c)if(d){d.sort(nE);for(let v=0;v<d.length;v++)t(d[v],u,!!a)}else t(c,u,!!a);let f,h;if(a)h=-1,f=a,a=null;else if(u<n.childCount)h=u,f=n.child(u++);else break;for(let v=0;v<l.length;v++)l[v].to<=i&&l.splice(v--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)l.push(s[o++]);let p=i+f.nodeSize;if(f.isText){let v=p;o<s.length&&s[o].from<v&&(v=s[o].from);for(let y=0;y<l.length;y++)l[y].to<v&&(v=l[y].to);v<p&&(a=f.cut(v-i),f=f.cut(0,v-i),p=v,h=-1)}else for(;o<s.length&&s[o].to<p;)o++;let m=f.isInline&&!f.isLeaf?l.filter(v=>!v.inline):l.slice();r(f,m,e.forChild(i,f),h),i=p}}function sE(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function iE(n,e,t,r){for(let s=0,i=0;s<n.childCount&&i<=r;){let o=n.child(s++),l=i;if(i+=o.nodeSize,!o.isText)continue;let a=o.text;for(;s<n.childCount;){let u=n.child(s++);if(i+=u.nodeSize,!u.isText)break;a+=u.text}if(i>=t){if(i>=r&&a.slice(r-e.length-l,r-l)==e)return r-e.length;let u=l<r?a.lastIndexOf(e,r-l-1):-1;if(u>=0&&u+e.length+l>=t)return l+u;if(t==r&&a.length>=r+e.length-l&&a.slice(r-l,r-l+e.length)==e)return r}}return-1}function hf(n,e,t,r,s){let i=[];for(let o=0,l=0;o<n.length;o++){let a=n[o],u=l,c=l+=a.size;u>=t||c<=e?i.push(a):(u<e&&i.push(a.slice(0,e-u,r)),s&&(i.push(s),s=void 0),c>t&&i.push(a.slice(t-u,a.size,r)))}return i}function Hh(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let s=n.docView.nearestDesc(t.focusNode),i=s&&s.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let l=r.resolve(o),a,u;if(Nu(t)){for(a=o;s&&!s.node;)s=s.parent;let d=s.node;if(s&&d.isAtom&&B.isSelectable(d)&&s.parent&&!(d.isInline&&NC(t.focusNode,t.focusOffset,s.dom))){let f=s.posBefore;u=new B(o==f?l:r.resolve(f))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let d=o,f=o;for(let h=0;h<t.rangeCount;h++){let p=t.getRangeAt(h);d=Math.min(d,n.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,n.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[a,o]=f==n.state.selection.anchor?[f,d]:[d,f],l=r.resolve(o)}else a=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(a<0)return null}let c=r.resolve(a);if(!u){let d=e=="pointer"||n.state.selection.head<l.pos&&!i?1:-1;u=Wh(n,c,l,d)}return u}function i1(n){return n.editable?n.hasFocus():l1(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function $n(n,e=!1){let t=n.state.selection;if(o1(n,t),!!i1(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Xe){let r=n.domSelectionRange(),s=n.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&ss(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)lE(n);else{let{anchor:r,head:s}=t,i,o;Eg&&!(t instanceof U)&&(t.$from.parent.inlineContent||(i=Tg(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Tg(n,t.to))),n.docView.setSelection(r,s,n,e),Eg&&(i&&Og(i),o&&Og(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&oE(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const Eg=st||Xe&&Jw<63;function Tg(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),s=r<t.childNodes.length?t.childNodes[r]:null,i=r?t.childNodes[r-1]:null;if(st&&s&&s.contentEditable=="false")return Pc(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return Pc(s);if(i)return Pc(i)}}function Pc(n){return n.contentEditable="true",st&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Og(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function oE(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,s=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=s)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!i1(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function lE(n){let e=n.domSelection(),t=document.createRange();if(!e)return;let r=n.cursorWrapper.dom,s=r.nodeName=="IMG";s?t.setStart(r.parentNode,Be(r)+1):t.setStart(r,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!s&&!n.state.selection.visible&&vt&&yr<=11&&(r.disabled=!0,r.disabled=!1)}function o1(n,e){if(e instanceof B){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Mg(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Mg(n)}function Mg(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function Wh(n,e,t,r){return n.someProp("createSelectionBetween",s=>s(n,e,t))||U.between(e,t,r)}function Ag(n){return n.editable&&!n.hasFocus()?!1:l1(n)}function l1(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function aE(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return ss(e.node,e.offset,t.anchorNode,t.anchorOffset)}function pf(n,e){let{$anchor:t,$head:r}=n.selection,s=e>0?t.max(r):t.min(r),i=s.parent.inlineContent?s.depth?n.doc.resolve(e>0?s.after():s.before()):null:s;return i&&W.findFrom(i,e)}function Qn(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Ng(n,e,t){let r=n.state.selection;if(r instanceof U)if(t.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=n.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return Qn(n,new U(r.$anchor,o))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let s=pf(n.state,e);return s&&s instanceof B?Qn(n,s):!1}else if(!(It&&t.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let l=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=n.docView.descAt(l))&&!o.contentDOM?B.isSelectable(i)?Qn(n,new B(e<0?n.state.doc.resolve(s.pos-i.nodeSize):s)):ll?Qn(n,new U(n.state.doc.resolve(e<0?l:l+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof B&&r.node.isInline)return Qn(n,new U(e>0?r.$to:r.$from));{let s=pf(n.state,e);return s?Qn(n,s):!1}}}function Xa(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function ko(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function ks(n,e){return e<0?uE(n):cE(n)}function uE(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s,i,o=!1;for(sn&&t.nodeType==1&&r<Xa(t)&&ko(t.childNodes[r],-1)&&(o=!0);;)if(r>0){if(t.nodeType!=1)break;{let l=t.childNodes[r-1];if(ko(l,-1))s=t,i=--r;else if(l.nodeType==3)t=l,r=t.nodeValue.length;else break}}else{if(a1(t))break;{let l=t.previousSibling;for(;l&&ko(l,-1);)s=t.parentNode,i=Be(l),l=l.previousSibling;if(l)t=l,r=Xa(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}o?mf(n,t,r):s&&mf(n,s,i)}function cE(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s=Xa(t),i,o;for(;;)if(r<s){if(t.nodeType!=1)break;let l=t.childNodes[r];if(ko(l,1))i=t,o=++r;else break}else{if(a1(t))break;{let l=t.nextSibling;for(;l&&ko(l,1);)i=l.parentNode,o=Be(l)+1,l=l.nextSibling;if(l)t=l,r=0,s=Xa(t);else{if(t=t.parentNode,t==n.dom)break;r=s=0}}}i&&mf(n,i,o)}function a1(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function dE(n,e){for(;n&&e==n.childNodes.length&&!ol(n);)e=Be(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function fE(n,e){for(;n&&!e&&!ol(n);)e=Be(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function mf(n,e,t){if(e.nodeType!=3){let i,o;(o=dE(e,t))?(e=o,t=0):(i=fE(e,t))&&(e=i,t=i.nodeValue.length)}let r=n.domSelection();if(!r)return;if(Nu(r)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&$n(n)},50)}function Pg(n,e){let t=n.state.doc.resolve(e);if(!(Xe||RC)&&t.parent.inlineContent){let s=n.coordsAtPos(e);if(e>t.start()){let i=n.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<t.end()){let i=n.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Ig(n,e,t){let r=n.state.selection;if(r instanceof U&&!r.empty||t.indexOf("s")>-1||It&&t.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=pf(n.state,e);if(o&&o instanceof B)return Qn(n,o)}if(!s.parent.inlineContent){let o=e<0?s:i,l=r instanceof zt?W.near(o,e):W.findFrom(o,e);return l?Qn(n,l):!1}return!1}function Rg(n,e){if(!(n.state.selection instanceof U))return!0;let{$head:t,$anchor:r,empty:s}=n.state.selection;if(!t.sameParent(r))return!0;if(!s)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let o=n.state.tr;return e<0?o.delete(t.pos-i.nodeSize,t.pos):o.delete(t.pos,t.pos+i.nodeSize),n.dispatch(o),!0}return!1}function Dg(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function hE(n){if(!st||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Dg(n,r,"true"),setTimeout(()=>Dg(n,r,"false"),20)}return!1}function pE(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function mE(n,e){let t=e.keyCode,r=pE(e);if(t==8||It&&t==72&&r=="c")return Rg(n,-1)||ks(n,-1);if(t==46&&!e.shiftKey||It&&t==68&&r=="c")return Rg(n,1)||ks(n,1);if(t==13||t==27)return!0;if(t==37||It&&t==66&&r=="c"){let s=t==37?Pg(n,n.state.selection.from)=="ltr"?-1:1:-1;return Ng(n,s,r)||ks(n,s)}else if(t==39||It&&t==70&&r=="c"){let s=t==39?Pg(n,n.state.selection.from)=="ltr"?1:-1:1;return Ng(n,s,r)||ks(n,s)}else{if(t==38||It&&t==80&&r=="c")return Ig(n,-1,r)||ks(n,-1);if(t==40||It&&t==78&&r=="c")return hE(n)||Ig(n,1,r)||ks(n,1);if(r==(It?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function qh(n,e){n.someProp("transformCopied",h=>{e=h(e,n)});let t=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let h=r.firstChild;t.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=n.someProp("clipboardSerializer")||cs.fromSchema(n.state.schema),l=p1(),a=l.createElement("div");a.appendChild(o.serializeFragment(r,{document:l}));let u=a.firstChild,c,d=0;for(;u&&u.nodeType==1&&(c=h1[u.nodeName.toLowerCase()]);){for(let h=c.length-1;h>=0;h--){let p=l.createElement(c[h]);for(;a.firstChild;)p.appendChild(a.firstChild);a.appendChild(p),d++}u=a.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${i}${d?` -${d}`:""} ${JSON.stringify(t)}`);let f=n.someProp("clipboardTextSerializer",h=>h(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:a,text:f,slice:e}}function u1(n,e,t,r,s){let i=s.parent.type.spec.code,o,l;if(!t&&!e)return null;let a=e&&(r||i||!t);if(a){if(n.someProp("transformPastedText",f=>{e=f(e,i||r,n)}),i)return e?new N(E.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):N.empty;let d=n.someProp("clipboardTextParser",f=>f(e,s,r,n));if(d)l=d;else{let f=s.marks(),{schema:h}=n.state,p=cs.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let v=o.appendChild(document.createElement("p"));m&&v.appendChild(p.serializeNode(h.text(m,f)))})}}else n.someProp("transformPastedHTML",d=>{t=d(t,n)}),o=wE(t),ll&&kE(o);let u=o&&o.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let d=+c[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(n.someProp("clipboardParser")||n.someProp("domParser")||yo.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(a||c),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!gE.test(f.parentNode.nodeName)?{ignore:!0}:null}})),c)l=xE($g(l,+c[1],+c[2]),c[4]);else if(l=N.maxOpen(yE(l.content,s),!0),l.openStart||l.openEnd){let d=0,f=0;for(let h=l.content.firstChild;d<l.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=l.content.lastChild;f<l.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);l=$g(l,d,f)}return n.someProp("transformPasted",d=>{l=d(l,n)}),l}const gE=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function yE(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.index(t)),i,o=[];if(n.forEach(l=>{if(!o)return;let a=s.findWrapping(l.type),u;if(!a)return o=null;if(u=o.length&&i.length&&d1(a,i,l,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=f1(o[o.length-1],i.length));let c=c1(l,a);o.push(c),s=s.matchType(c.type),i=a}}),o)return E.from(o)}return n}function c1(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,E.from(n));return n}function d1(n,e,t,r,s){if(s<n.length&&s<e.length&&n[s]==e[s]){let i=d1(n,e,t,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==n.length-1?t.type:n[s+1]))return r.copy(r.content.append(E.from(c1(t,n,s+1))))}}function f1(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,f1(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(E.empty,!0);return n.copy(t.append(r))}function gf(n,e,t,r,s,i){let o=e<0?n.firstChild:n.lastChild,l=o.content;return n.childCount>1&&(i=0),s<r-1&&(l=gf(l,e,t,r,s+1,i)),s>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,i<=s).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(E.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(l))}function $g(n,e,t){return e<n.openStart&&(n=new N(gf(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new N(gf(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const h1={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Lg=null;function p1(){return Lg||(Lg=document.implementation.createHTMLDocument("title"))}let Ic=null;function vE(n){let e=window.trustedTypes;return e?(Ic||(Ic=e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),Ic.createHTML(n)):n}function wE(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=p1().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),s;if((s=r&&h1[r[1].toLowerCase()])&&(n=s.map(i=>"<"+i+">").join("")+n+s.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=vE(n),s)for(let i=0;i<s.length;i++)t=t.querySelector(s[i])||t;return t}function kE(n){let e=n.querySelectorAll(Xe?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function xE(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:s,openStart:i,openEnd:o}=n;for(let l=r.length-2;l>=0;l-=2){let a=t.nodes[r[l]];if(!a||a.hasRequiredAttrs())break;s=E.from(a.create(r[l+1],s)),i++,o++}return new N(s,i,o)}const it={},ot={},SE={touchstart:!0,touchmove:!0};class bE{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function _E(n){for(let e in it){let t=it[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{EE(n,r)&&!Jh(n,r)&&(n.editable||!(r.type in ot))&&t(n,r)},SE[e]?{passive:!0}:void 0)}st&&n.dom.addEventListener("input",()=>null),yf(n)}function lr(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function CE(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function yf(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>Jh(n,r))})}function Jh(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}function EE(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function TE(n,e){!Jh(n,e)&&it[e.type]&&(n.editable||!(e.type in ot))&&it[e.type](n,e)}ot.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!g1(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Rn&&Xe&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),yi&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",s=>s(n,Rr(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||mE(n,t)?t.preventDefault():lr(n,"key")};ot.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};ot.keypress=(n,e)=>{let t=e;if(g1(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||It&&t.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof U)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(t.charCode);!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",i=>i(n,r.$from.pos,r.$to.pos,s))&&n.dispatch(n.state.tr.insertText(s).scrollIntoView()),t.preventDefault()}};function Iu(n){return{left:n.clientX,top:n.clientY}}function OE(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function Kh(n,e,t,r,s){if(r==-1)return!1;let i=n.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(n.someProp(e,l=>o>i.depth?l(n,t,i.nodeAfter,i.before(o),s,!0):l(n,t,i.node(o),i.before(o),s,!1)))return!0;return!1}function ti(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let r=n.state.tr.setSelection(e);r.setMeta("pointer",!0),n.dispatch(r)}function ME(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&B.isSelectable(r)?(ti(n,new B(t)),!0):!1}function AE(n,e){if(e==-1)return!1;let t=n.state.selection,r,s;t instanceof B&&(r=t.node);let i=n.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let l=o>i.depth?i.nodeAfter:i.node(o);if(B.isSelectable(l)){r&&t.$from.depth>0&&o>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?s=i.before(t.$from.depth):s=i.before(o);break}}return s!=null?(ti(n,B.create(n.state.doc,s)),!0):!1}function NE(n,e,t,r,s){return Kh(n,"handleClickOn",e,t,r)||n.someProp("handleClick",i=>i(n,e,r))||(s?AE(n,t):ME(n,t))}function PE(n,e,t,r){return Kh(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",s=>s(n,e,r))}function IE(n,e,t,r){return Kh(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",s=>s(n,e,r))||RE(n,t,r)}function RE(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(ti(n,U.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),l=s.before(i);if(o.inlineContent)ti(n,U.create(r,l+1,l+1+o.content.size));else if(B.isSelectable(o))ti(n,B.create(r,l));else continue;return!0}}function Gh(n){return Ya(n)}const m1=It?"metaKey":"ctrlKey";it.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=Gh(n),s=Date.now(),i="singleClick";s-n.input.lastClick.time<500&&OE(t,n.input.lastClick)&&!t[m1]&&(n.input.lastClick.type=="singleClick"?i="doubleClick":n.input.lastClick.type=="doubleClick"&&(i="tripleClick")),n.input.lastClick={time:s,x:t.clientX,y:t.clientY,type:i};let o=n.posAtCoords(Iu(t));o&&(i=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new DE(n,o,t,!!r)):(i=="doubleClick"?PE:IE)(n,o.pos,o.inside,t)?t.preventDefault():lr(n,"pointer"))};class DE{constructor(e,t,r,s){this.view=e,this.pos=t,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[m1],this.allowDefault=r.shiftKey;let i,o;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let c=e.state.doc.resolve(t.pos);i=c.parent,o=c.depth?c.before():0}const l=s?null:r.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a&&a.dom.nodeType==1?a.dom:null;let{selection:u}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||u instanceof B&&u.from<=o&&u.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&sn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),lr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>$n(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Iu(e))),this.updateAllowDefault(e),this.allowDefault||!t?lr(this.view,"pointer"):NE(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||st&&this.mightDrag&&!this.mightDrag.node.isAtom||Xe&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ti(this.view,W.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):lr(this.view,"pointer")}move(e){this.updateAllowDefault(e),lr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}it.touchstart=n=>{n.input.lastTouch=Date.now(),Gh(n),lr(n,"pointer")};it.touchmove=n=>{n.input.lastTouch=Date.now(),lr(n,"pointer")};it.contextmenu=n=>Gh(n);function g1(n,e){return n.composing?!0:st&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const $E=Rn?5e3:-1;ot.compositionstart=ot.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof U&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||t.marks(),Ya(n,!0),n.markCursor=null;else if(Ya(n,!e.selection.empty),sn&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let l=n.domSelection();l&&l.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}n.input.composing=!0}y1(n,$E)};ot.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,y1(n,20))};function y1(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>Ya(n),e))}function v1(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=jE());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function LE(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=MC(e.focusNode,e.focusOffset),r=AC(e.focusNode,e.focusOffset);if(t&&r&&t!=r){let s=r.pmViewDesc,i=n.domObserver.lastChangedTextNode;if(t==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(n.input.compositionNode==r){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return r}}return t||r}function jE(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Ya(n,e=!1){if(!(Rn&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),v1(n),e||n.docView&&n.docView.dirty){let t=Hh(n);return t&&!t.eq(n.state.selection)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!n.state.selection.empty?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function FE(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const Jo=vt&&yr<15||yi&&DC<604;it.copy=ot.cut=(n,e)=>{let t=e,r=n.state.selection,s=t.type=="cut";if(r.empty)return;let i=Jo?null:t.clipboardData,o=r.content(),{dom:l,text:a}=qh(n,o);i?(t.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",a)):FE(n,l),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function zE(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function BE(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?Ko(n,r.value,null,s,e):Ko(n,r.textContent,r.innerHTML,s,e)},50)}function Ko(n,e,t,r,s){let i=u1(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",a=>a(n,s,i||N.empty)))return!0;if(!i)return!1;let o=zE(i),l=o?n.state.tr.replaceSelectionWith(o,r):n.state.tr.replaceSelection(i);return n.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function w1(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}ot.paste=(n,e)=>{let t=e;if(n.composing&&!Rn)return;let r=Jo?null:t.clipboardData,s=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&Ko(n,w1(r),r.getData("text/html"),s,t)?t.preventDefault():BE(n,t)};class k1{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}}const UE=It?"altKey":"ctrlKey";function x1(n,e){let t=n.someProp("dragCopies",r=>!r(e));return t??!e[UE]}it.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let s=n.state.selection,i=s.empty?null:n.posAtCoords(Iu(t)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof B?s.to-1:s.to))){if(r&&r.mightDrag)o=B.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=n.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=n.docView&&(o=B.create(n.state.doc,d.posBefore))}}let l=(o||n.state.selection).content(),{dom:a,text:u,slice:c}=qh(n,l);(!t.dataTransfer.files.length||!Xe||Jw>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Jo?"Text":"text/html",a.innerHTML),t.dataTransfer.effectAllowed="copyMove",Jo||t.dataTransfer.setData("text/plain",u),n.dragging=new k1(c,x1(n,t),o)};it.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};ot.dragover=ot.dragenter=(n,e)=>e.preventDefault();ot.drop=(n,e)=>{let t=e,r=n.dragging;if(n.dragging=null,!t.dataTransfer)return;let s=n.posAtCoords(Iu(t));if(!s)return;let i=n.state.doc.resolve(s.pos),o=r&&r.slice;o?n.someProp("transformPasted",p=>{o=p(o,n)}):o=u1(n,w1(t.dataTransfer),Jo?null:t.dataTransfer.getData("text/html"),!1,i);let l=!!(r&&x1(n,t));if(n.someProp("handleDrop",p=>p(n,t,o||N.empty,l))){t.preventDefault();return}if(!o)return;t.preventDefault();let a=o?Fw(n.state.doc,i.pos,o):i.pos;a==null&&(a=i.pos);let u=n.state.tr;if(l){let{node:p}=r;p?p.replace(u):u.deleteSelection()}let c=u.mapping.map(a),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=u.doc;if(d?u.replaceRangeWith(c,c,o.content.firstChild):u.replaceRange(c,c,o),u.doc.eq(f))return;let h=u.doc.resolve(c);if(d&&B.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new B(h));else{let p=u.mapping.map(a);u.mapping.maps[u.mapping.maps.length-1].forEach((m,v,y,g)=>p=g),u.setSelection(Wh(n,h,u.doc.resolve(p)))}n.focus(),n.dispatch(u.setMeta("uiEvent","drop"))};it.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&$n(n)},20))};it.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};it.beforeinput=(n,e)=>{if(Xe&&Rn&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",i=>i(n,Rr(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in ot)it[n]=ot[n];function Go(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class Za{constructor(e,t){this.toDOM=e,this.spec=t||Gr,this.side=this.spec.side||0}map(e,t,r,s){let{pos:i,deleted:o}=e.mapResult(t.from+s,this.side<0?-1:1);return o?null:new jt(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Za&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Go(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class wr{constructor(e,t){this.attrs=e,this.spec=t||Gr}map(e,t,r,s){let i=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new jt(i,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof wr&&Go(this.attrs,e.attrs)&&Go(this.spec,e.spec)}static is(e){return e.type instanceof wr}destroy(){}}class Qh{constructor(e,t){this.attrs=e,this.spec=t||Gr}map(e,t,r,s){let i=e.mapResult(t.from+s,1);if(i.deleted)return null;let o=e.mapResult(t.to+s,-1);return o.deleted||o.pos<=i.pos?null:new jt(i.pos-r,o.pos-r,this)}valid(e,t){let{index:r,offset:s}=e.content.findIndex(t.from),i;return s==t.from&&!(i=e.child(r)).isText&&s+i.nodeSize==t.to}eq(e){return this==e||e instanceof Qh&&Go(this.attrs,e.attrs)&&Go(this.spec,e.spec)}destroy(){}}class jt{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new jt(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new jt(e,e,new Za(t,r))}static inline(e,t,r,s){return new jt(e,t,new wr(r,s))}static node(e,t,r,s){return new jt(e,t,new Qh(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof wr}get widget(){return this.type instanceof Za}}const Os=[],Gr={};class Ee{constructor(e,t){this.local=e.length?e:Os,this.children=t.length?t:Os}static create(e,t){return t.length?eu(t,e,0,Gr):Ge}find(e,t,r){let s=[];return this.findInner(e??0,t??1e9,s,0,r),s}findInner(e,t,r,s,i){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!i||i(l.spec))&&r.push(l.copy(l.from+s,l.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,r,s+l,i)}}map(e,t,r){return this==Ge||e.maps.length==0?this:this.mapInner(e,t,0,0,r||Gr)}mapInner(e,t,r,s,i){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,r,s);a&&a.type.valid(t,a)?(o||(o=[])).push(a):i.onRemove&&i.onRemove(this.local[l].spec)}return this.children.length?VE(this.children,o||[],e,t,r,s,i):o?new Ee(o.sort(Qr),Os):Ge}add(e,t){return t.length?this==Ge?Ee.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let s,i=0;e.forEach((l,a)=>{let u=a+r,c;if(c=b1(t,l,u)){for(s||(s=this.children.slice());i<s.length&&s[i]<a;)i+=3;s[i]==a?s[i+2]=s[i+2].addInner(l,c,u+1):s.splice(i,0,a,a+l.nodeSize,eu(c,l,u+1,Gr)),i+=3}});let o=S1(i?_1(t):t,-r);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new Ee(o.length?this.local.concat(o).sort(Qr):this.local,s||this.children)}remove(e){return e.length==0||this==Ge?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,l=r[i]+t,a=r[i+1]+t;for(let c=0,d;c<e.length;c++)(d=e[c])&&d.from>l&&d.to<a&&(e[c]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let u=r[i+2].removeInner(o,l+1);u!=Ge?r[i+2]=u:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let l=0;l<s.length;l++)s[l].eq(o,t)&&(s==this.local&&(s=this.local.slice()),s.splice(l--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new Ee(s,r):Ge}forChild(e,t){if(this==Ge)return this;if(t.isLeaf)return Ee.empty;let r,s;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(r=this.children[l+2]);break}let i=e+1,o=i+t.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>i&&a.type instanceof wr){let u=Math.max(i,a.from)-i,c=Math.min(o,a.to)-i;u<c&&(s||(s=[])).push(a.copy(u,c))}}if(s){let l=new Ee(s.sort(Qr),Os);return r?new tr([l,r]):l}return r||Ge}eq(e){if(this==e)return!0;if(!(e instanceof Ee)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Xh(this.localsInner(e))}localsInner(e){if(this==Ge)return Os;if(e.inlineContent||!this.local.some(wr.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof wr||t.push(this.local[r]);return t}forEachSet(e){e(this)}}Ee.empty=new Ee([],[]);Ee.removeOverlap=Xh;const Ge=Ee.empty;class tr{constructor(e){this.members=e}map(e,t){const r=this.members.map(s=>s.map(e,t,Gr));return tr.from(r)}forChild(e,t){if(t.isLeaf)return Ee.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,t);i!=Ge&&(i instanceof tr?r=r.concat(i.members):r.push(i))}return tr.from(r)}eq(e){if(!(e instanceof tr)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!t)t=i;else{r&&(t=t.slice(),r=!1);for(let o=0;o<i.length;o++)t.push(i[o])}}return t?Xh(r?t:t.sort(Qr)):Os}static from(e){switch(e.length){case 0:return Ge;case 1:return e[0];default:return new tr(e.every(t=>t instanceof Ee)?e:e.reduce((t,r)=>t.concat(r instanceof Ee?r:r.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function VE(n,e,t,r,s,i,o){let l=n.slice();for(let u=0,c=i;u<t.maps.length;u++){let d=0;t.maps[u].forEach((f,h,p,m)=>{let v=m-p-(h-f);for(let y=0;y<l.length;y+=3){let g=l[y+1];if(g<0||f>g+c-d)continue;let w=l[y]+c-d;h>=w?l[y+1]=f<=w?-2:-1:f>=c&&v&&(l[y]+=v,l[y+1]+=v)}d+=v}),c=t.maps[u].map(c,-1)}let a=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){a=!0,l[u+1]=-1;continue}let c=t.map(n[u]+i),d=c-s;if(d<0||d>=r.content.size){a=!0;continue}let f=t.map(n[u+1]+i,-1),h=f-s,{index:p,offset:m}=r.content.findIndex(d),v=r.maybeChild(p);if(v&&m==d&&m+v.nodeSize==h){let y=l[u+2].mapInner(t,v,c+1,n[u]+i+1,o);y!=Ge?(l[u]=d,l[u+1]=h,l[u+2]=y):(l[u+1]=-2,a=!0)}else a=!0}if(a){let u=HE(l,n,e,t,s,i,o),c=eu(u,r,0,o);e=c.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<c.children.length;d+=3){let h=c.children[d];for(;f<l.length&&l[f]<h;)f+=3;l.splice(f,0,c.children[d],c.children[d+1],c.children[d+2])}}return new Ee(e.sort(Qr),l)}function S1(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let s=n[r];t.push(new jt(s.from+e,s.to+e,s.type))}return t}function HE(n,e,t,r,s,i,o){function l(a,u){for(let c=0;c<a.local.length;c++){let d=a.local[c].map(r,s,u);d?t.push(d):o.onRemove&&o.onRemove(a.local[c].spec)}for(let c=0;c<a.children.length;c+=3)l(a.children[c+2],a.children[c]+u+1)}for(let a=0;a<n.length;a+=3)n[a+1]==-1&&l(n[a+2],e[a]+i+1);return t}function b1(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,s=null;for(let i=0,o;i<n.length;i++)(o=n[i])&&o.from>t&&o.to<r&&((s||(s=[])).push(o),n[i]=null);return s}function _1(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function eu(n,e,t,r){let s=[],i=!1;e.forEach((l,a)=>{let u=b1(n,l,a+t);if(u){i=!0;let c=eu(u,l,t+a+1,r);c!=Ge&&s.push(a,a+l.nodeSize,c)}});let o=S1(i?_1(n):n,-t).sort(Qr);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(r.onRemove&&r.onRemove(o[l].spec),o.splice(l--,1));return o.length||s.length?new Ee(o,s):Ge}function Qr(n,e){return n.from-e.from||n.to-e.to}function Xh(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let s=t+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==n&&(e=n.slice()),e[s]=i.copy(i.from,r.to),jg(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,i.from),jg(e,s,r.copy(i.from,r.to)));break}}}return e}function jg(n,e,t){for(;e<n.length&&Qr(t,n[e])>0;)e++;n.splice(e,0,t)}function Rc(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=Ge&&e.push(r)}),n.cursorWrapper&&e.push(Ee.create(n.state.doc,[n.cursorWrapper.deco])),tr.from(e)}const WE={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},qE=vt&&yr<=11;class JE{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class KE{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new JE,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);vt&&yr<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),qE&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,WE)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Ag(this.view)){if(this.suppressingSelectionUpdates)return $n(this.view);if(vt&&yr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&ss(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let i=e.focusNode;i;i=gi(i))t.add(i);for(let i=e.anchorNode;i;i=gi(i))if(t.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Ag(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,l=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let d=this.registerMutation(t[c],a);d&&(i=i<0?d.from:Math.min(d.from,i),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(l=!0))}if(sn&&a.length){let c=a.filter(d=>d.nodeName=="BR");if(c.length==2){let[d,f]=c;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of c){let h=f.parentNode;h&&h.nodeName=="LI"&&(!d||XE(e,d)!=h)&&f.remove()}}}let u=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Nu(r)&&(u=Hh(e))&&u.eq(W.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,$n(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),GE(e)),this.handleDOMChange(i,o,l,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||$n(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++){let d=e.addedNodes[c];t.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(vt&&yr<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:d,nextSibling:f}=e.addedNodes[c];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(s=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=s&&s.parentNode==e.target?Be(s)+1:0,l=r.localPosFromDOM(e.target,o,-1),a=i&&i.parentNode==e.target?Be(i):e.target.childNodes.length,u=r.localPosFromDOM(e.target,a,1);return{from:l,to:u}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Fg=new WeakMap,zg=!1;function GE(n){if(!Fg.has(n)&&(Fg.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=sn,zg)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),zg=!0}}function Bg(n,e){let t=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return ss(o.node,o.offset,s,i)&&([t,r,s,i]=[s,i,t,r]),{anchorNode:t,anchorOffset:r,focusNode:s,focusOffset:i}}function QE(n,e){if(e.getComposedRanges){let s=e.getComposedRanges(n.root)[0];if(s)return Bg(n,s)}let t;function r(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",r,!0),t?Bg(n,t):null}function XE(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let r=n.docView.nearestDesc(t,!0);if(r&&r.node.isBlock)return t}return null}function YE(n,e,t){let{node:r,fromOffset:s,toOffset:i,from:o,to:l}=n.docView.parseRange(e,t),a=n.domSelectionRange(),u,c=a.anchorNode;if(c&&n.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:a.anchorOffset}],Nu(a)||u.push({node:a.focusNode,offset:a.focusOffset})),Xe&&n.input.lastKeyCode===8)for(let v=i;v>s;v--){let y=r.childNodes[v-1],g=y.pmViewDesc;if(y.nodeName=="BR"&&!g){i=v;break}if(!g||g.size)break}let d=n.state.doc,f=n.someProp("domParser")||yo.fromSchema(n.state.schema),h=d.resolve(o),p=null,m=f.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:s,to:i,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:ZE,context:h});if(u&&u[0].pos!=null){let v=u[0].pos,y=u[1]&&u[1].pos;y==null&&(y=v),p={anchor:v+o,head:y+o}}return{doc:m,sel:p,from:o,to:l}}function ZE(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(st&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||st&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const eT=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function tT(n,e,t,r,s){let i=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let T=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,A=Hh(n,T);if(A&&!n.state.selection.eq(A)){if(Xe&&Rn&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",ye=>ye(n,Rr(13,"Enter"))))return;let P=n.state.tr.setSelection(A);T=="pointer"?P.setMeta("pointer",!0):T=="key"&&P.scrollIntoView(),i&&P.setMeta("composition",i),n.dispatch(P)}return}let o=n.state.doc.resolve(e),l=o.sharedDepth(t);e=o.before(l+1),t=n.state.doc.resolve(t).after(l+1);let a=n.state.selection,u=YE(n,e,t),c=n.state.doc,d=c.slice(u.from,u.to),f,h;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(f=n.state.selection.to,h="end"):(f=n.state.selection.from,h="start"),n.input.lastKeyCode=null;let p=sT(d.content,u.doc.content,u.from,f,h);if(p&&n.input.domChangeCount++,(yi&&n.input.lastIOSEnter>Date.now()-225||Rn)&&s.some(T=>T.nodeType==1&&!eT.test(T.nodeName))&&(!p||p.endA>=p.endB)&&n.someProp("handleKeyDown",T=>T(n,Rr(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!p)if(r&&a instanceof U&&!a.empty&&a.$head.sameParent(a.$anchor)&&!n.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))p={start:a.from,endA:a.to,endB:a.to};else{if(u.sel){let T=Ug(n,n.state.doc,u.sel);if(T&&!T.eq(n.state.selection)){let A=n.state.tr.setSelection(T);i&&A.setMeta("composition",i),n.dispatch(A)}}return}n.state.selection.from<n.state.selection.to&&p.start==p.endB&&n.state.selection instanceof U&&(p.start>n.state.selection.from&&p.start<=n.state.selection.from+2&&n.state.selection.from>=u.from?p.start=n.state.selection.from:p.endA<n.state.selection.to&&p.endA>=n.state.selection.to-2&&n.state.selection.to<=u.to&&(p.endB+=n.state.selection.to-p.endA,p.endA=n.state.selection.to)),vt&&yr<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>u.from&&u.doc.textBetween(p.start-u.from-1,p.start-u.from+1)==" "&&(p.start--,p.endA--,p.endB--);let m=u.doc.resolveNoCache(p.start-u.from),v=u.doc.resolveNoCache(p.endB-u.from),y=c.resolve(p.start),g=m.sameParent(v)&&m.parent.inlineContent&&y.end()>=p.endA,w;if((yi&&n.input.lastIOSEnter>Date.now()-225&&(!g||s.some(T=>T.nodeName=="DIV"||T.nodeName=="P"))||!g&&m.pos<u.doc.content.size&&(!m.sameParent(v)||!m.parent.inlineContent)&&(w=W.findFrom(u.doc.resolve(m.pos+1),1,!0))&&w.head>m.pos)&&n.someProp("handleKeyDown",T=>T(n,Rr(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>p.start&&rT(c,p.start,p.endA,m,v)&&n.someProp("handleKeyDown",T=>T(n,Rr(8,"Backspace")))){Rn&&Xe&&n.domObserver.suppressSelectionUpdates();return}Xe&&p.endB==p.start&&(n.input.lastChromeDelete=Date.now()),Rn&&!g&&m.start()!=v.start()&&v.parentOffset==0&&m.depth==v.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==p.endA&&(p.endB-=2,v=u.doc.resolveNoCache(p.endB-u.from),setTimeout(()=>{n.someProp("handleKeyDown",function(T){return T(n,Rr(13,"Enter"))})},20));let k=p.start,S=p.endA,b,_,C;if(g){if(m.pos==v.pos)vt&&yr<=11&&m.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>$n(n),20)),b=n.state.tr.delete(k,S),_=c.resolve(p.start).marksAcross(c.resolve(p.endA));else if(p.endA==p.endB&&(C=nT(m.parent.content.cut(m.parentOffset,v.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start()))))b=n.state.tr,C.type=="add"?b.addMark(k,S,C.mark):b.removeMark(k,S,C.mark);else if(m.parent.child(m.index()).isText&&m.index()==v.index()-(v.textOffset?0:1)){let T=m.parent.textBetween(m.parentOffset,v.parentOffset);if(n.someProp("handleTextInput",A=>A(n,k,S,T)))return;b=n.state.tr.insertText(T,k,S)}}if(b||(b=n.state.tr.replace(k,S,u.doc.slice(p.start-u.from,p.endB-u.from))),u.sel){let T=Ug(n,b.doc,u.sel);T&&!(Xe&&n.composing&&T.empty&&(p.start!=p.endB||n.input.lastChromeDelete<Date.now()-100)&&(T.head==k||T.head==b.mapping.map(S)-1)||vt&&T.empty&&T.head==k)&&b.setSelection(T)}_&&b.ensureMarks(_),i&&b.setMeta("composition",i),n.dispatch(b.scrollIntoView())}function Ug(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:Wh(n,e.resolve(t.anchor),e.resolve(t.head))}function nT(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,s=t,i=r,o,l,a;for(let c=0;c<r.length;c++)s=r[c].removeFromSet(s);for(let c=0;c<t.length;c++)i=t[c].removeFromSet(i);if(s.length==1&&i.length==0)l=s[0],o="add",a=c=>c.mark(l.addToSet(c.marks));else if(s.length==0&&i.length==1)l=i[0],o="remove",a=c=>c.mark(l.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(a(e.child(c)));if(E.from(u).eq(n))return{mark:l,type:o}}function rT(n,e,t,r,s){if(t-e<=s.pos-r.pos||Dc(r,!0,!1)<s.pos)return!1;let i=n.resolve(e);if(!r.parent.isTextblock){let l=i.nodeAfter;return l!=null&&t==e+l.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=n.resolve(Dc(i,!0,!0));return!o.parent.isTextblock||o.pos>t||Dc(o,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function Dc(n,e,t){let r=n.depth,s=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,s++,e=!1;if(t){let i=n.node(r).maybeChild(n.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function sT(n,e,t,r,s){let i=n.findDiffStart(e,t);if(i==null)return null;let{a:o,b:l}=n.findDiffEnd(e,t+n.size,t+e.size);if(s=="end"){let a=Math.max(0,i-Math.min(o,l));r-=o+a-i}if(o<i&&n.size<e.size){let a=r<=i&&r>=o?i-r:0;i-=a,i&&i<e.size&&Vg(e.textBetween(i-1,i+1))&&(i+=a?1:-1),l=i+(l-o),o=i}else if(l<i){let a=r<=i&&r>=l?i-r:0;i-=a,i&&i<n.size&&Vg(n.textBetween(i-1,i+1))&&(i+=a?1:-1),o=i+(o-l),l=i}return{start:i,endA:o,endB:l}}function Vg(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class iT{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new bE,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Kg),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=qg(this),Wg(this),this.nodeViews=Jg(this),this.docView=_g(this.state.doc,Hg(this),Rc(this),this.dom,this),this.domObserver=new KE(this,(r,s,i,o)=>tT(this,r,s,i,o)),this.domObserver.start(),_E(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&yf(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Kg),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(v1(this),o=!0),this.state=e;let l=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(l||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let h=Jg(this);lT(h,this.nodeViews)&&(this.nodeViews=h,i=!0)}(l||t.handleDOMEvents!=this._props.handleDOMEvents)&&yf(this),this.editable=qg(this),Wg(this);let a=Rc(this),u=Hg(this),c=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",d=i||!this.docView.matchesNode(e.doc,u,a);(d||!e.selection.eq(s.selection))&&(o=!0);let f=c=="preserve"&&o&&this.dom.style.overflowAnchor==null&&jC(this);if(o){this.domObserver.stop();let h=d&&(vt||Xe)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&oT(s.selection,e.selection);if(d){let p=Xe?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=LE(this)),(i||!this.docView.update(e.doc,u,a,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=_g(e.doc,u,a,this.dom,this)),p&&!this.trackWrites&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&aE(this))?$n(this,h):(o1(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():f&&FC(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof B){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&vg(this,t.getBoundingClientRect(),e)}else vg(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new k1(e.slice,e.move,s<0?void 0:B.create(this.state.doc,s))}someProp(e,t){let r=this._props&&this._props[e],s;if(r!=null&&(s=t?t(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let l=this.directPlugins[o].props[e];if(l!=null&&(s=t?t(l):l))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let l=i[o].props[e];if(l!=null&&(s=t?t(l):l))return s}}hasFocus(){if(vt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&zC(this.dom),$n(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return WC(this,e)}coordsAtPos(e,t=1){return Yw(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let s=this.docView.posFromDOM(e,t,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return QC(this,t||this.state,e)}pasteHTML(e,t){return Ko(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Ko(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return qh(this,e)}destroy(){this.docView&&(CE(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Rc(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,TC())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return TE(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?st&&this.root.nodeType===11&&PC(this.dom.ownerDocument)==this.dom&&QE(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Hg(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[jt.node(0,n.state.doc.content.size,e)]}function Wg(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:jt.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function qg(n){return!n.someProp("editable",e=>e(n.state)===!1)}function oT(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function Jg(n){let e=Object.create(null);function t(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function lT(n,e){let t=0,r=0;for(let s in n){if(n[s]!=e[s])return!0;t++}for(let s in e)r++;return t!=r}function Kg(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Sr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},tu={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},aT=typeof navigator<"u"&&/Mac/.test(navigator.platform),uT=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Ue=0;Ue<10;Ue++)Sr[48+Ue]=Sr[96+Ue]=String(Ue);for(var Ue=1;Ue<=24;Ue++)Sr[Ue+111]="F"+Ue;for(var Ue=65;Ue<=90;Ue++)Sr[Ue]=String.fromCharCode(Ue+32),tu[Ue]=String.fromCharCode(Ue);for(var $c in Sr)tu.hasOwnProperty($c)||(tu[$c]=Sr[$c]);function cT(n){var e=aT&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||uT&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?tu:Sr)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const dT=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function fT(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,s,i,o;for(let l=0;l<e.length-1;l++){let a=e[l];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))i=!0;else if(/^mod$/i.test(a))dT?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+a)}return r&&(t="Alt-"+t),s&&(t="Ctrl-"+t),o&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function hT(n){let e=Object.create(null);for(let t in n)e[fT(t)]=n[t];return e}function Lc(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function pT(n){return new xt({props:{handleKeyDown:C1(n)}})}function C1(n){let e=hT(n);return function(t,r){let s=cT(r),i,o=e[Lc(s,r)];if(o&&o(t.state,t.dispatch,t))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let l=e[Lc(s,r,!1)];if(l&&l(t.state,t.dispatch,t))return!0}if((r.shiftKey||r.altKey||r.metaKey||s.charCodeAt(0)>127)&&(i=Sr[r.keyCode])&&i!=s){let l=e[Lc(i,r)];if(l&&l(t.state,t.dispatch,t))return!0}}return!1}}const mT=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function E1(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const gT=(n,e,t)=>{let r=E1(n,t);if(!r)return!1;let s=Yh(r);if(!s){let o=r.blockRange(),l=o&&Ti(o);return l==null?!1:(e&&e(n.tr.lift(o,l).scrollIntoView()),!0)}let i=s.nodeBefore;if(A1(n,s,e,-1))return!0;if(r.parent.content.size==0&&(vi(i,"end")||B.isSelectable(i)))for(let o=r.depth;;o--){let l=Mu(n.doc,r.before(o),r.after(o),N.empty);if(l&&l.slice.size<l.to-l.from){if(e){let a=n.tr.step(l);a.setSelection(vi(i,"end")?W.findFrom(a.doc.resolve(a.mapping.map(s.pos,-1)),-1):B.create(a.doc,s.pos-i.nodeSize)),e(a.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},yT=(n,e,t)=>{let r=E1(n,t);if(!r)return!1;let s=Yh(r);return s?T1(n,s,e):!1},vT=(n,e,t)=>{let r=O1(n,t);if(!r)return!1;let s=Zh(r);return s?T1(n,s,e):!1};function T1(n,e,t){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let c=s.lastChild;if(!c)return!1;s=c}let o=e.nodeAfter,l=o,a=e.pos+1;for(;!l.isTextblock;a++){if(l.type.spec.isolating)return!1;let c=l.firstChild;if(!c)return!1;l=c}let u=Mu(n.doc,i,a,N.empty);if(!u||u.from!=i||u instanceof Pe&&u.slice.size>=a-i)return!1;if(t){let c=n.tr.step(u);c.setSelection(U.create(c.doc,i)),t(c.scrollIntoView())}return!0}function vi(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}const wT=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;i=Yh(r)}let o=i&&i.nodeBefore;return!o||!B.isSelectable(o)?!1:(e&&e(n.tr.setSelection(B.create(n.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Yh(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function O1(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const kT=(n,e,t)=>{let r=O1(n,t);if(!r)return!1;let s=Zh(r);if(!s)return!1;let i=s.nodeAfter;if(A1(n,s,e,1))return!0;if(r.parent.content.size==0&&(vi(i,"start")||B.isSelectable(i))){let o=Mu(n.doc,r.before(),r.after(),N.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=n.tr.step(o);l.setSelection(vi(i,"start")?W.findFrom(l.doc.resolve(l.mapping.map(s.pos)),1):B.create(l.doc,l.mapping.map(s.pos))),e(l.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},xT=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;i=Zh(r)}let o=i&&i.nodeAfter;return!o||!B.isSelectable(o)?!1:(e&&e(n.tr.setSelection(B.create(n.doc,i.pos)).scrollIntoView()),!0)};function Zh(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const ST=(n,e)=>{let t=n.selection,r=t instanceof B,s;if(r){if(t.node.isTextblock||!Er(n.doc,t.from))return!1;s=t.from}else if(s=Ou(n.doc,t.from,-1),s==null)return!1;if(e){let i=n.tr.join(s);r&&i.setSelection(B.create(i.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},bT=(n,e)=>{let t=n.selection,r;if(t instanceof B){if(t.node.isTextblock||!Er(n.doc,t.to))return!1;r=t.to}else if(r=Ou(n.doc,t.to,1),r==null)return!1;return e&&e(n.tr.join(r).scrollIntoView()),!0},_T=(n,e)=>{let{$from:t,$to:r}=n.selection,s=t.blockRange(r),i=s&&Ti(s);return i==null?!1:(e&&e(n.tr.lift(s,i).scrollIntoView()),!0)},CT=(n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function M1(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const ET=(n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let s=t.node(-1),i=t.indexAfter(-1),o=M1(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let l=t.after(),a=n.tr.replaceWith(l,l,o.createAndFill());a.setSelection(W.near(a.doc.resolve(l),1)),e(a.scrollIntoView())}return!0},TT=(n,e)=>{let t=n.selection,{$from:r,$to:s}=t;if(t instanceof zt||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=M1(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,l=n.tr.insert(o,i.createAndFill());l.setSelection(U.create(l.doc,o+1)),e(l.scrollIntoView())}return!0},OT=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(Zs(n.doc,i))return e&&e(n.tr.split(i).scrollIntoView()),!0}let r=t.blockRange(),s=r&&Ti(r);return s==null?!1:(e&&e(n.tr.lift(r,s).scrollIntoView()),!0)},MT=(n,e)=>{let{$from:t,to:r}=n.selection,s,i=t.sharedDepth(r);return i==0?!1:(s=t.before(i),e&&e(n.tr.setSelection(B.create(n.doc,s))),!0)};function AT(n,e,t){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Er(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function A1(n,e,t,r){let s=e.nodeBefore,i=e.nodeAfter,o,l,a=s.type.spec.isolating||i.type.spec.isolating;if(!a&&AT(n,e,t))return!0;let u=!a&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(l=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&l.matchType(o[0]||i.type).validEnd){if(t){let h=e.pos+i.nodeSize,p=E.empty;for(let y=o.length-1;y>=0;y--)p=E.from(o[y].create(null,p));p=E.from(s.copy(p));let m=n.tr.step(new Re(e.pos-1,h,e.pos,h,new N(p,1,0),o.length,!0)),v=m.doc.resolve(h+2*o.length);v.nodeAfter&&v.nodeAfter.type==s.type&&Er(m.doc,v.pos)&&m.join(v.pos),t(m.scrollIntoView())}return!0}let c=i.type.spec.isolating||r>0&&a?null:W.findFrom(e,1),d=c&&c.$from.blockRange(c.$to),f=d&&Ti(d);if(f!=null&&f>=e.depth)return t&&t(n.tr.lift(d,f).scrollIntoView()),!0;if(u&&vi(i,"start",!0)&&vi(s,"end")){let h=s,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let m=i,v=1;for(;!m.isTextblock;m=m.firstChild)v++;if(h.canReplace(h.childCount,h.childCount,m.content)){if(t){let y=E.empty;for(let w=p.length-1;w>=0;w--)y=E.from(p[w].copy(y));let g=n.tr.step(new Re(e.pos-p.length,e.pos+i.nodeSize,e.pos+v,e.pos+i.nodeSize-v,new N(y,p.length,0),0,!0));t(g.scrollIntoView())}return!0}}return!1}function N1(n){return function(e,t){let r=e.selection,s=n<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(t&&t(e.tr.setSelection(U.create(e.doc,n<0?s.start(i):s.end(i)))),!0):!1}}const NT=N1(-1),PT=N1(1);function IT(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i),l=o&&Bh(o,n,e);return l?(r&&r(t.tr.wrap(o,l).scrollIntoView()),!0):!1}}function Gg(n,e=null){return function(t,r){let s=!1;for(let i=0;i<t.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:l}}=t.selection.ranges[i];t.doc.nodesBetween(o,l,(a,u)=>{if(s)return!1;if(!(!a.isTextblock||a.hasMarkup(n,e)))if(a.type==n)s=!0;else{let c=t.doc.resolve(u),d=c.index();s=c.parent.canReplaceWith(d,d+1,n)}})}if(!s)return!1;if(r){let i=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:a}}=t.selection.ranges[o];i.setBlockType(l,a,n,e)}r(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function RT(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i);if(!o)return!1;let l=r?t.tr:null;return DT(l,o,n,e)?(r&&r(l.scrollIntoView()),!0):!1}}function DT(n,e,t,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let a=o.resolve(e.start-2);i=new Ka(a,a,e.depth),e.endIndex<e.parent.childCount&&(e=new Ka(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let l=Bh(i,t,r,e);return l?(n&&$T(n,e,l,s,t),!0):!1}function $T(n,e,t,r,s){let i=E.empty;for(let c=t.length-1;c>=0;c--)i=E.from(t[c].type.create(t[c].attrs,i));n.step(new Re(e.start-(r?2:0),e.end,e.start,e.end,new N(i,0,0),t.length,!0));let o=0;for(let c=0;c<t.length;c++)t[c].type==s&&(o=c+1);let l=t.length-o,a=e.start+t.length-(r?2:0),u=e.parent;for(let c=e.startIndex,d=e.endIndex,f=!0;c<d;c++,f=!1)!f&&Zs(n.doc,a,l)&&(n.split(a,l),a+=2*l),a+=u.child(c).nodeSize;return n}function LT(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==n);return i?t?r.node(i.depth-1).type==n?jT(e,t,n,i):FT(e,t,i):!0:!1}}function jT(n,e,t,r){let s=n.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Re(i-1,o,i,o,new N(E.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new Ka(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const l=Ti(r);if(l==null)return!1;s.lift(r,l);let a=s.doc.resolve(s.mapping.map(i,-1)-1);return Er(s.doc,a.pos)&&a.nodeBefore.type==a.nodeAfter.type&&s.join(a.pos),e(s.scrollIntoView()),!0}function FT(n,e,t){let r=n.tr,s=t.parent;for(let h=t.end,p=t.endIndex-1,m=t.startIndex;p>m;p--)h-=s.child(p).nodeSize,r.delete(h-1,h+1);let i=r.doc.resolve(t.start),o=i.nodeAfter;if(r.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,a=t.endIndex==s.childCount,u=i.node(-1),c=i.index(-1);if(!u.canReplace(c+(l?0:1),c+1,o.content.append(a?E.empty:E.from(s))))return!1;let d=i.pos,f=d+o.nodeSize;return r.step(new Re(d-(l?1:0),f+(a?1:0),d+1,f-1,new N((l?E.empty:E.from(s.copy(E.empty))).append(a?E.empty:E.from(s.copy(E.empty))),l?0:1,a?0:1),l?0:1)),e(r.scrollIntoView()),!0}function zT(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,u=>u.childCount>0&&u.firstChild.type==n);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let l=i.parent,a=l.child(o-1);if(a.type!=n)return!1;if(t){let u=a.lastChild&&a.lastChild.type==l.type,c=E.from(u?n.create():null),d=new N(E.from(n.create(null,E.from(l.type.create(null,c)))),u?3:1,0),f=i.start,h=i.end;t(e.tr.step(new Re(f-(u?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}function Ru(n){const{state:e,transaction:t}=n;let{selection:r}=t,{doc:s}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=t.selection,s=t.doc,i=t.storedMarks,t}}}class Du{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:r}=this,{view:s}=t,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([l,a])=>[l,(...c)=>{const d=a(...c)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,l=[],a=!!e,u=e||i.tr,c=()=>(!a&&t&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),l.every(f=>f===!0)),d={...Object.fromEntries(Object.entries(r).map(([f,h])=>[f,(...m)=>{const v=this.buildProps(u,t),y=h(...m)(v);return l.push(y),d}])),run:c};return d}createCan(e){const{rawCommands:t,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(t).map(([a,u])=>[a,(...c)=>u(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,l={tr:e,editor:s,view:o,state:Ru({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([a,u])=>[a,(...c)=>u(...c)(l)]))}};return l}}class BT{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,t)),this}off(e,t){const r=this.callbacks[e];return r&&(t?this.callbacks[e]=r.filter(s=>s!==t):delete this.callbacks[e]),this}once(e,t){const r=(...s)=>{this.off(e,r),t.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function L(n,e,t){return n.config[e]===void 0&&n.parent?L(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?L(n.parent,e,t):null}):n.config[e]}function $u(n){const e=n.filter(s=>s.type==="extension"),t=n.filter(s=>s.type==="node"),r=n.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:r}}function P1(n){const e=[],{nodeExtensions:t,markExtensions:r}=$u(n),s=[...t,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage,extensions:s},a=L(o,"addGlobalAttributes",l);if(!a)return;a().forEach(c=>{c.types.forEach(d=>{Object.entries(c.attributes).forEach(([f,h])=>{e.push({type:d,name:f,attribute:{...i,...h}})})})})}),s.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage},a=L(o,"addAttributes",l);if(!a)return;const u=a();Object.entries(u).forEach(([c,d])=>{const f={...i,...d};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:c,attribute:f})})}),e}function $e(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}function Ze(...n){return n.filter(e=>!!e).reduce((e,t)=>{const r={...e};return Object.entries(t).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const l=i?String(i).split(" "):[],a=r[s]?r[s].split(" "):[],u=l.filter(c=>!a.includes(c));r[s]=[...a,...u].join(" ")}else if(s==="style"){const l=i?i.split(";").map(c=>c.trim()).filter(Boolean):[],a=r[s]?r[s].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;a.forEach(c=>{const[d,f]=c.split(":").map(h=>h.trim());u.set(d,f)}),l.forEach(c=>{const[d,f]=c.split(":").map(h=>h.trim());u.set(d,f)}),r[s]=Array.from(u.entries()).map(([c,d])=>`${c}: ${d}`).join("; ")}else r[s]=i}),r},{})}function vf(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,r)=>Ze(t,r),{})}function I1(n){return typeof n=="function"}function K(n,e=void 0,...t){return I1(n)?e?n.bind(e)(...t):n(...t):n}function UT(n={}){return Object.keys(n).length===0&&n.constructor===Object}function VT(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function Qg(n,e){return"style"in n?n:{...n,getAttrs:t=>{const r=n.getAttrs?n.getAttrs(t):n.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const l=o.attribute.parseHTML?o.attribute.parseHTML(t):VT(t.getAttribute(o.name));return l==null?i:{...i,[o.name]:l}},{});return{...r,...s}}}}function Xg(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&UT(t)?!1:t!=null))}function HT(n,e){var t;const r=P1(n),{nodeExtensions:s,markExtensions:i}=$u(n),o=(t=s.find(u=>L(u,"topNode")))===null||t===void 0?void 0:t.name,l=Object.fromEntries(s.map(u=>{const c=r.filter(y=>y.type===u.name),d={name:u.name,options:u.options,storage:u.storage,editor:e},f=n.reduce((y,g)=>{const w=L(g,"extendNodeSchema",d);return{...y,...w?w(u):{}}},{}),h=Xg({...f,content:K(L(u,"content",d)),marks:K(L(u,"marks",d)),group:K(L(u,"group",d)),inline:K(L(u,"inline",d)),atom:K(L(u,"atom",d)),selectable:K(L(u,"selectable",d)),draggable:K(L(u,"draggable",d)),code:K(L(u,"code",d)),whitespace:K(L(u,"whitespace",d)),linebreakReplacement:K(L(u,"linebreakReplacement",d)),defining:K(L(u,"defining",d)),isolating:K(L(u,"isolating",d)),attrs:Object.fromEntries(c.map(y=>{var g;return[y.name,{default:(g=y==null?void 0:y.attribute)===null||g===void 0?void 0:g.default}]}))}),p=K(L(u,"parseHTML",d));p&&(h.parseDOM=p.map(y=>Qg(y,c)));const m=L(u,"renderHTML",d);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:vf(y,c)}));const v=L(u,"renderText",d);return v&&(h.toText=v),[u.name,h]})),a=Object.fromEntries(i.map(u=>{const c=r.filter(v=>v.type===u.name),d={name:u.name,options:u.options,storage:u.storage,editor:e},f=n.reduce((v,y)=>{const g=L(y,"extendMarkSchema",d);return{...v,...g?g(u):{}}},{}),h=Xg({...f,inclusive:K(L(u,"inclusive",d)),excludes:K(L(u,"excludes",d)),group:K(L(u,"group",d)),spanning:K(L(u,"spanning",d)),code:K(L(u,"code",d)),attrs:Object.fromEntries(c.map(v=>{var y;return[v.name,{default:(y=v==null?void 0:v.attribute)===null||y===void 0?void 0:y.default}]}))}),p=K(L(u,"parseHTML",d));p&&(h.parseDOM=p.map(v=>Qg(v,c)));const m=L(u,"renderHTML",d);return m&&(h.toDOM=v=>m({mark:v,HTMLAttributes:vf(v,c)})),[u.name,h]}));return new Ow({topNode:o,nodes:l,marks:a})}function jc(n,e){return e.nodes[n]||e.marks[n]||null}function Yg(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function ep(n,e){const t=cs.fromSchema(e).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(t),s.innerHTML}const WT=(n,e=500)=>{let t="";const r=n.parentOffset;return n.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,l)=>{var a,u;const c=((u=(a=s.type.spec).toText)===null||u===void 0?void 0:u.call(a,{node:s,pos:i,parent:o,index:l}))||s.textContent||"%leaf%";t+=s.isAtom&&!s.isText?c:c.slice(0,Math.max(0,r-i))}),t};function tp(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class Lu{constructor(e){this.find=e.find,this.handler=e.handler}}const qT=(n,e)=>{if(tp(e))return e.exec(n);const t=e(n);if(!t)return null;const r=[t.text];return r.index=t.index,r.input=n,r.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(t.replaceWith)),r};function $l(n){var e;const{editor:t,from:r,to:s,text:i,rules:o,plugin:l}=n,{view:a}=t;if(a.composing)return!1;const u=a.state.doc.resolve(r);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let c=!1;const d=WT(u)+i;return o.forEach(f=>{if(c)return;const h=qT(d,f.find);if(!h)return;const p=a.state.tr,m=Ru({state:a.state,transaction:p}),v={from:r-(h[0].length-i.length),to:s},{commands:y,chain:g,can:w}=new Du({editor:t,state:m});f.handler({state:m,range:v,match:h,commands:y,chain:g,can:w})===null||!p.steps.length||(p.setMeta(l,{transform:p,from:r,to:s,text:i}),a.dispatch(p),c=!0)}),c}function JT(n){const{editor:e,rules:t}=n,r=new xt({state:{init(){return null},apply(s,i,o){const l=s.getMeta(r);if(l)return l;const a=s.getMeta("applyInputRules");return!!a&&setTimeout(()=>{let{text:c}=a;typeof c=="string"?c=c:c=ep(E.from(c),o.schema);const{from:d}=a,f=d+c.length;$l({editor:e,from:d,to:f,text:c,rules:t,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,l){return $l({editor:e,from:i,to:o,text:l,rules:t,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&$l({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?$l({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:r}):!1}},isInputRules:!0});return r}function KT(n){return Object.prototype.toString.call(n).slice(8,-1)}function Ll(n){return KT(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function ju(n,e){const t={...n};return Ll(n)&&Ll(e)&&Object.keys(e).forEach(r=>{Ll(e[r])&&Ll(n[r])?t[r]=ju(n[r],e[r]):t[r]=e[r]}),t}class Bn{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=K(L(this,"addOptions",{name:this.name}))),this.storage=K(L(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Bn(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>ju(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new Bn(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=K(L(t,"addOptions",{name:t.name})),t.storage=K(L(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===t.name))return!1;const a=o.find(u=>(u==null?void 0:u.type.name)===t.name);return a&&r.removeStoredMark(a),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}}function GT(n){return typeof n=="number"}class QT{constructor(e){this.find=e.find,this.handler=e.handler}}const XT=(n,e,t)=>{if(tp(e))return[...n.matchAll(e)];const r=e(n,t);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=n,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function YT(n){const{editor:e,state:t,from:r,to:s,rule:i,pasteEvent:o,dropEvent:l}=n,{commands:a,chain:u,can:c}=new Du({editor:e,state:t}),d=[];return t.doc.nodesBetween(r,s,(h,p)=>{if(!h.isTextblock||h.type.spec.code)return;const m=Math.max(r,p),v=Math.min(s,p+h.content.size),y=h.textBetween(m-p,v-p,void 0,"");XT(y,i.find,o).forEach(w=>{if(w.index===void 0)return;const k=m+w.index+1,S=k+w[0].length,b={from:t.tr.mapping.map(k),to:t.tr.mapping.map(S)},_=i.handler({state:t,range:b,match:w,commands:a,chain:u,can:c,pasteEvent:o,dropEvent:l});d.push(_)})}),d.every(h=>h!==null)}let jl=null;const ZT=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)===null||e===void 0||e.setData("text/html",n),t};function eO(n){const{editor:e,rules:t}=n;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const a=({state:c,from:d,to:f,rule:h,pasteEvt:p})=>{const m=c.tr,v=Ru({state:c,transaction:m});if(!(!YT({editor:e,state:v,from:Math.max(d-1,0),to:f.b-1,rule:h,pasteEvent:p,dropEvent:l})||!m.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return t.map(c=>new xt({view(d){const f=p=>{var m;r=!((m=d.dom.parentElement)===null||m===void 0)&&m.contains(p.target)?d.dom.parentElement:null,r&&(jl=e)},h=()=>{jl&&(jl=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,f)=>{if(i=r===d.dom.parentElement,l=f,!i){const h=jl;h&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,f)=>{var h;const p=(h=f.clipboardData)===null||h===void 0?void 0:h.getData("text/html");return o=f,s=!!(p!=null&&p.includes("data-pm-slice")),!1}}},appendTransaction:(d,f,h)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!s,v=p.getMeta("uiEvent")==="drop"&&!i,y=p.getMeta("applyPasteRules"),g=!!y;if(!m&&!v&&!g)return;if(g){let{text:S}=y;typeof S=="string"?S=S:S=ep(E.from(S),h.schema);const{from:b}=y,_=b+S.length,C=ZT(S);return a({rule:c,state:h,from:b,to:{b:_},pasteEvt:C})}const w=f.doc.content.findDiffStart(h.doc.content),k=f.doc.content.findDiffEnd(h.doc.content);if(!(!GT(w)||!k||w===k.b))return a({rule:c,state:h,from:w,to:k,pasteEvt:o})}}))}function tO(n){const e=n.filter((t,r)=>n.indexOf(t)!==r);return Array.from(new Set(e))}class Ws{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Ws.resolve(e),this.schema=HT(this.extensions,t),this.setupExtensions()}static resolve(e){const t=Ws.sort(Ws.flatten(e)),r=tO(t.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const r={name:t.name,options:t.options,storage:t.storage},s=L(t,"addExtensions",r);return s?[t,...this.flatten(s())]:t}).flat(10)}static sort(e){return e.sort((r,s)=>{const i=L(r,"priority")||100,o=L(s,"priority")||100;return i>o?-1:i<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const r={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:jc(t.name,this.schema)},s=L(t,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,t=Ws.sort([...this.extensions].reverse()),r=[],s=[],i=t.map(o=>{const l={name:o.name,options:o.options,storage:o.storage,editor:e,type:jc(o.name,this.schema)},a=[],u=L(o,"addKeyboardShortcuts",l);let c={};if(o.type==="mark"&&L(o,"exitable",l)&&(c.ArrowRight=()=>Bn.handleExit({editor:e,mark:o})),u){const m=Object.fromEntries(Object.entries(u()).map(([v,y])=>[v,()=>y({editor:e})]));c={...c,...m}}const d=pT(c);a.push(d);const f=L(o,"addInputRules",l);Yg(o,e.options.enableInputRules)&&f&&r.push(...f());const h=L(o,"addPasteRules",l);Yg(o,e.options.enablePasteRules)&&h&&s.push(...h());const p=L(o,"addProseMirrorPlugins",l);if(p){const m=p();a.push(...m)}return a}).flat();return[JT({editor:e,rules:r}),...eO({editor:e,rules:s}),...i]}get attributes(){return P1(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=$u(this.extensions);return Object.fromEntries(t.filter(r=>!!L(r,"addNodeView")).map(r=>{const s=this.attributes.filter(a=>a.type===r.name),i={name:r.name,options:r.options,storage:r.storage,editor:e,type:$e(r.name,this.schema)},o=L(r,"addNodeView",i);if(!o)return[];const l=(a,u,c,d,f)=>{const h=vf(a,s);return o()({node:a,view:u,getPos:c,decorations:d,innerDecorations:f,editor:e,extension:r,HTMLAttributes:h})};return[r.name,l]}))}setupExtensions(){this.extensions.forEach(e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:jc(e.name,this.schema)};e.type==="mark"&&(!((t=K(L(e,"keepOnSplit",r)))!==null&&t!==void 0)||t)&&this.splittableMarks.push(e.name);const s=L(e,"onBeforeCreate",r),i=L(e,"onCreate",r),o=L(e,"onUpdate",r),l=L(e,"onSelectionUpdate",r),a=L(e,"onTransaction",r),u=L(e,"onFocus",r),c=L(e,"onBlur",r),d=L(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),l&&this.editor.on("selectionUpdate",l),a&&this.editor.on("transaction",a),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),d&&this.editor.on("destroy",d)})}}class lt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=K(L(this,"addOptions",{name:this.name}))),this.storage=K(L(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new lt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>ju(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new lt({...this.config,...e});return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=K(L(t,"addOptions",{name:t.name})),t.storage=K(L(t,"addStorage",{name:t.name,options:t.options})),t}}function R1(n,e,t){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=t||{};let l="";return n.nodesBetween(r,s,(a,u,c,d)=>{var f;a.isBlock&&u>r&&(l+=i);const h=o==null?void 0:o[a.type.name];if(h)return c&&(l+=h({node:a,pos:u,parent:c,index:d,range:e})),!1;a.isText&&(l+=(f=a==null?void 0:a.text)===null||f===void 0?void 0:f.slice(Math.max(r,u)-u,s-u))}),l}function D1(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const nO=lt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new xt({key:new Sn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(c=>c.$from.pos)),l=Math.max(...i.map(c=>c.$to.pos)),a=D1(t);return R1(r,{from:o,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:a})}}})]}}),rO=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),sO=(n=!1)=>({commands:e})=>e.setContent("",n),iO=()=>({state:n,tr:e,dispatch:t})=>{const{selection:r}=e,{ranges:s}=r;return t&&s.forEach(({$from:i,$to:o})=>{n.doc.nodesBetween(i.pos,o.pos,(l,a)=>{if(l.type.isText)return;const{doc:u,mapping:c}=e,d=u.resolve(c.map(a)),f=u.resolve(c.map(a+l.nodeSize)),h=d.blockRange(f);if(!h)return;const p=Ti(h);if(l.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},oO=n=>e=>n(e),lO=()=>({state:n,dispatch:e})=>TT(n,e),aO=(n,e)=>({editor:t,tr:r})=>{const{state:s}=t,i=s.doc.slice(n.from,n.to);r.deleteRange(n.from,n.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new U(r.doc.resolve(o-1))),!0},uO=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,r=t.$anchor.node();if(r.content.size>0)return!1;const s=n.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const l=s.before(i),a=s.after(i);n.delete(l,a).scrollIntoView()}return!0}return!1},cO=n=>({tr:e,state:t,dispatch:r})=>{const s=$e(n,t.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const a=i.before(o),u=i.after(o);e.delete(a,u).scrollIntoView()}return!0}return!1},dO=n=>({tr:e,dispatch:t})=>{const{from:r,to:s}=n;return t&&e.delete(r,s),!0},fO=()=>({state:n,dispatch:e})=>mT(n,e),hO=()=>({commands:n})=>n.keyboardShortcut("Enter"),pO=()=>({state:n,dispatch:e})=>ET(n,e);function nu(n,e,t={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>t.strict?e[s]===n[s]:tp(e[s])?e[s].test(n[s]):e[s]===n[s]):!0}function $1(n,e,t={}){return n.find(r=>r.type===e&&nu(Object.fromEntries(Object.keys(t).map(s=>[s,r.attrs[s]])),t))}function Zg(n,e,t={}){return!!$1(n,e,t)}function np(n,e,t){var r;if(!n||!e)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(c=>c.type===e))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(c=>c.type===e)||(t=t||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!$1([...s.node.marks],e,t)))return;let o=s.index,l=n.start()+s.offset,a=o+1,u=l+s.node.nodeSize;for(;o>0&&Zg([...n.parent.child(o-1).marks],e,t);)o-=1,l-=n.parent.child(o).nodeSize;for(;a<n.parent.childCount&&Zg([...n.parent.child(a).marks],e,t);)u+=n.parent.child(a).nodeSize,a+=1;return{from:l,to:u}}function Or(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}const mO=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const i=Or(n,r.schema),{doc:o,selection:l}=t,{$from:a,from:u,to:c}=l;if(s){const d=np(a,i,e);if(d&&d.from<=u&&d.to>=c){const f=U.create(o,d.from,d.to);t.setSelection(f)}}return!0},gO=n=>e=>{const t=typeof n=="function"?n(e):n;for(let r=0;r<t.length;r+=1)if(t[r](e))return!0;return!1};function L1(n){return n instanceof U}function Vr(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function j1(n,e=null){if(!e)return null;const t=W.atStart(n),r=W.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return r;const s=t.from,i=r.to;return e==="all"?U.create(n,Vr(0,s,i),Vr(n.content.size,s,i)):U.create(n,Vr(e,s,i),Vr(e,s,i))}function yO(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function rp(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const vO=(n=null,e={})=>({editor:t,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(rp()||yO())&&r.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(r.hasFocus()&&n===null||n===!1)return!0;if(i&&n===null&&!L1(t.state.selection))return o(),!0;const l=j1(s.doc,n)||t.state.selection,a=t.state.selection.eq(l);return i&&(a||s.setSelection(l),a&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},wO=(n,e)=>t=>n.every((r,s)=>e(r,{...t,index:s})),kO=(n,e)=>({tr:t,commands:r})=>r.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),F1=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const r=e[t];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?n.removeChild(r):r.nodeType===1&&F1(r)}return n};function Fl(n){const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return F1(t)}function ru(n,e,t){if(n instanceof gr||n instanceof E)return n;t={slice:!0,parseOptions:{},...t};const r=typeof n=="object"&&n!==null,s=typeof n=="string";if(r)try{if(Array.isArray(n)&&n.length>0)return E.fromArray(n.map(l=>e.nodeFromJSON(l)));const o=e.nodeFromJSON(n);return t.errorOnInvalidContent&&o.check(),o}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",i),ru("",e,t)}if(s){if(t.errorOnInvalidContent){let o=!1,l="";const a=new Ow({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,l=typeof u=="string"?u:u.outerHTML,null)}]}})});if(t.slice?yo.fromSchema(a).parseSlice(Fl(n),t.parseOptions):yo.fromSchema(a).parse(Fl(n),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const i=yo.fromSchema(e);return t.slice?i.parseSlice(Fl(n),t.parseOptions).content:i.parse(Fl(n),t.parseOptions)}return ru("",e,t)}function xO(n,e,t){const r=n.steps.length-1;if(r<e)return;const s=n.steps[r];if(!(s instanceof Pe||s instanceof Re))return;const i=n.mapping.maps[r];let o=0;i.forEach((l,a,u,c)=>{o===0&&(o=c)}),n.setSelection(W.near(n.doc.resolve(o),t))}const SO=n=>!("type"in n),bO=(n,e,t)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let l;try{l=ru(e,i.schema,{parseOptions:{preserveWhitespace:"full",...t.parseOptions},errorOnInvalidContent:(o=t.errorOnInvalidContent)!==null&&o!==void 0?o:i.options.enableContentCheck})}catch(p){return i.emit("contentError",{editor:i,error:p,disableCollaboration:()=>{i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}}),!1}let{from:a,to:u}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},c=!0,d=!0;if((SO(l)?l:[l]).forEach(p=>{p.check(),c=c?p.isText&&p.marks.length===0:!1,d=d?p.isBlock:!1}),a===u&&d){const{parent:p}=r.doc.resolve(a);p.isTextblock&&!p.type.spec.code&&!p.childCount&&(a-=1,u+=1)}let h;if(c){if(Array.isArray(e))h=e.map(p=>p.text||"").join("");else if(e instanceof E){let p="";e.forEach(m=>{m.text&&(p+=m.text)}),h=p}else typeof e=="object"&&e&&e.text?h=e.text:h=e;r.insertText(h,a,u)}else h=l,r.replaceWith(a,u,h);t.updateSelection&&xO(r,r.steps.length-1,-1),t.applyInputRules&&r.setMeta("applyInputRules",{from:a,text:h}),t.applyPasteRules&&r.setMeta("applyPasteRules",{from:a,text:h})}return!0},_O=()=>({state:n,dispatch:e})=>ST(n,e),CO=()=>({state:n,dispatch:e})=>bT(n,e),EO=()=>({state:n,dispatch:e})=>gT(n,e),TO=()=>({state:n,dispatch:e})=>kT(n,e),OO=()=>({state:n,dispatch:e,tr:t})=>{try{const r=Ou(n.doc,n.selection.$from.pos,-1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},MO=()=>({state:n,dispatch:e,tr:t})=>{try{const r=Ou(n.doc,n.selection.$from.pos,1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},AO=()=>({state:n,dispatch:e})=>yT(n,e),NO=()=>({state:n,dispatch:e})=>vT(n,e);function z1(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function PO(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let r,s,i,o;for(let l=0;l<e.length-1;l+=1){const a=e[l];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))s=!0;else if(/^s(hift)?$/i.test(a))i=!0;else if(/^mod$/i.test(a))rp()||z1()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${a}`)}return r&&(t=`Alt-${t}`),s&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}const IO=n=>({editor:e,view:t,tr:r,dispatch:s})=>{const i=PO(n).split(/-(?!$)/),o=i.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),l=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),a=e.captureTransaction(()=>{t.someProp("handleKeyDown",u=>u(t,l))});return a==null||a.steps.forEach(u=>{const c=u.map(r.mapping);c&&s&&r.maybeStep(c)}),!0};function Qo(n,e,t={}){const{from:r,to:s,empty:i}=n.selection,o=e?$e(e,n.schema):null,l=[];n.doc.nodesBetween(r,s,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(s,f+d.nodeSize);l.push({node:d,from:h,to:p})});const a=s-r,u=l.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>nu(d.node.attrs,t,{strict:!1}));return i?!!u.length:u.reduce((d,f)=>d+f.to-f.from,0)>=a}const RO=(n,e={})=>({state:t,dispatch:r})=>{const s=$e(n,t.schema);return Qo(t,s,e)?_T(t,r):!1},DO=()=>({state:n,dispatch:e})=>OT(n,e),$O=n=>({state:e,dispatch:t})=>{const r=$e(n,e.schema);return LT(r)(e,t)},LO=()=>({state:n,dispatch:e})=>CT(n,e);function Fu(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function ey(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((r,s)=>(t.includes(s)||(r[s]=n[s]),r),{})}const jO=(n,e)=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const l=Fu(typeof n=="string"?n:n.name,r.schema);return l?(l==="node"&&(i=$e(n,r.schema)),l==="mark"&&(o=Or(n,r.schema)),s&&t.selection.ranges.forEach(a=>{r.doc.nodesBetween(a.$from.pos,a.$to.pos,(u,c)=>{i&&i===u.type&&t.setNodeMarkup(c,void 0,ey(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(d=>{o===d.type&&t.addMark(c,c+u.nodeSize,o.create(ey(d.attrs,e)))})})}),!0):!1},FO=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),zO=()=>({tr:n,dispatch:e})=>{if(e){const t=new zt(n.doc);n.setSelection(t)}return!0},BO=()=>({state:n,dispatch:e})=>wT(n,e),UO=()=>({state:n,dispatch:e})=>xT(n,e),VO=()=>({state:n,dispatch:e})=>MT(n,e),HO=()=>({state:n,dispatch:e})=>PT(n,e),WO=()=>({state:n,dispatch:e})=>NT(n,e);function wf(n,e,t={},r={}){return ru(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:r.errorOnInvalidContent})}const qO=(n,e=!1,t={},r={})=>({editor:s,tr:i,dispatch:o,commands:l})=>{var a,u;const{doc:c}=i;if(t.preserveWhitespace!=="full"){const d=wf(n,s.schema,t,{errorOnInvalidContent:(a=r.errorOnInvalidContent)!==null&&a!==void 0?a:s.options.enableContentCheck});return o&&i.replaceWith(0,c.content.size,d).setMeta("preventUpdate",!e),!0}return o&&i.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:c.content.size},n,{parseOptions:t,errorOnInvalidContent:(u=r.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck})};function B1(n,e){const t=Or(e,n.schema),{from:r,to:s,empty:i}=n.selection,o=[];i?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(r,s,a=>{o.push(...a.marks)});const l=o.find(a=>a.type.name===t.name);return l?{...l.attrs}:{}}function JO(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function KO(n,e){for(let t=n.depth;t>0;t-=1){const r=n.node(t);if(e(r))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:r}}}function sp(n){return e=>KO(e.$from,n)}function GO(n,e){const t={from:0,to:n.content.size};return R1(n,t,e)}function QO(n,e){const t=$e(e,n.schema),{from:r,to:s}=n.selection,i=[];n.doc.nodesBetween(r,s,l=>{i.push(l)});const o=i.reverse().find(l=>l.type.name===t.name);return o?{...o.attrs}:{}}function XO(n,e){const t=Fu(typeof e=="string"?e:e.name,n.schema);return t==="node"?QO(n,e):t==="mark"?B1(n,e):{}}function U1(n,e,t){const r=[];return n===e?t.resolve(n).marks().forEach(s=>{const i=t.resolve(n),o=np(i,s.type);o&&r.push({mark:s,...o})}):t.nodesBetween(n,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}function fa(n,e,t){return Object.fromEntries(Object.entries(t).filter(([r])=>{const s=n.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}function kf(n,e,t={}){const{empty:r,ranges:s}=n.selection,i=e?Or(e,n.schema):null;if(r)return!!(n.storedMarks||n.selection.$from.marks()).filter(d=>i?i.name===d.type.name:!0).find(d=>nu(d.attrs,t,{strict:!1}));let o=0;const l=[];if(s.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;n.doc.nodesBetween(h,p,(m,v)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(h,v),g=Math.min(p,v+m.nodeSize),w=g-y;o+=w,l.push(...m.marks.map(k=>({mark:k,from:y,to:g})))})}),o===0)return!1;const a=l.filter(d=>i?i.name===d.mark.type.name:!0).filter(d=>nu(d.mark.attrs,t,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),u=l.filter(d=>i?d.mark.type!==i&&d.mark.type.excludes(i):!0).reduce((d,f)=>d+f.to-f.from,0);return(a>0?a+u:a)>=o}function YO(n,e,t={}){if(!e)return Qo(n,null,t)||kf(n,null,t);const r=Fu(e,n.schema);return r==="node"?Qo(n,e,t):r==="mark"?kf(n,e,t):!1}function ty(n,e){const{nodeExtensions:t}=$u(e),r=t.find(o=>o.name===n);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=K(L(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function ip(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var r;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((r=n.text)!==null&&r!==void 0?r:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let s=!0;return n.content.forEach(i=>{s!==!1&&(ip(i,{ignoreWhitespace:t,checkChildren:e})||(s=!1))}),s}return!1}function ZO(n){return n instanceof B}function eM(n,e,t){var r;const{selection:s}=e;let i=null;if(L1(s)&&(i=s.$cursor),i){const l=(r=n.storedMarks)!==null&&r!==void 0?r:i.marks();return!!t.isInSet(l)||!l.some(a=>a.type.excludes(t))}const{ranges:o}=s;return o.some(({$from:l,$to:a})=>{let u=l.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(l.pos,a.pos,(c,d,f)=>{if(u)return!1;if(c.isInline){const h=!f||f.type.allowsMarkType(t),p=!!t.isInSet(c.marks)||!c.marks.some(m=>m.type.excludes(t));u=h&&p}return!u}),u})}const tM=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const{selection:i}=t,{empty:o,ranges:l}=i,a=Or(n,r.schema);if(s)if(o){const u=B1(r,a);t.addStoredMark(a.create({...u,...e}))}else l.forEach(u=>{const c=u.$from.pos,d=u.$to.pos;r.doc.nodesBetween(c,d,(f,h)=>{const p=Math.max(h,c),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===a)?f.marks.forEach(y=>{a===y.type&&t.addMark(p,m,a.create({...y.attrs,...e}))}):t.addMark(p,m,a.create(e))})});return eM(r,t,a)},nM=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),rM=(n,e={})=>({state:t,dispatch:r,chain:s})=>{const i=$e(n,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:l})=>Gg(i,{...o,...e})(t)?!0:l.clearNodes()).command(({state:l})=>Gg(i,{...o,...e})(l,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},sM=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,s=Vr(n,0,r.content.size),i=B.create(r,s);e.setSelection(i)}return!0},iM=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,{from:s,to:i}=typeof n=="number"?{from:n,to:n}:n,o=U.atStart(r).from,l=U.atEnd(r).to,a=Vr(s,o,l),u=Vr(i,o,l),c=U.create(r,a,u);e.setSelection(c)}return!0},oM=n=>({state:e,dispatch:t})=>{const r=$e(n,e.schema);return zT(r)(e,t)};function ny(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const r=t.filter(s=>e==null?void 0:e.includes(s.type.name));n.tr.ensureMarks(r)}}const lM=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:l,$to:a}=i,u=s.extensionManager.attributes,c=fa(u,l.node().type.name,l.node().attrs);if(i instanceof B&&i.node.isBlock)return!l.parentOffset||!Zs(o,l.pos)?!1:(r&&(n&&ny(t,s.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const d=a.parentOffset===a.parent.content.size,f=l.depth===0?void 0:JO(l.node(-1).contentMatchAt(l.indexAfter(-1)));let h=d&&f?[{type:f,attrs:c}]:void 0,p=Zs(e.doc,e.mapping.map(l.pos),1,h);if(!h&&!p&&Zs(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:c}]:void 0),r){if(p&&(i instanceof U&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,h),f&&!d&&!l.parentOffset&&l.parent.type!==f)){const m=e.mapping.map(l.before()),v=e.doc.resolve(m);l.node(-1).canReplaceWith(v.index(),v.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}n&&ny(t,s.extensionManager.splittableMarks),e.scrollIntoView()}return p},aM=(n,e={})=>({tr:t,state:r,dispatch:s,editor:i})=>{var o;const l=$e(n,r.schema),{$from:a,$to:u}=r.selection,c=r.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(u))return!1;const d=a.node(-1);if(d.type!==l)return!1;const f=i.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==l||a.index(-2)!==a.node(-2).childCount-1)return!1;if(s){let y=E.empty;const g=a.index(-1)?1:a.index(-2)?2:3;for(let C=a.depth-g;C>=a.depth-3;C-=1)y=E.from(a.node(C).copy(y));const w=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,k={...fa(f,a.node().type.name,a.node().attrs),...e},S=((o=l.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(k))||void 0;y=y.append(E.from(l.createAndFill(null,S)||void 0));const b=a.before(a.depth-(g-1));t.replace(b,a.after(-w),new N(y,4-g,0));let _=-1;t.doc.nodesBetween(b,t.doc.content.size,(C,T)=>{if(_>-1)return!1;C.isTextblock&&C.content.size===0&&(_=T+1)}),_>-1&&t.setSelection(U.near(t.doc.resolve(_))),t.scrollIntoView()}return!0}const h=u.pos===a.end()?d.contentMatchAt(0).defaultType:null,p={...fa(f,d.type.name,d.attrs),...e},m={...fa(f,a.node().type.name,a.node().attrs),...e};t.delete(a.pos,u.pos);const v=h?[{type:l,attrs:p},{type:h,attrs:m}]:[{type:l,attrs:p}];if(!Zs(t.doc,a.pos,2))return!1;if(s){const{selection:y,storedMarks:g}=r,{splittableMarks:w}=i.extensionManager,k=g||y.$to.parentOffset&&y.$from.marks();if(t.split(a.pos,2,v).scrollIntoView(),!k||!s)return!0;const S=k.filter(b=>w.includes(b.type.name));t.ensureMarks(S)}return!0},Fc=(n,e)=>{const t=sp(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&Er(n.doc,t.pos)&&n.join(t.pos),!0},zc=(n,e)=>{const t=sp(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(t.start).after(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&Er(n.doc,r)&&n.join(r),!0},uM=(n,e,t,r={})=>({editor:s,tr:i,state:o,dispatch:l,chain:a,commands:u,can:c})=>{const{extensions:d,splittableMarks:f}=s.extensionManager,h=$e(n,o.schema),p=$e(e,o.schema),{selection:m,storedMarks:v}=o,{$from:y,$to:g}=m,w=y.blockRange(g),k=v||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const S=sp(b=>ty(b.type.name,d))(m);if(w.depth>=1&&S&&w.depth-S.depth<=1){if(S.node.type===h)return u.liftListItem(p);if(ty(S.node.type.name,d)&&h.validContent(S.node.content)&&l)return a().command(()=>(i.setNodeMarkup(S.pos,h),!0)).command(()=>Fc(i,h)).command(()=>zc(i,h)).run()}return!t||!k||!l?a().command(()=>c().wrapInList(h,r)?!0:u.clearNodes()).wrapInList(h,r).command(()=>Fc(i,h)).command(()=>zc(i,h)).run():a().command(()=>{const b=c().wrapInList(h,r),_=k.filter(C=>f.includes(C.type.name));return i.ensureMarks(_),b?!0:u.clearNodes()}).wrapInList(h,r).command(()=>Fc(i,h)).command(()=>zc(i,h)).run()},cM=(n,e={},t={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=t,o=Or(n,r.schema);return kf(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},dM=(n,e,t={})=>({state:r,commands:s})=>{const i=$e(n,r.schema),o=$e(e,r.schema),l=Qo(r,i,t);let a;return r.selection.$anchor.sameParent(r.selection.$head)&&(a=r.selection.$anchor.parent.attrs),l?s.setNode(o,a):s.setNode(i,{...a,...t})},fM=(n,e={})=>({state:t,commands:r})=>{const s=$e(n,t.schema);return Qo(t,s,e)?r.lift(s):r.wrapIn(s,e)},hM=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let r=0;r<t.length;r+=1){const s=t[r];let i;if(s.spec.isInputRules&&(i=s.getState(n))){if(e){const o=n.tr,l=i.transform;for(let a=l.steps.length-1;a>=0;a-=1)o.step(l.steps[a].invert(l.docs[a]));if(i.text){const a=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,n.schema.text(i.text,a))}else o.delete(i.from,i.to)}return!0}}return!1},pM=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:r,ranges:s}=t;return r||e&&s.forEach(i=>{n.removeMark(i.$from.pos,i.$to.pos)}),!0},mM=(n,e={})=>({tr:t,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:l}=t,a=Or(n,r.schema),{$from:u,empty:c,ranges:d}=l;if(!s)return!0;if(c&&o){let{from:f,to:h}=l;const p=(i=u.marks().find(v=>v.type===a))===null||i===void 0?void 0:i.attrs,m=np(u,a,p);m&&(f=m.from,h=m.to),t.removeMark(f,h,a)}else d.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,a)});return t.removeStoredMark(a),!0},gM=(n,e={})=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const l=Fu(typeof n=="string"?n:n.name,r.schema);return l?(l==="node"&&(i=$e(n,r.schema)),l==="mark"&&(o=Or(n,r.schema)),s&&t.selection.ranges.forEach(a=>{const u=a.$from.pos,c=a.$to.pos;let d,f,h,p;t.selection.empty?r.doc.nodesBetween(u,c,(m,v)=>{i&&i===m.type&&(h=Math.max(v,u),p=Math.min(v+m.nodeSize,c),d=v,f=m)}):r.doc.nodesBetween(u,c,(m,v)=>{v<u&&i&&i===m.type&&(h=Math.max(v,u),p=Math.min(v+m.nodeSize,c),d=v,f=m),v>=u&&v<=c&&(i&&i===m.type&&t.setNodeMarkup(v,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const g=Math.max(v,u),w=Math.min(v+m.nodeSize,c);t.addMark(g,w,o.create({...y.attrs,...e}))}}))}),f&&(d!==void 0&&t.setNodeMarkup(d,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(m=>{o===m.type&&t.addMark(h,p,o.create({...m.attrs,...e}))}))}),!0):!1},yM=(n,e={})=>({state:t,dispatch:r})=>{const s=$e(n,t.schema);return IT(s,e)(t,r)},vM=(n,e={})=>({state:t,dispatch:r})=>{const s=$e(n,t.schema);return RT(s,e)(t,r)};var wM=Object.freeze({__proto__:null,blur:rO,clearContent:sO,clearNodes:iO,command:oO,createParagraphNear:lO,cut:aO,deleteCurrentNode:uO,deleteNode:cO,deleteRange:dO,deleteSelection:fO,enter:hO,exitCode:pO,extendMarkRange:mO,first:gO,focus:vO,forEach:wO,insertContent:kO,insertContentAt:bO,joinBackward:EO,joinDown:CO,joinForward:TO,joinItemBackward:OO,joinItemForward:MO,joinTextblockBackward:AO,joinTextblockForward:NO,joinUp:_O,keyboardShortcut:IO,lift:RO,liftEmptyBlock:DO,liftListItem:$O,newlineInCode:LO,resetAttributes:jO,scrollIntoView:FO,selectAll:zO,selectNodeBackward:BO,selectNodeForward:UO,selectParentNode:VO,selectTextblockEnd:HO,selectTextblockStart:WO,setContent:qO,setMark:tM,setMeta:nM,setNode:rM,setNodeSelection:sM,setTextSelection:iM,sinkListItem:oM,splitBlock:lM,splitListItem:aM,toggleList:uM,toggleMark:cM,toggleNode:dM,toggleWrap:fM,undoInputRule:hM,unsetAllMarks:pM,unsetMark:mM,updateAttributes:gM,wrapIn:yM,wrapInList:vM});const kM=lt.create({name:"commands",addCommands(){return{...wM}}}),xM=lt.create({name:"drop",addProseMirrorPlugins(){return[new xt({key:new Sn("tiptapDrop"),props:{handleDrop:(n,e,t,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:r})}}})]}}),SM=lt.create({name:"editable",addProseMirrorPlugins(){return[new xt({key:new Sn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),bM=new Sn("focusEvents"),_M=lt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new xt({key:bM,props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const r=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,t)=>{n.isFocused=!1;const r=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),CM=lt.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:l})=>{const{selection:a,doc:u}=l,{empty:c,$anchor:d}=a,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?l.doc.resolve(f-1):d,m=p.parent.type.spec.isolating,v=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?v===d.pos:W.atStart(u).from===f;return!c||!h.type.isTextblock||h.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return rp()||z1()?i:s},addProseMirrorPlugins(){return[new xt({key:new Sn("clearDocument"),appendTransaction:(n,e,t)=>{if(n.some(m=>m.getMeta("composition")))return;const r=n.some(m=>m.docChanged)&&!e.doc.eq(t.doc),s=n.some(m=>m.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:l}=e.selection,a=W.atStart(e.doc).from,u=W.atEnd(e.doc).to;if(i||!(o===a&&l===u)||!ip(t.doc))return;const f=t.tr,h=Ru({state:t,transaction:f}),{commands:p}=new Du({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),EM=lt.create({name:"paste",addProseMirrorPlugins(){return[new xt({key:new Sn("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),TM=lt.create({name:"tabindex",addProseMirrorPlugins(){return[new xt({key:new Sn("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Dr{get name(){return this.node.type.name}constructor(e,t,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=t,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:t,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Dr(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Dr(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Dr(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,r)=>{const s=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,o=this.pos+r+(i?0:1),l=this.resolvedPos.doc.resolve(o);if(!s&&l.depth<=this.depth)return;const a=new Dr(l,this.editor,s,s?t:null);s&&(a.actualDepth=this.depth+1),e.push(new Dr(l,this.editor,s,s?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(t).length>0){const i=s.node.attrs,o=Object.keys(t);for(let l=0;l<o.length;l+=1){const a=o[l];if(i[a]!==t[a])break}}else r=s;s=s.parent}return r}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(t);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(a=>t[a]===o.node.attrs[a])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,t,r))))}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}}const OM=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function MM(n,e,t){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s),s}class AM extends BT{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:t,slice:r,moved:s})=>this.options.onDrop(t,r,s)),this.on("paste",({event:t,slice:r})=>this.options.onPaste(t,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=MM(OM,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const r=I1(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let r=t;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;r=t.filter(l=>!l.key.startsWith(o))}),t.length===r.length)return;const s=this.state.reconfigure({plugins:r});return this.view.updateState(s),s}createExtensionManager(){var e,t;const s=[...this.options.enableCoreExtensions?[SM,nO.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||t===void 0?void 0:t.blockSeparator}),kM,_M,CM,TM,xM,EM].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i==null?void 0:i.type));this.extensionManager=new Ws(s,this)}createCommandManager(){this.commandManager=new Du({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let t;try{t=wf(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(l=>l.name!=="collaboration"),this.createExtensionManager()}}),t=wf(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=j1(t,this.options.autofocus);this.view=new iT(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Hs.create({doc:t,selection:r||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(o)});return}const t=this.state.apply(e),r=!this.state.selection.eq(t.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const s=e.getMeta("focus"),i=e.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return XO(this.state,e)}isActive(e,t){const r=typeof e=="string"?e:null,s=typeof e=="string"?t:e;return YO(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return ep(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:r={}}=e||{};return GO(this.state.doc,{blockSeparator:t,textSerializers:{...D1(this.schema),...r}})}get isEmpty(){return ip(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,t))||null}$nodes(e,t){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new Dr(t,this)}get $doc(){return this.$pos(0)}}function wi(n){return new Lu({find:n.find,handler:({state:e,range:t,match:r})=>{const s=K(n.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],l=r[0];if(o){const a=l.search(/\S/),u=t.from+l.indexOf(o),c=u+o.length;if(U1(t.from,t.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===n.type&&m!==h.mark.type)).filter(h=>h.to>u).length)return null;c<t.to&&i.delete(c,t.to),u>t.from&&i.delete(t.from+a,u);const f=t.from+a+o.length;i.addMark(t.from+a,f,n.type.create(s||{})),i.removeStoredMark(n.type)}}})}function NM(n){return new Lu({find:n.find,handler:({state:e,range:t,match:r})=>{const s=K(n.getAttributes,void 0,r)||{},{tr:i}=e,o=t.from;let l=t.to;const a=n.type.create(s);if(r[1]){const u=r[0].lastIndexOf(r[1]);let c=o+u;c>l?c=l:l=c+r[1].length;const d=r[0][r[0].length-1];i.insertText(d,o+r[0].length-1),i.replaceWith(c,l,a)}else if(r[0]){const u=n.type.isInline?o:o-1;i.insert(u,n.type.create(s)).delete(i.mapping.map(o),i.mapping.map(l))}i.scrollIntoView()}})}function xf(n){return new Lu({find:n.find,handler:({state:e,range:t,match:r})=>{const s=e.doc.resolve(t.from),i=K(n.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,i)}})}function Xo(n){return new Lu({find:n.find,handler:({state:e,range:t,match:r,chain:s})=>{const i=K(n.getAttributes,void 0,r)||{},o=e.tr.delete(t.from,t.to),a=o.doc.resolve(t.from).blockRange(),u=a&&Bh(a,n.type,i);if(!u)return null;if(o.wrap(a,u),n.keepMarks&&n.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:h}=n.editor.extensionManager,p=f||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(v=>h.includes(v.type.name));o.ensureMarks(m)}}if(n.keepAttributes){const d=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(d,i).run()}const c=o.doc.resolve(t.from-1).nodeBefore;c&&c.type===n.type&&Er(o.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(r,c))&&o.join(t.from-1)}})}class wt{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=K(L(this,"addOptions",{name:this.name}))),this.storage=K(L(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new wt(e)}configure(e={}){const t=this.extend({...this.config,addOptions:()=>ju(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new wt(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=K(L(t,"addOptions",{name:t.name})),t.storage=K(L(t,"addStorage",{name:t.name,options:t.options})),t}}function ki(n){return new QT({find:n.find,handler:({state:e,range:t,match:r,pasteEvent:s})=>{const i=K(n.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,l=r[r.length-1],a=r[0];let u=t.to;if(l){const c=a.search(/\S/),d=t.from+a.indexOf(l),f=d+l.length;if(U1(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(v=>v===n.type&&v!==p.mark.type)).filter(p=>p.to>d).length)return null;f<t.to&&o.delete(f,t.to),d>t.from&&o.delete(t.from+c,d),u=t.from+c+l.length,o.addMark(t.from+c,u,n.type.create(i||{})),o.removeStoredMark(n.type)}}})}function PM(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var V1={exports:{}},Bc={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ry;function IM(){if(ry)return Bc;ry=1;var n=Ne;function e(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,s=n.useEffect,i=n.useLayoutEffect,o=n.useDebugValue;function l(d,f){var h=f(),p=r({inst:{value:h,getSnapshot:f}}),m=p[0].inst,v=p[1];return i(function(){m.value=h,m.getSnapshot=f,a(m)&&v({inst:m})},[d,h,f]),s(function(){return a(m)&&v({inst:m}),d(function(){a(m)&&v({inst:m})})},[d]),o(h),h}function a(d){var f=d.getSnapshot;d=d.value;try{var h=f();return!t(d,h)}catch{return!0}}function u(d,f){return f()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return Bc.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:c,Bc}V1.exports=IM();var op=V1.exports;const RM=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},DM=({contentComponent:n})=>{const e=op.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return Ne.createElement(Ne.Fragment,null,Object.values(e))};function $M(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,r){e={...e,[t]:s_.createPortal(r.reactElement,r.element,t)},n.forEach(s=>s())},removeRenderer(t){const r={...e};delete r[t],e=r,n.forEach(s=>s())}}}class LM extends Ne.Component{constructor(e){var t;super(e),this.editorContentRef=Ne.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=$M(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...r}=this.props;return Ne.createElement(Ne.Fragment,null,Ne.createElement("div",{ref:RM(t,this.editorContentRef),...r}),(e==null?void 0:e.contentComponent)&&Ne.createElement(DM,{contentComponent:e.contentComponent}))}}const jM=z.forwardRef((n,e)=>{const t=Ne.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return Ne.createElement(LM,{key:t,innerRef:e,...n})}),FM=Ne.memo(jM);var zM=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,i;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(!n(e[s],t[s]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;for(s of e.entries())if(!n(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(s=r;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(i=Object.keys(e),r=i.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[s]))return!1;for(s=r;s--!==0;){var o=i[s];if(!(o==="_owner"&&e.$$typeof)&&!n(e[o],t[o]))return!1}return!0}return e!==e&&t!==t},BM=PM(zM),H1={exports:{}},Uc={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sy;function UM(){if(sy)return Uc;sy=1;var n=Ne,e=op;function t(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var r=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,i=n.useRef,o=n.useEffect,l=n.useMemo,a=n.useDebugValue;return Uc.useSyncExternalStoreWithSelector=function(u,c,d,f,h){var p=i(null);if(p.current===null){var m={hasValue:!1,value:null};p.current=m}else m=p.current;p=l(function(){function y(b){if(!g){if(g=!0,w=b,b=f(b),h!==void 0&&m.hasValue){var _=m.value;if(h(_,b))return k=_}return k=b}if(_=k,r(w,b))return _;var C=f(b);return h!==void 0&&h(_,C)?_:(w=b,k=C)}var g=!1,w,k,S=d===void 0?null:d;return[function(){return y(c())},S===null?void 0:function(){return y(S())}]},[c,d,f,h]);var v=s(u,p[0],p[1]);return o(function(){m.hasValue=!0,m.value=v},[v]),a(v),v},Uc}H1.exports=UM();var VM=H1.exports;const HM=typeof window<"u"?z.useLayoutEffect:z.useEffect;class WM{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(s=>s())},r=this.editor;return r.on("transaction",t),()=>{r.off("transaction",t)}}}}function qM(n){var e;const[t]=z.useState(()=>new WM(n.editor)),r=VM.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!==null&&e!==void 0?e:BM);return HM(()=>t.watch(n.editor),[n.editor,t]),z.useDebugValue(r),r}const JM=!1,Sf=typeof window>"u",KM=Sf||!!(typeof window<"u"&&window.next);class lp{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){if(this.options.current.immediatelyRender===void 0)return Sf||KM?null:this.createEditor();if(this.options.current.immediatelyRender&&Sf&&JM)throw new Error("Tiptap Error: SSR has been detected, and `immediatelyRender` has been set to `true` this is an unsupported configuration that may result in errors, explicitly set `immediatelyRender` to `false` to avoid hydration mismatches.");return this.options.current.immediatelyRender?this.createEditor():null}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)===null||i===void 0?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)===null||i===void 0?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)===null||i===void 0?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)===null||i===void 0?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)===null||i===void 0?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)===null||i===void 0?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)===null||i===void 0?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)===null||i===void 0?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)===null||i===void 0?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)===null||i===void 0?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)===null||i===void 0?void 0:i.call(s,...r)}};return new AM(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=t.extensions)===null||o===void 0?void 0:o[i])}):e[r]===t[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?lp.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function GM(n={},e=[]){const t=z.useRef(n);t.current=n;const[r]=z.useState(()=>new lp(t)),s=op.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return z.useDebugValue(s),z.useEffect(r.onRender(e)),qM({editor:s,selector:({transactionNumber:i})=>n.shouldRerenderOnTransaction===!1?null:n.immediatelyRender&&i===0?0:i+1}),s}const ap=z.createContext({editor:null}),QM=ap.Consumer,XM=()=>z.useContext(ap);function YM({children:n,slotAfter:e,slotBefore:t,editorContainerProps:r={},...s}){const i=GM(s);return i?Ne.createElement(ap.Provider,{value:{editor:i}},t,Ne.createElement(QM,null,({editor:o})=>Ne.createElement(FM,{editor:o,...r})),n,e):null}const ZM=z.createContext({onDragStart:void 0}),eA=()=>z.useContext(ZM);Ne.forwardRef((n,e)=>{const{onDragStart:t}=eA(),r=n.as||"div";return Ne.createElement(r,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});const tA=/^\s*>\s$/,nA=wt.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return["blockquote",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Xo({find:tA,type:this.type})]}}),rA=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,sA=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,iA=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,oA=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,lA=Bn.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return["strong",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[wi({find:rA,type:this.type}),wi({find:iA,type:this.type})]},addPasteRules(){return[ki({find:sA,type:this.type}),ki({find:oA,type:this.type})]}}),aA="listItem",iy="textStyle",oy=/^\s*([-+*])\s$/,uA=wt.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(aA,this.editor.getAttributes(iy)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=Xo({find:oy,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Xo({find:oy,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(iy),editor:this.editor})),[n]}}),cA=/(^|[^`])`([^`]+)`(?!`)/,dA=/(^|[^`])`([^`]+)`(?!`)/g,fA=Bn.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[wi({find:cA,type:this.type})]},addPasteRules(){return[ki({find:dA,type:this.type})]}}),hA=/^```([a-z]+)?[\s\n]$/,pA=/^~~~([a-z]+)?[\s\n]$/,mA=wt.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options,i=[...((e=n.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",Ze(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:r,empty:s}=t;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:n.chain().command(({tr:l})=>(l.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:r}=e,{$from:s,empty:i}=t;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const l=s.after();return l===void 0?!1:r.nodeAt(l)?n.commands.command(({tr:u})=>(u.setSelection(W.near(r.resolve(l))),!0)):n.commands.exitCode()}}},addInputRules(){return[xf({find:hA,type:this.type,getAttributes:n=>({language:n[1]})}),xf({find:pA,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new xt({key:new Sn("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!t||!i)return!1;const{tr:o,schema:l}=n.state,a=l.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},a)),o.selection.$from.parent.type!==this.type&&o.setSelection(U.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),n.dispatch(o),!0}}})]}}),gA=wt.create({name:"doc",topNode:!0,content:"block+"});function yA(n={}){return new xt({view(e){return new vA(e,n)}})}class vA{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r;if(t){let l=e.nodeBefore,a=e.nodeAfter;if(l||a){let u=this.editorView.nodeDOM(this.cursorPos-(l?l.nodeSize:0));if(u){let c=u.getBoundingClientRect(),d=l?c.bottom:c.top;l&&a&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:c.left,right:c.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!r){let l=this.editorView.coordsAtPos(this.cursorPos);r={left:l.left-this.width/2,right:l.left+this.width/2,top:l.top,bottom:l.bottom}}let s=this.editorView.dom.offsetParent;this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let i,o;if(!s||s==document.body&&getComputedStyle(s).position=="static")i=-pageXOffset,o=-pageYOffset;else{let l=s.getBoundingClientRect();i=l.left-s.scrollLeft,o=l.top-s.scrollTop}this.element.style.left=r.left-i+"px",this.element.style.top=r.top-o+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,t,e):s;if(t&&!i){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=Fw(this.editorView.state.doc,o,this.editorView.dragging.slice);l!=null&&(o=l)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const wA=lt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[yA(this.options)]}});class ge extends W{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return ge.valid(r)?new ge(r):W.near(r)}content(){return N.empty}eq(e){return e instanceof ge&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ge(e.resolve(t.pos))}getBookmark(){return new up(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!kA(e)||!xA(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&ge.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let l=e.node(o);if(t>0?e.indexAfter(o)<l.childCount:e.index(o)>0){i=l.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=t;let a=e.doc.resolve(s);if(ge.valid(a))return a}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!B.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*t),r=!1;continue e}break}i=o,s+=t;let l=e.doc.resolve(s);if(ge.valid(l))return l}return null}}}ge.prototype.visible=!1;ge.findFrom=ge.findGapCursorFrom;W.jsonID("gapcursor",ge);class up{constructor(e){this.pos=e}map(e){return new up(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return ge.valid(t)?new ge(t):W.near(t)}}function kA(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function xA(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function SA(){return new xt({props:{decorations:EA,createSelectionBetween(n,e,t){return e.pos==t.pos&&ge.valid(t)?new ge(t):null},handleClick:_A,handleKeyDown:bA,handleDOMEvents:{beforeinput:CA}}})}const bA=C1({ArrowLeft:zl("horiz",-1),ArrowRight:zl("horiz",1),ArrowUp:zl("vert",-1),ArrowDown:zl("vert",1)});function zl(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,l=e>0?o.$to:o.$from,a=o.empty;if(o instanceof U){if(!i.endOfTextblock(t)||l.depth==0)return!1;a=!1,l=r.doc.resolve(e>0?l.after():l.before())}let u=ge.findGapCursorFrom(l,e,a);return u?(s&&s(r.tr.setSelection(new ge(u))),!0):!1}}function _A(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!ge.valid(r))return!1;let s=n.posAtCoords({left:t.clientX,top:t.clientY});return s&&s.inside>-1&&B.isSelectable(n.state.doc.nodeAt(s.inside))?!1:(n.dispatch(n.state.tr.setSelection(new ge(r))),!0)}function CA(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof ge))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let s=E.empty;for(let o=r.length-1;o>=0;o--)s=E.from(r[o].createAndFill(null,s));let i=n.state.tr.replace(t.pos,t.pos,new N(s,0,0));return i.setSelection(U.near(i.doc.resolve(t.pos+1))),n.dispatch(i),!1}function EA(n){if(!(n.selection instanceof ge))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Ee.create(n.doc,[jt.widget(n.selection.head,e,{key:"gapcursor"})])}const TA=lt.create({name:"gapCursor",addProseMirrorPlugins(){return[SA()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=K(L(n,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),OA=wt.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",Ze(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:r})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:s,storedMarks:i}=t;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:l}=r.extensionManager,a=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&a&&o){const d=a.filter(f=>l.includes(f.type.name));u.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),MA=wt.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,Ze(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>xf({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});var su=200,De=function(){};De.prototype.append=function(e){return e.length?(e=De.from(e),!this.length&&e||e.length<su&&this.leafAppend(e)||this.length<su&&e.leafPrepend(this)||this.appendInner(e)):this};De.prototype.prepend=function(e){return e.length?De.from(e).append(this):this};De.prototype.appendInner=function(e){return new AA(this,e)};De.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?De.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};De.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};De.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)};De.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},t,r),s};De.from=function(e){return e instanceof De?e:e&&e.length?new W1(e):De.empty};var W1=function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,l){for(var a=i;a<o;a++)if(s(this.values[a],l+a)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,l){for(var a=i-1;a>=o;a--)if(s(this.values[a],l+a)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=su)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=su)return new e(s.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(De);De.empty=new W1([]);var AA=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var l=this.left.length;if(s<l&&this.left.forEachInner(r,s,Math.min(i,l),o)===!1||i>l&&this.right.forEachInner(r,Math.max(s-l,0),Math.min(this.length,i)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var l=this.left.length;if(s>l&&this.right.forEachInvertedInner(r,s-l,Math.max(i,l)-l,o+l)===!1||i<l&&this.left.forEachInvertedInner(r,Math.min(s,l),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(De);const NA=500;class Yt{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;t&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,l,a,u=[],c=[];return this.items.forEach((d,f)=>{if(!d.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,c.push(d);return}if(s){c.push(new fn(d.map));let h=d.step.map(s.slice(i)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],u.push(new fn(p,void 0,void 0,u.length+c.length))),i--,p&&s.appendMap(p,i)}else o.maybeStep(d.step);if(d.selection)return l=s?d.selection.map(s.slice(i)):d.selection,a=new Yt(this.items.slice(0,r).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:o,selection:l}}addTransform(e,t,r,s){let i=[],o=this.eventCount,l=this.items,a=!s&&l.length?l.get(l.length-1):null;for(let c=0;c<e.steps.length;c++){let d=e.steps[c].invert(e.docs[c]),f=new fn(e.mapping.maps[c],d,t),h;(h=a&&a.merge(f))&&(f=h,c?i.pop():l=l.slice(0,l.length-1)),i.push(f),t&&(o++,t=void 0),s||(a=f)}let u=o-r.depth;return u>IA&&(l=PA(l,u),o-=u),new Yt(l.append(i),o)}remapping(e,t){let r=new Wo;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,t),r}addMaps(e){return this.eventCount==0?this:new Yt(this.items.append(e.map(t=>new fn(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},s);let a=t;this.items.forEach(f=>{let h=i.getMirror(--a);if(h==null)return;o=Math.min(o,h);let p=i.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),v=f.selection&&f.selection.map(i.slice(a+1,h));v&&l++,r.push(new fn(p,m,v))}else r.push(new fn(p))},s);let u=[];for(let f=t;f<o;f++)u.push(new fn(i.maps[f]));let c=this.items.slice(0,s).append(u).append(r),d=new Yt(c,l);return d.emptyItemCount()>NA&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,s=[],i=0;return this.items.forEach((o,l)=>{if(l>=e)s.push(o),o.selection&&i++;else if(o.step){let a=o.step.map(t.slice(r)),u=a&&a.getMap();if(r--,u&&t.appendMap(u,r),a){let c=o.selection&&o.selection.map(t.slice(r));c&&i++;let d=new fn(u.invert(),a,c),f,h=s.length-1;(f=s.length&&s[h].merge(d))?s[h]=f:s.push(d)}}else o.map&&r--},this.items.length,0),new Yt(De.from(s.reverse()),i)}}Yt.empty=new Yt(De.empty,0);function PA(n,e){let t;return n.forEach((r,s)=>{if(r.selection&&e--==0)return t=s,!1}),n.slice(t)}class fn{constructor(e,t,r,s){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new fn(t.getMap().invert(),t,this.selection)}}}class Xn{constructor(e,t,r,s,i){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const IA=20;function RA(n,e,t,r){let s=t.getMeta(Xr),i;if(s)return s.historyState;t.getMeta(LA)&&(n=new Xn(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(Xr))return o.getMeta(Xr).redo?new Xn(n.done.addTransform(t,void 0,r,ha(e)),n.undone,ly(t.mapping.maps),n.prevTime,n.prevComposition):new Xn(n.done,n.undone.addTransform(t,void 0,r,ha(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=t.getMeta("composition"),a=n.prevTime==0||!o&&n.prevComposition!=l&&(n.prevTime<(t.time||0)-r.newGroupDelay||!DA(t,n.prevRanges)),u=o?Vc(n.prevRanges,t.mapping):ly(t.mapping.maps);return new Xn(n.done.addTransform(t,a?e.selection.getBookmark():void 0,r,ha(e)),Yt.empty,u,t.time,l??n.prevComposition)}else return(i=t.getMeta("rebased"))?new Xn(n.done.rebased(t,i),n.undone.rebased(t,i),Vc(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new Xn(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),Vc(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function DA(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(t=!0)}),t}function ly(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((r,s,i,o)=>e.push(i,o));return e}function Vc(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let s=e.map(n[r],1),i=e.map(n[r+1],-1);s<=i&&t.push(s,i)}return t}function $A(n,e,t){let r=ha(e),s=Xr.get(e).spec.config,i=(t?n.undone:n.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),l=(t?n.done:n.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),a=new Xn(t?l:i.remaining,t?i.remaining:l,null,0,-1);return i.transform.setSelection(o).setMeta(Xr,{redo:t,historyState:a})}let Hc=!1,ay=null;function ha(n){let e=n.plugins;if(ay!=e){Hc=!1,ay=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Hc=!0;break}}return Hc}const Xr=new Sn("history"),LA=new Sn("closeHistory");function jA(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new xt({key:Xr,state:{init(){return new Xn(Yt.empty,Yt.empty,null,0,-1)},apply(e,t,r){return RA(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,s=r=="historyUndo"?J1:r=="historyRedo"?K1:null;return s?(t.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function q1(n,e){return(t,r)=>{let s=Xr.getState(t);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(r){let i=$A(s,t,n);i&&r(e?i.scrollIntoView():i)}return!0}}const J1=q1(!1,!0),K1=q1(!0,!0),FA=lt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>J1(n,e),redo:()=>({state:n,dispatch:e})=>K1(n,e)}},addProseMirrorPlugins(){return[jA(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),zA=wt.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",Ze(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{const{selection:t}=e,{$from:r,$to:s}=t,i=n();return r.parentOffset===0?i.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):ZO(t)?i.insertContentAt(s.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:l})=>{var a;if(l){const{$to:u}=o.selection,c=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(U.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(B.create(o.doc,u.pos)):o.setSelection(U.create(o.doc,u.pos));else{const d=(a=u.parent.type.contentMatch.defaultType)===null||a===void 0?void 0:a.create();d&&(o.insert(c,d),o.setSelection(U.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[NM({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),BA=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,UA=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,VA=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,HA=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,WA=Bn.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[wi({find:BA,type:this.type}),wi({find:VA,type:this.type})]},addPasteRules(){return[ki({find:UA,type:this.type}),ki({find:HA,type:this.type})]}}),qA=wt.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",Ze(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),JA="listItem",uy="textStyle",cy=/^(\d+)\.\s$/,KA=wt.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",Ze(this.options.HTMLAttributes,t),0]:["ol",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(JA,this.editor.getAttributes(uy)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=Xo({find:cy,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Xo({find:cy,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(uy)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),GA=wt.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),QA=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,XA=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,YA=Bn.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[wi({find:QA,type:this.type})]},addPasteRules(){return[ki({find:XA,type:this.type})]}}),ZA=wt.create({name:"text",group:"inline"}),eN=lt.create({name:"starterKit",addExtensions(){const n=[];return this.options.bold!==!1&&n.push(lA.configure(this.options.bold)),this.options.blockquote!==!1&&n.push(nA.configure(this.options.blockquote)),this.options.bulletList!==!1&&n.push(uA.configure(this.options.bulletList)),this.options.code!==!1&&n.push(fA.configure(this.options.code)),this.options.codeBlock!==!1&&n.push(mA.configure(this.options.codeBlock)),this.options.document!==!1&&n.push(gA.configure(this.options.document)),this.options.dropcursor!==!1&&n.push(wA.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&n.push(TA.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&n.push(OA.configure(this.options.hardBreak)),this.options.heading!==!1&&n.push(MA.configure(this.options.heading)),this.options.history!==!1&&n.push(FA.configure(this.options.history)),this.options.horizontalRule!==!1&&n.push(zA.configure(this.options.horizontalRule)),this.options.italic!==!1&&n.push(WA.configure(this.options.italic)),this.options.listItem!==!1&&n.push(qA.configure(this.options.listItem)),this.options.orderedList!==!1&&n.push(KA.configure(this.options.orderedList)),this.options.paragraph!==!1&&n.push(GA.configure(this.options.paragraph)),this.options.strike!==!1&&n.push(YA.configure(this.options.strike)),this.options.text!==!1&&n.push(ZA.configure(this.options.text)),n}}),tN=Bn.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",Ze(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),nN=()=>{const{editor:n}=XM();if(!n)return null;const e=[{action:()=>n.chain().focus().toggleBold().run(),icon:l_,isActive:n.isActive("bold"),title:"Bold"},{action:()=>n.chain().focus().toggleItalic().run(),icon:f_,isActive:n.isActive("italic"),title:"Italic"},{action:()=>n.chain().focus().toggleUnderline().run(),icon:__,isActive:n.isActive("underline"),title:"Underline"},{action:()=>n.chain().focus().toggleStrike().run(),icon:S_,isActive:n.isActive("strike"),title:"Strikethrough"},{action:()=>n.chain().focus().toggleHeading({level:2}).run(),icon:d_,isActive:n.isActive("heading",{level:2}),title:"Heading 2"},{action:()=>n.chain().focus().toggleBulletList().run(),icon:m_,isActive:n.isActive("bulletList"),title:"Bullet List"},{action:()=>n.chain().focus().toggleOrderedList().run(),icon:p_,isActive:n.isActive("orderedList"),title:"Ordered List"},{action:()=>n.chain().focus().toggleBlockquote().run(),icon:x_,isActive:n.isActive("blockquote"),title:"Blockquote"},{action:()=>n.chain().focus().toggleCodeBlock().run(),icon:c_,isActive:n.isActive("codeBlock"),title:"Code Block"}];return x.jsxs("div",{className:"border border-gray-600 rounded-t-lg p-2 flex flex-wrap items-center gap-1 bg-gray-800 print:hidden",children:[" ",e.map((t,r)=>x.jsx("button",{onClick:t.action,className:`p-2 rounded ${t.isActive?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"}`,title:t.title,disabled:!n.isEditable,children:x.jsx(t.icon,{className:"w-4 h-4"})},r))]})},rN=[eN.configure({heading:{levels:[1,2,3]}}),tN];function dy({content:n,onChange:e,editable:t=!0}){return x.jsxs("div",{className:"rich-text-editor border border-gray-600 rounded-b-lg bg-gray-850 dark:bg-gray-850 print:border-none",children:[" ",x.jsx(YM,{slotBefore:x.jsx(nN,{}),extensions:rN,content:n,onUpdate:({editor:r})=>{e(r.getHTML())},editable:t,editorProps:{attributes:{class:"prose prose-invert max-w-none p-4 focus:outline-none min-h-[150px] custom-scrollbar text-gray-900 dark:text-gray-100 print:text-black print:p-0 print:min-h-0"}}})]})}const sN=`
.tiptap {
  outline: none;
}
/* Ensure placeholder is visible in dark mode */
.dark .tiptap p.is-editor-empty:first-child::before {
  color: #4b5563; /* gray-600 */
}
.tiptap p.is-editor-empty:first-child::before {
  content: attr(data-placeholder);
  float: left;
  color: #9ca3af; /* gray-400 */
  pointer-events: none;
  height: 0;
}

/* Prose handles most of these, but keep as fallback if needed */
/*
.tiptap blockquote {
  border-left-color: #4b5563;
  margin-left: 1rem;
  padding-left: 1rem;
}
.tiptap pre {
  background: #1f2937;
  color: #d1d5db;
  font-family: monospace;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
}
.tiptap code {
  background-color: rgba(156, 163, 175, 0.2);
  border-radius: 0.25rem;
  padding: 0.1rem 0.3rem;
  font-size: 0.9em;
}
*/

/* Ensure editor itself has a background in dark mode */
.dark .rich-text-editor .tiptap {
    background-color: #1f2937; /* Match gray-850 or similar */
}
.rich-text-editor .tiptap {
    background-color: white;
}

/* Print-specific overrides for editor area */
@media print {
  .rich-text-editor .tiptap {
    background-color: white !important;
    color: black !important;
    border: none !important;
    padding: 0 !important;
    min-height: auto !important;
  }
  .rich-text-editor .tiptap * {
     color: black !important; /* Force all nested elements black */
     background-color: transparent !important;
  }
}
`;let xs=document.getElementById("tiptap-custom-styles");xs||(xs=document.createElement("style"),xs.id="tiptap-custom-styles",xs.type="text/css",xs.innerText=sN,document.head.appendChild(xs));function iN({isOpen:n,onClose:e,rows:t,onUpdateRow:r,onUpdateAllRows:s}){const[i,o]=z.useState(!1),[l,a]=z.useState("sections"),u=z.useRef(null),[c,d]=z.useState(""),[f,h]=z.useState({type:"idle",message:""});if(z.useEffect(()=>{if(l==="continuous"){const k=t.map(S=>`<h2>${S.title||"Untitled Section"}</h2>
${S.output}`).join(`
<hr class="my-4 border-gray-700">
`);d(k),h({type:"idle",message:""})}},[t,l]),z.useEffect(()=>{const k=()=>{o(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",k),()=>document.removeEventListener("fullscreenchange",k)},[]),z.useEffect(()=>{if(f.type==="success"||f.type==="error"){const k=setTimeout(()=>{h({type:"idle",message:""})},4e3);return()=>clearTimeout(k)}},[f]),!n)return null;const p=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},m=()=>{window.print()},v=k=>{d(k),h({type:"idle",message:""})},y=()=>{var k;h({type:"idle",message:""});try{const _=(k=new DOMParser().parseFromString(`<div>${c}</div>`,"text/html").body.firstChild)==null?void 0:k.childNodes;if(!_)throw new Error("Could not parse content.");const C=[];let T=null;if(_.forEach(P=>{var ye;P.nodeName==="H2"?(T={title:(P.textContent||"Untitled Section").trim(),outputHTML:""},C.push(T)):T&&P.nodeName!=="HR"?T.outputHTML+=P.outerHTML||P.textContent||"":!T&&P.nodeName!=="HR"&&((ye=P.textContent)!=null&&ye.trim())&&(console.warn("Content found before the first H2:",P.textContent),C.length===0&&(T={title:"Untitled Section",outputHTML:""},C.push(T)),T&&(T.outputHTML+=P.outerHTML||P.textContent||""))}),C.forEach(P=>{P.outputHTML=P.outputHTML.trim()}),console.log("Parsed Sections:",C),console.log("Original Row Count:",t.length),C.length!==t.length)throw new Error(`Parsing resulted in ${C.length} sections, but expected ${t.length}. Structure may have been changed too much. Sync aborted.`);const A=t.map((P,ye)=>{const Le=C[ye];return Le&&(P.title!==Le.title||P.output!==Le.outputHTML)?{...P,title:Le.title,output:Le.outputHTML}:P});s(A),h({type:"success",message:"Changes synced successfully!"})}catch(S){console.error("Error syncing continuous changes:",S),h({type:"error",message:S instanceof Error?S.message:"Sync failed."})}},g=()=>x.jsx("div",{className:"space-y-8",children:t.map(k=>x.jsxs("div",{className:"section-container",children:[x.jsx("h3",{className:"text-xl font-semibold text-white mb-3 border-b border-gray-700 pb-2",children:k.title||"Untitled Section"}),x.jsx(dy,{content:k.output,onChange:S=>r(k.id,S),editable:!0})]},k.id))}),w=()=>x.jsx(dy,{content:c,onChange:v,editable:!0});return x.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 print:bg-transparent print:p-0",children:[x.jsxs("div",{className:`bg-gray-900 rounded-lg w-full ${i?"h-screen m-0 rounded-none":"max-w-4xl max-h-[80vh]"} flex flex-col print:max-h-none print:h-auto print:shadow-none print:rounded-none print:bg-white print:text-black`,id:"printable-modal-content",children:[x.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center shrink-0 print:hidden",children:[x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsx("h2",{className:"text-xl font-bold text-white",children:"Full Document"}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsxs("button",{onClick:()=>a("sections"),className:`flex items-center px-3 py-1.5 rounded transition-colors ${l==="sections"?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-800"}`,title:"Sections View (Editable)",children:[x.jsx(h_,{className:"w-4 h-4 mr-2"})," Sections"]}),x.jsxs("button",{onClick:()=>a("continuous"),className:`flex items-center px-3 py-1.5 rounded transition-colors ${l==="continuous"?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-800"}`,title:"Continuous View (Editable)",children:[x.jsx(w_,{className:"w-4 h-4 mr-2"})," Continuous"]})]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[l==="continuous"&&x.jsxs("button",{onClick:y,className:"flex items-center px-3 py-1.5 rounded bg-green-600 text-white hover:bg-green-700 transition-colors",title:"Parse edits and update sections",children:[x.jsx(cw,{className:"w-4 h-4 mr-2"})," Sync Changes"]}),x.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-800 rounded-full",title:"Print Document",children:x.jsx(k_,{className:"w-5 h-5 text-gray-400"})}),x.jsx("button",{onClick:p,className:"p-2 hover:bg-gray-800 rounded-full",children:i?x.jsx(y_,{className:"w-5 h-5 text-gray-400"}):x.jsx(g_,{className:"w-5 h-5 text-gray-400"})}),x.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-800 rounded-full",children:x.jsx(Eu,{className:"w-5 h-5 text-gray-400"})})]})]}),f.type!=="idle"&&x.jsx("div",{className:`p-2 text-center text-sm ${f.type==="success"?"bg-green-800 text-green-100":"bg-red-800 text-red-100"}`,children:x.jsxs("div",{className:"flex items-center justify-center",children:[f.type==="success"?x.jsx(a_,{className:"w-4 h-4 mr-2"}):x.jsx(ua,{className:"w-4 h-4 mr-2"}),f.message]})}),x.jsx("div",{ref:u,className:"flex-1 overflow-y-auto p-6 custom-scrollbar print:overflow-visible print:p-8 print:bg-white",children:l==="sections"?g():w()})]}),x.jsx("style",{jsx:!0,global:!0,children:`
        @media print {
          body * { visibility: hidden; }
          #printable-modal-content, #printable-modal-content * { visibility: visible; }
          #printable-modal-content { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 1cm; border: none; box-shadow: none; color: black !important; background-color: white !important; }
          #printable-modal-content .prose { color: black; }
          #printable-modal-content .prose h2, #printable-modal-content .prose h3 { color: black; border-color: #ccc; }
          #printable-modal-content .prose blockquote { border-left-color: #ccc; }
          #printable-modal-content .prose code { background-color: #f3f4f6; color: #1f2937; }
          #printable-modal-content .prose pre { background-color: #f3f4f6; color: #1f2937; }
          .rich-text-editor > div:first-child { display: none; } /* Hide toolbar */
          .rich-text-editor { border: none !important; }
          .tiptap { min-height: auto !important; padding: 0 !important; }
          #printable-modal-content hr { border-color: #ccc !important; border-top-width: 1px !important; visibility: visible !important; }
        }
      `})]})}function oN({isOpen:n,onClose:e,onSave:t,onOpen:r,onDelete:s,savedDocuments:i,currentDocument:o}){const[l,a]=z.useState(""),[u,c]=z.useState(null);if(z.useEffect(()=>{n&&a((o==null?void 0:o.title)||""),c(null)},[n,o]),!n)return null;const d=()=>{l.trim()&&t(l.trim())},f=p=>{try{return new Date(p).toLocaleString()}catch{return"Invalid Date"}},h=p=>{u===p?(s(p),c(null)):c(p)};return x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsxs("div",{className:"bg-gray-900 rounded-lg w-full max-w-2xl overflow-hidden flex flex-col max-h-[80vh]",children:[x.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center shrink-0",children:[x.jsx("h2",{className:"text-xl font-bold text-white",children:"Document Manager"}),x.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-800 rounded-full",children:x.jsx(Eu,{className:"w-5 h-5 text-gray-400"})})]}),x.jsxs("div",{className:"p-4 flex-1 overflow-y-auto custom-scrollbar",children:[x.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-700",children:[x.jsx("label",{htmlFor:"docTitle",className:"block text-sm font-medium text-gray-300 mb-1",children:o?"Update Title & Save":"Save New Document As"}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("input",{id:"docTitle",type:"text",value:l,onChange:p=>a(p.target.value),placeholder:"Enter document title...",className:"flex-1 p-2 bg-gray-800 text-white rounded border border-gray-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"}),x.jsxs("button",{onClick:d,disabled:!l.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center shrink-0",children:[x.jsx(dw,{className:"w-4 h-4 mr-2"}),o?"Save Changes":"Save New"]})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Saved Documents"}),i.length===0?x.jsx("p",{className:"text-gray-400",children:"No saved documents found."}):x.jsx("div",{className:"space-y-2",children:i.map(p=>x.jsxs("div",{className:`p-3 rounded-lg flex items-center justify-between group transition-colors ${(o==null?void 0:o.id)===p.id?"bg-blue-900 bg-opacity-50":"bg-gray-800 hover:bg-gray-700"}`,children:[x.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[x.jsx("h4",{className:`font-medium truncate ${(o==null?void 0:o.id)===p.id?"text-white":"text-gray-200"}`,children:p.title}),x.jsxs("div",{className:"flex items-center text-xs text-gray-400 space-x-3 mt-1",children:[x.jsxs("span",{className:"flex items-center",children:[x.jsx(u_,{className:"w-3 h-3 mr-1"}),f(p.updatedAt)]}),x.jsxs("span",{children:[p.rows.length," sections"]})]})]}),x.jsxs("div",{className:"flex items-center space-x-1 shrink-0",children:[x.jsx("button",{onClick:()=>r(p),title:"Open Document",className:"p-2 text-gray-400 hover:text-white hover:bg-gray-600 rounded",children:x.jsx(uw,{className:"w-4 h-4"})}),x.jsx("button",{onClick:()=>h(p.id),title:u===p.id?"Confirm Delete":"Delete Document",className:`p-2 rounded transition-colors ${u===p.id?"bg-red-600 text-white hover:bg-red-700":"text-gray-400 hover:text-red-500 hover:bg-gray-600"}`,children:x.jsx(fw,{className:"w-4 h-4"})})]})]},p.id))})]})]})]})})}const bf="RFC3986",_f={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},lN="RFC1738",aN=Array.isArray,an=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),Wc=1024,uN=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(l){return"%26%23"+parseInt(l.slice(2),16)+"%3B"});let o="";for(let l=0;l<i.length;l+=Wc){const a=i.length>=Wc?i.slice(l,l+Wc):i,u=[];for(let c=0;c<a.length;++c){let d=a.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===lN&&(d===40||d===41)){u[u.length]=a.charAt(c);continue}if(d<128){u[u.length]=an[d];continue}if(d<2048){u[u.length]=an[192|d>>6]+an[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=an[224|d>>12]+an[128|d>>6&63]+an[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|a.charCodeAt(c)&1023),u[u.length]=an[240|d>>18]+an[128|d>>12&63]+an[128|d>>6&63]+an[128|d&63]}o+=u.join("")}return o};function cN(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function fy(n,e){if(aN(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const dN=Object.prototype.hasOwnProperty,G1={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},hn=Array.isArray,fN=Array.prototype.push,Q1=function(n,e){fN.apply(n,hn(e)?e:[e])},hN=Date.prototype.toISOString,_e={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:uN,encodeValuesOnly:!1,format:bf,formatter:_f[bf],indices:!1,serializeDate(n){return hN.call(n)},skipNulls:!1,strictNullHandling:!1};function pN(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const qc={};function X1(n,e,t,r,s,i,o,l,a,u,c,d,f,h,p,m,v,y){let g=n,w=y,k=0,S=!1;for(;(w=w.get(qc))!==void 0&&!S;){const A=w.get(n);if(k+=1,typeof A<"u"){if(A===k)throw new RangeError("Cyclic object value");S=!0}typeof w.get(qc)>"u"&&(k=0)}if(typeof u=="function"?g=u(e,g):g instanceof Date?g=f==null?void 0:f(g):t==="comma"&&hn(g)&&(g=fy(g,function(A){return A instanceof Date?f==null?void 0:f(A):A})),g===null){if(i)return a&&!m?a(e,_e.encoder,v,"key",h):e;g=""}if(pN(g)||cN(g)){if(a){const A=m?e:a(e,_e.encoder,v,"key",h);return[(p==null?void 0:p(A))+"="+(p==null?void 0:p(a(g,_e.encoder,v,"value",h)))]}return[(p==null?void 0:p(e))+"="+(p==null?void 0:p(String(g)))]}const b=[];if(typeof g>"u")return b;let _;if(t==="comma"&&hn(g))m&&a&&(g=fy(g,a)),_=[{value:g.length>0?g.join(",")||null:void 0}];else if(hn(u))_=u;else{const A=Object.keys(g);_=c?A.sort(c):A}const C=l?String(e).replace(/\./g,"%2E"):String(e),T=r&&hn(g)&&g.length===1?C+"[]":C;if(s&&hn(g)&&g.length===0)return T+"[]";for(let A=0;A<_.length;++A){const P=_[A],ye=typeof P=="object"&&typeof P.value<"u"?P.value:g[P];if(o&&ye===null)continue;const Le=d&&l?P.replace(/\./g,"%2E"):P,hs=hn(g)?typeof t=="function"?t(T,Le):T:T+(d?"."+Le:"["+Le+"]");y.set(n,k);const ps=new WeakMap;ps.set(qc,y),Q1(b,X1(ye,hs,t,r,s,i,o,l,t==="comma"&&m&&hn(g)?null:a,u,c,d,f,h,p,m,v,ps))}return b}function mN(n=_e){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||_e.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=bf;if(typeof n.format<"u"){if(!dN.call(_f,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=_f[t];let s=_e.filter;(typeof n.filter=="function"||hn(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in G1?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=_e.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:_e.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:_e.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:_e.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:_e.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?_e.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:_e.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:_e.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:_e.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:_e.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:_e.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:_e.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:_e.strictNullHandling}}function gN(n,e={}){let t=n;const r=mN(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):hn(r.filter)&&(i=r.filter,s=i);const o=[];if(typeof t!="object"||t===null)return"";const l=G1[r.arrayFormat],a=l==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];r.skipNulls&&t[h]===null||Q1(o,X1(t[h],h,l,a,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const c=o.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const Ms="4.77.4";let hy=!1,xo,Y1,Z1,Cf,ek,tk,nk,rk,sk;function yN(n,e={auto:!1}){if(hy)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(xo)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${xo}'\``);hy=e.auto,xo=n.kind,Y1=n.fetch,Z1=n.FormData,Cf=n.File,ek=n.ReadableStream,tk=n.getMultipartRequestOptions,nk=n.getDefaultAgent,rk=n.fileFromPath,sk=n.isFsReadStream}class vN{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function wN({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,l)=>({...l,body:new vN(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}xo||yN(wN(),{auto:!0});class X extends Error{}class We extends X{constructor(e,t,r,s){super(`${We.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new zu({message:r,cause:Tf(t)});const i=t==null?void 0:t.error;return e===400?new ik(e,i,r,s):e===401?new ok(e,i,r,s):e===403?new lk(e,i,r,s):e===404?new ak(e,i,r,s):e===409?new uk(e,i,r,s):e===422?new ck(e,i,r,s):e===429?new dk(e,i,r,s):e>=500?new fk(e,i,r,s):new We(e,i,r,s)}}class Zt extends We{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class zu extends We{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class cp extends zu{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ik extends We{}class ok extends We{}class lk extends We{}class ak extends We{}class uk extends We{}class ck extends We{}class dk extends We{}class fk extends We{}class hk extends X{constructor(){super("Could not parse response content as the length limit was reached")}}class pk extends X{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class ls{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ls.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ls.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new X(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new X(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new X("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ls.NEWLINE_CHARS=new Set([`
`,"\r"]);ls.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class yn{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of kN(e,t))if(!i){if(o.data.startsWith("[DONE]")){i=!0;continue}if(o.event===null){let l;try{l=JSON.parse(o.data)}catch(a){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),a}if(l&&l.error)throw new We(void 0,l.error,void 0,void 0);yield l}else{let l;try{l=JSON.parse(o.data)}catch(a){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),a}if(o.event=="error")throw new We(void 0,l.error,l.message,void 0);yield{event:o.event,data:l}}}i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new yn(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const o=new ls,l=mk(e);for await(const a of l)for(const u of o.decode(a))yield u;for(const a of o.flush())yield a}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const l of s())o||l&&(yield JSON.parse(l));o=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{o||t.abort()}}return new yn(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new yn(()=>s(e),this.controller),new yn(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new ek({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:o}=await t.next();if(o)return s.close();const l=r.encode(JSON.stringify(i)+`
`);s.enqueue(l)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*kN(n,e){if(!n.body)throw e.abort(),new X("Attempted to iterate over a response with no body");const t=new bN,r=new ls,s=mk(n.body);for await(const i of xN(s))for(const o of r.decode(i)){const l=t.decode(o);l&&(yield l)}for(const i of r.flush()){const o=t.decode(i);o&&(yield o)}}async function*xN(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=SN(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function SN(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class bN{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=_N(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function _N(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function mk(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const gk=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",yk=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Bu(n),Bu=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",CN=n=>yk(n)||gk(n)||sk(n);async function vk(n,e,t){var s;if(n=await n,yk(n))return n;if(gk(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=Bu(i)?[await i.arrayBuffer()]:[i];return new Cf(o,e,t)}const r=await EN(n);if(e||(e=ON(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new Cf(r,e,t)}async function EN(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Bu(n))e.push(await n.arrayBuffer());else if(MN(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${TN(n)}`);return e}function TN(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function ON(n){var e;return Jc(n.name)||Jc(n.filename)||((e=Jc(n.path))==null?void 0:e.split(/[\\/]/).pop())}const Jc=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},MN=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",py=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",xi=async n=>{const e=await AN(n.body);return tk(e,n)},AN=async n=>{const e=new Z1;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Ef(e,t,r))),e},Ef=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(CN(t)){const r=await vk(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Ef(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Ef(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ni={},NN=function(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},PN=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Bl;async function wk(n){const{response:e}=n;if(n.options.stream)return ri("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):yn.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return ri("response",e.status,e.url,e.headers,i),kk(i,e)}const s=await e.text();return ri("response",e.status,e.url,e.headers,s),s}function kk(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Uu extends Promise{constructor(e,t=wk){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Uu(this.responsePromise,async t=>kk(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class IN{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Kc("maxRetries",t),this.timeout=Kc("timeout",r),this.httpAgent=s,this.fetch=i??Y1}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...FN(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${VN()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&Bu(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var m;const{method:r,path:s,query:i,headers:o={}}=e,l=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:py(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(l),u=this.buildURL(s,i);"timeout"in e&&Kc("timeout",e.timeout);const c=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??nk(u),f=c+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:o,contentLength:a,retryCount:t});return{req:{method:r,...l&&{body:l},headers:h,...d&&{agent:d},signal:e.signal??null},url:u,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const o=this.defaultHeaders(e);return vy(i,o),vy(i,t),py(e.body)&&xo!=="node"&&delete i["content-type"],wy(o,"x-stainless-retry-count")===void 0&&wy(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return We.generate(e,t,r,s)}request(e,t=null){return new Uu(this.makeRequest(e,t))}async makeRequest(e,t){var d,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:o,timeout:l}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:o,options:r}),ri("request",o,r,i.headers),(d=r.signal)!=null&&d.aborted)throw new Zt;const a=new AbortController,u=await this.fetchWithTimeout(o,i,l,a).catch(Tf);if(u instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new Zt;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new cp:new zu({cause:u})}const c=DN(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const g=`retrying, ${t} attempts remaining`;return ri(`response (error; ${g})`,u.status,o,c),this.retryRequest(r,t,c)}const h=await u.text().catch(g=>Tf(g).message),p=zN(h),m=p?void 0:h;throw ri(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,o,c,m),this.makeStatusError(u.status,p,m,c)}return{response:u,options:r,controller:a}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new RN(this,r,e)}buildURL(e,t){const r=UN(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Sk(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new X(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...o}=t||{};i&&i.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),r),a={signal:s.signal,...o};return a.method&&(a.method=a.method.toUpperCase()),this.fetch.call(void 0,e,a).finally(()=>{clearTimeout(l)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const l=parseFloat(i);Number.isNaN(l)||(s=l)}const o=r==null?void 0:r["retry-after"];if(o&&!s){const l=parseFloat(o);Number.isNaN(l)?s=Date.parse(o)-Date.now():s=l*1e3}if(!(s&&0<=s&&s<60*1e3)){const l=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,l)}return await ul(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,o=Math.min(.5*Math.pow(2,i),8),l=1-Math.random()*.25;return o*l*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ms}`}}class xk{constructor(e,t,r,s){Bl.set(this,void 0),NN(this,Bl,e),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new X("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await PN(this,Bl,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Bl=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class RN extends Uu{constructor(e,t,r){super(t,async s=>new r(e,s.response,await wk(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const DN=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),$N={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},kt=n=>typeof n=="object"&&n!==null&&!Sk(n)&&Object.keys(n).every(e=>bk($N,e)),LN=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ms,"X-Stainless-OS":gy(Deno.build.os),"X-Stainless-Arch":my(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ms,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ms,"X-Stainless-OS":gy(process.platform),"X-Stainless-Arch":my(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=jN();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ms,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ms,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jN(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${s}.${i}.${o}`}}}return null}const my=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",gy=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let yy;const FN=()=>yy??(yy=LN()),zN=n=>{try{return JSON.parse(n)}catch{return}},BN=/^[a-z][a-z0-9+.-]*:/i,UN=n=>BN.test(n),ul=n=>new Promise(e=>setTimeout(e,n)),Kc=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new X(`${n} must be an integer`);if(e<0)throw new X(`${n} must be a positive integer`);return e},Tf=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},Ul=n=>{var e,t,r,s;if(typeof process<"u")return((e=ni==null?void 0:ni[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:s.trim()};function Sk(n){if(!n)return!0;for(const e in n)return!1;return!0}function bk(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function vy(n,e){for(const t in e){if(!bk(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function ri(n,...e){typeof process<"u"&&(ni==null?void 0:ni.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const VN=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),HN=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",WN=n=>typeof(n==null?void 0:n.get)=="function",wy=(n,e)=>{var r;const t=e.toLowerCase();if(WN(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,o,l)=>o+l.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const o=n.get(i);if(o)return o}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function Gc(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class qN extends xk{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class on extends xk{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class ne{constructor(e){this._client=e}}let _k=class extends ne{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},dp=class extends ne{constructor(){super(...arguments),this.completions=new _k(this._client)}};dp.Completions=_k;class Ck extends ne{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class Ek extends ne{create(e,t){return this._client.post("/audio/transcriptions",xi({body:e,...t}))}}class Tk extends ne{create(e,t){return this._client.post("/audio/translations",xi({body:e,...t}))}}class cl extends ne{constructor(){super(...arguments),this.transcriptions=new Ek(this._client),this.translations=new Tk(this._client),this.speech=new Ck(this._client)}}cl.Transcriptions=Ek;cl.Translations=Tk;cl.Speech=Ck;class fp extends ne{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return kt(e)?this.list({},e):this._client.getAPIList("/batches",hp,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class hp extends on{}fp.BatchesPage=hp;class pp extends ne{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return kt(e)?this.list({},e):this._client.getAPIList("/assistants",mp,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class mp extends on{}pp.AssistantsPage=mp;function ky(n){return typeof n.parse=="function"}const si=n=>(n==null?void 0:n.role)==="assistant",Ok=n=>(n==null?void 0:n.role)==="function",Mk=n=>(n==null?void 0:n.role)==="tool";var qt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},de=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Of,pa,ma,Zi,eo,ga,to,Tn,no,iu,ou,As,Ak;class Nk{constructor(){Of.add(this),this.controller=new AbortController,pa.set(this,void 0),ma.set(this,()=>{}),Zi.set(this,()=>{}),eo.set(this,void 0),ga.set(this,()=>{}),to.set(this,()=>{}),Tn.set(this,{}),no.set(this,!1),iu.set(this,!1),ou.set(this,!1),As.set(this,!1),qt(this,pa,new Promise((e,t)=>{qt(this,ma,e,"f"),qt(this,Zi,t,"f")}),"f"),qt(this,eo,new Promise((e,t)=>{qt(this,ga,e,"f"),qt(this,to,t,"f")}),"f"),de(this,pa,"f").catch(()=>{}),de(this,eo,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},de(this,Of,"m",Ak).bind(this))},0)}_connected(){this.ended||(de(this,ma,"f").call(this),this._emit("connect"))}get ended(){return de(this,no,"f")}get errored(){return de(this,iu,"f")}get aborted(){return de(this,ou,"f")}abort(){this.controller.abort()}on(e,t){return(de(this,Tn,"f")[e]||(de(this,Tn,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=de(this,Tn,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(de(this,Tn,"f")[e]||(de(this,Tn,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{qt(this,As,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){qt(this,As,!0,"f"),await de(this,eo,"f")}_emit(e,...t){if(de(this,no,"f"))return;e==="end"&&(qt(this,no,!0,"f"),de(this,ga,"f").call(this));const r=de(this,Tn,"f")[e];if(r&&(de(this,Tn,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!de(this,As,"f")&&!(r!=null&&r.length)&&Promise.reject(s),de(this,Zi,"f").call(this,s),de(this,to,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!de(this,As,"f")&&!(r!=null&&r.length)&&Promise.reject(s),de(this,Zi,"f").call(this,s),de(this,to,"f").call(this,s),this._emit("end")}}_emitFinal(){}}pa=new WeakMap,ma=new WeakMap,Zi=new WeakMap,eo=new WeakMap,ga=new WeakMap,to=new WeakMap,Tn=new WeakMap,no=new WeakMap,iu=new WeakMap,ou=new WeakMap,As=new WeakMap,Of=new WeakSet,Ak=function(e){if(qt(this,iu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Zt),e instanceof Zt)return qt(this,ou,!0,"f"),this._emit("abort",e);if(e instanceof X)return this._emit("error",e);if(e instanceof Error){const t=new X(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new X(String(e)))};function Pk(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function dl(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function JN(n,e){return!e||!Ik(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:gp(n,e)}function gp(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new hk;if(r.finish_reason==="content_filter")throw new pk;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>GN(e,i)))??[],parsed:r.message.content&&!r.message.refusal?KN(e,r.message.content):null}}});return{...n,choices:t}}function KN(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function GN(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:dl(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function QN(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return dl(t)||(t==null?void 0:t.function.strict)||!1}function Ik(n){var e;return Pk(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>dl(t)||t.type==="function"&&t.function.strict===!0))??!1}function XN(n){for(const e of n??[]){if(e.type!=="function")throw new X(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new X(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var dt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ke,Mf,lu,Af,Nf,Pf,Rk,If;const xy=10;class Dk extends Nk{constructor(){super(...arguments),Ke.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ok(e)||Mk(e))&&e.content)this._emit("functionCallResult",e.content);else if(si(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(si(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new X("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),dt(this,Ke,"m",Mf).call(this)}async finalMessage(){return await this.done(),dt(this,Ke,"m",lu).call(this)}async finalFunctionCall(){return await this.done(),dt(this,Ke,"m",Af).call(this)}async finalFunctionCallResult(){return await this.done(),dt(this,Ke,"m",Nf).call(this)}async totalUsage(){return await this.done(),dt(this,Ke,"m",Pf).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=dt(this,Ke,"m",lu).call(this);t&&this._emit("finalMessage",t);const r=dt(this,Ke,"m",Mf).call(this);r&&this._emit("finalContent",r);const s=dt(this,Ke,"m",Af).call(this);s&&this._emit("finalFunctionCall",s);const i=dt(this,Ke,"m",Nf).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",dt(this,Ke,"m",Pf).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),dt(this,Ke,"m",Rk).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(gp(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:o,...l}=t,a=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:u=xy}=r||{},c={};for(const h of t.functions)c[h.name||h.function.name]=h;const d=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...l,function_call:i,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!m)throw new X("missing message in ChatCompletion response");if(!m.function_call)return;const{name:v,arguments:y}=m.function_call,g=c[v];if(g){if(a&&a!==v){const b=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:s,name:v,content:b});continue}}else{const b=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${d.map(_=>JSON.stringify(_.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:v,content:b});continue}let w;try{w=ky(g)?await g.parse(y):y}catch(b){this._addMessage({role:s,name:v,content:b instanceof Error?b.message:String(b)});continue}const k=await g.function(w,this),S=dt(this,Ke,"m",If).call(this,k);if(this._addMessage({role:s,name:v,content:S}),a)return}}async _runTools(e,t,r){var h,p,m;const s="tool",{tool_choice:i="auto",stream:o,...l}=t,a=typeof i!="string"&&((h=i==null?void 0:i.function)==null?void 0:h.name),{maxChatCompletions:u=xy}=r||{},c=t.tools.map(v=>{if(dl(v)){if(!v.$callback)throw new X("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of c)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const f="tools"in t?c.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of t.messages)this._addMessage(v,!1);for(let v=0;v<u;++v){const g=(p=(await this._createChatCompletion(e,{...l,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!g)throw new X("missing message in ChatCompletion response");if(!((m=g.tool_calls)!=null&&m.length))return;for(const w of g.tool_calls){if(w.type!=="function")continue;const k=w.id,{name:S,arguments:b}=w.function,_=d[S];if(_){if(a&&a!==S){const P=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:s,tool_call_id:k,content:P});continue}}else{const P=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(d).map(ye=>JSON.stringify(ye)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:k,content:P});continue}let C;try{C=ky(_)?await _.parse(b):b}catch(P){const ye=P instanceof Error?P.message:String(P);this._addMessage({role:s,tool_call_id:k,content:ye});continue}const T=await _.function(C,this),A=dt(this,Ke,"m",If).call(this,T);if(this._addMessage({role:s,tool_call_id:k,content:A}),a)return}}}}Ke=new WeakSet,Mf=function(){return dt(this,Ke,"m",lu).call(this).content??null},lu=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(si(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new X("stream ended without producing a ChatCompletionMessage with role=assistant")},Af=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(si(s)&&(s!=null&&s.function_call))return s.function_call;if(si(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Nf=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ok(t)&&t.content!=null||Mk(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Pf=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Rk=function(e){if(e.n!=null&&e.n>1)throw new X("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},If=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Yo extends Dk{static runFunctions(e,t,r){const s=new Yo,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Yo,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),si(e)&&e.content&&this._emit("content",e.content)}}const $k=1,Lk=2,jk=4,Fk=8,zk=16,Bk=32,Uk=64,Vk=128,Hk=256,Wk=Vk|Hk,qk=zk|Bk|Wk|Uk,Jk=$k|Lk|qk,Kk=jk|Fk,YN=Jk|Kk,Oe={STR:$k,NUM:Lk,ARR:jk,OBJ:Fk,NULL:zk,BOOL:Bk,NAN:Uk,INFINITY:Vk,MINUS_INFINITY:Hk,INF:Wk,SPECIAL:qk,ATOM:Jk,COLLECTION:Kk,ALL:YN};class ZN extends Error{}class eP extends Error{}function tP(n,e=Oe.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return nP(n.trim(),e)}const nP=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new ZN(`${f} at position ${r}`)},i=f=>{throw new eP(`${f} at position ${r}`)},o=()=>(d(),r>=t&&s("Unexpected end of input"),n[r]==='"'?l():n[r]==="{"?a():n[r]==="["?u():n.substring(r,r+4)==="null"||Oe.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Oe.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Oe.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Oe.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Oe.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Oe.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):c()),l=()=>{const f=r;let h=!1;for(r++;r<t&&(n[r]!=='"'||h&&n[r-1]==="\\");)h=n[r]==="\\"?!h:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(h)))}catch(p){i(String(p))}else if(Oe.STR&e)try{return JSON.parse(n.substring(f,r-Number(h))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},a=()=>{r++,d();const f={};try{for(;n[r]!=="}";){if(d(),r>=t&&Oe.OBJ&e)return f;const h=l();d(),r++;try{const p=o();Object.defineProperty(f,h,{value:p,writable:!0,enumerable:!0,configurable:!0})}catch(p){if(Oe.OBJ&e)return f;throw p}d(),n[r]===","&&r++}}catch{if(Oe.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},u=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(o()),d(),n[r]===","&&r++}catch{if(Oe.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},c=()=>{if(r===0){n==="-"&&Oe.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(h){if(Oe.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(h))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Oe.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&Oe.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(p){i(String(p))}}},d=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return o()},Sy=n=>tP(n,Oe.ALL^Oe.NUM);var Ss=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},re=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},be,En,bs,Hn,Qc,Vl,Xc,Yc,Zc,Hl,ed,by;class Zo extends Dk{constructor(e){super(),be.add(this),En.set(this,void 0),bs.set(this,void 0),Hn.set(this,void 0),Ss(this,En,e,"f"),Ss(this,bs,[],"f")}get currentChatCompletionSnapshot(){return re(this,Hn,"f")}static fromReadableStream(e){const t=new Zo(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new Zo(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var o;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),re(this,be,"m",Qc).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const l of i)re(this,be,"m",Xc).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new Zt;return this._addChatCompletion(re(this,be,"m",Hl).call(this))}async _fromReadableStream(e,t){var o;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),re(this,be,"m",Qc).call(this),this._connected();const s=yn.fromReadableStream(e,this.controller);let i;for await(const l of s)i&&i!==l.id&&this._addChatCompletion(re(this,be,"m",Hl).call(this)),re(this,be,"m",Xc).call(this,l),i=l.id;if((o=s.controller.signal)!=null&&o.aborted)throw new Zt;return this._addChatCompletion(re(this,be,"m",Hl).call(this))}[(En=new WeakMap,bs=new WeakMap,Hn=new WeakMap,be=new WeakSet,Qc=function(){this.ended||Ss(this,Hn,void 0,"f")},Vl=function(t){let r=re(this,bs,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},re(this,bs,"f")[t.index]=r,r)},Xc=function(t){var s,i,o,l,a,u,c,d,f,h,p,m,v,y,g;if(this.ended)return;const r=re(this,be,"m",by).call(this,t);this._emit("chunk",t,r);for(const w of t.choices){const k=r.choices[w.index];w.delta.content!=null&&((s=k.message)==null?void 0:s.role)==="assistant"&&((i=k.message)!=null&&i.content)&&(this._emit("content",w.delta.content,k.message.content),this._emit("content.delta",{delta:w.delta.content,snapshot:k.message.content,parsed:k.message.parsed})),w.delta.refusal!=null&&((o=k.message)==null?void 0:o.role)==="assistant"&&((l=k.message)!=null&&l.refusal)&&this._emit("refusal.delta",{delta:w.delta.refusal,snapshot:k.message.refusal}),((a=w.logprobs)==null?void 0:a.content)!=null&&((u=k.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=w.logprobs)==null?void 0:c.content,snapshot:((d=k.logprobs)==null?void 0:d.content)??[]}),((f=w.logprobs)==null?void 0:f.refusal)!=null&&((h=k.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(p=w.logprobs)==null?void 0:p.refusal,snapshot:((m=k.logprobs)==null?void 0:m.refusal)??[]});const S=re(this,be,"m",Vl).call(this,k);k.finish_reason&&(re(this,be,"m",Zc).call(this,k),S.current_tool_call_index!=null&&re(this,be,"m",Yc).call(this,k,S.current_tool_call_index));for(const b of w.delta.tool_calls??[])S.current_tool_call_index!==b.index&&(re(this,be,"m",Zc).call(this,k),S.current_tool_call_index!=null&&re(this,be,"m",Yc).call(this,k,S.current_tool_call_index)),S.current_tool_call_index=b.index;for(const b of w.delta.tool_calls??[]){const _=(v=k.message.tool_calls)==null?void 0:v[b.index];_!=null&&_.type&&((_==null?void 0:_.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(y=_.function)==null?void 0:y.name,index:b.index,arguments:_.function.arguments,parsed_arguments:_.function.parsed_arguments,arguments_delta:((g=b.function)==null?void 0:g.arguments)??""}):(_==null||_.type,void 0))}}},Yc=function(t,r){var o,l,a;if(re(this,be,"m",Vl).call(this,t).done_tool_calls.has(r))return;const i=(o=t.message.tool_calls)==null?void 0:o[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const u=(a=(l=re(this,En,"f"))==null?void 0:l.tools)==null?void 0:a.find(c=>c.type==="function"&&c.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:dl(u)?u.$parseRaw(i.function.arguments):u!=null&&u.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Zc=function(t){var s,i;const r=re(this,be,"m",Vl).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const o=re(this,be,"m",ed).call(this);this._emit("content.done",{content:t.message.content,parsed:o?o.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Hl=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");const t=re(this,Hn,"f");if(!t)throw new X("request ended without sending any chunks");return Ss(this,Hn,void 0,"f"),Ss(this,bs,[],"f"),rP(t,re(this,En,"f"))},ed=function(){var r;const t=(r=re(this,En,"f"))==null?void 0:r.response_format;return Pk(t)?t:null},by=function(t){var r,s,i,o;let l=re(this,Hn,"f");const{choices:a,...u}=t;l?Object.assign(l,u):l=Ss(this,Hn,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...p}of t.choices){let m=l.choices[f];if(m||(m=l.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...p}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:b,refusal:_,...C}=h;Object.assign(m.logprobs,C),b&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...b)),_&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(..._))}if(d&&(m.finish_reason=d,re(this,En,"f")&&Ik(re(this,En,"f")))){if(d==="length")throw new hk;if(d==="content_filter")throw new pk}if(Object.assign(m,p),!c)continue;const{content:v,refusal:y,function_call:g,role:w,tool_calls:k,...S}=c;if(Object.assign(m.message,S),y&&(m.message.refusal=(m.message.refusal||"")+y),w&&(m.message.role=w),g&&(m.message.function_call?(g.name&&(m.message.function_call.name=g.name),g.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=g.arguments)):m.message.function_call=g),v&&(m.message.content=(m.message.content||"")+v,!m.message.refusal&&re(this,be,"m",ed).call(this)&&(m.message.parsed=Sy(m.message.content))),k){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:b,id:_,type:C,function:T,...A}of k){const P=(o=m.message.tool_calls)[b]??(o[b]={});Object.assign(P,A),_&&(P.id=_),C&&(P.type=C),T&&(P.function??(P.function={name:T.name??"",arguments:""})),T!=null&&T.name&&(P.function.name=T.name),T!=null&&T.arguments&&(P.function.arguments+=T.arguments,QN(re(this,En,"f"),P)&&(P.function.parsed_arguments=Sy(P.function.arguments)))}}}return l},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new yn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function rP(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:o,...l}=n,a={...l,id:t,choices:r.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new X(`missing finish_reason for choice ${d}`);const{content:p=null,function_call:m,tool_calls:v,...y}=u,g=u.role;if(!g)throw new X(`missing role for choice ${d}`);if(m){const{arguments:w,name:k}=m;if(w==null)throw new X(`missing function_call.arguments for choice ${d}`);if(!k)throw new X(`missing function_call.name for choice ${d}`);return{...h,message:{content:p,function_call:{arguments:w,name:k},role:g,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return v?{...h,index:d,finish_reason:c,logprobs:f,message:{...y,role:g,content:p,refusal:u.refusal??null,tool_calls:v.map((w,k)=>{const{function:S,type:b,id:_,...C}=w,{arguments:T,name:A,...P}=S||{};if(_==null)throw new X(`missing choices[${d}].tool_calls[${k}].id
${Wl(n)}`);if(b==null)throw new X(`missing choices[${d}].tool_calls[${k}].type
${Wl(n)}`);if(A==null)throw new X(`missing choices[${d}].tool_calls[${k}].function.name
${Wl(n)}`);if(T==null)throw new X(`missing choices[${d}].tool_calls[${k}].function.arguments
${Wl(n)}`);return{...C,id:_,type:b,function:{...P,name:A,arguments:T}}})}}:{...h,message:{...y,content:p,role:g,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}};return JN(a,e)}function Wl(n){return JSON.stringify(n)}class ii extends Zo{static fromReadableStream(e){const t=new ii(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new ii(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new ii(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let Gk=class extends ne{parse(e,t){return XN(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>gp(r,e))}runFunctions(e,t){return e.stream?ii.runFunctions(this._client,e,t):Yo.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ii.runTools(this._client,e,t):Yo.runTools(this._client,e,t)}stream(e,t){return Zo.createChatCompletion(this._client,e,t)}};class Rf extends ne{constructor(){super(...arguments),this.completions=new Gk(this._client)}}(function(n){n.Completions=Gk})(Rf||(Rf={}));var F=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},bt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ze,Df,pn,ya,Kt,Hr,qs,$r,au,_t,va,wa,So,ro,so,_y,Cy,Ey,Ty,Oy,My,Ay;class en extends Nk{constructor(){super(...arguments),ze.add(this),Df.set(this,[]),pn.set(this,{}),ya.set(this,{}),Kt.set(this,void 0),Hr.set(this,void 0),qs.set(this,void 0),$r.set(this,void 0),au.set(this,void 0),_t.set(this,void 0),va.set(this,void 0),wa.set(this,void 0),So.set(this,void 0)}[(Df=new WeakMap,pn=new WeakMap,ya=new WeakMap,Kt=new WeakMap,Hr=new WeakMap,qs=new WeakMap,$r=new WeakMap,au=new WeakMap,_t=new WeakMap,va=new WeakMap,wa=new WeakMap,So=new WeakMap,ze=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new en;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=yn.fromReadableStream(e,this.controller);for await(const o of s)F(this,ze,"m",ro).call(this,o);if((i=s.controller.signal)!=null&&i.aborted)throw new Zt;return this._addRun(F(this,ze,"m",so).call(this))}toReadableStream(){return new yn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const o=new en;return o._run(()=>o._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,r,s,i){var u;const o=i==null?void 0:i.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...s,stream:!0},a=await e.submitToolOutputs(t,r,l,{...i,signal:this.controller.signal});this._connected();for await(const c of a)F(this,ze,"m",ro).call(this,c);if((u=a.controller.signal)!=null&&u.aborted)throw new Zt;return this._addRun(F(this,ze,"m",so).call(this))}static createThreadAssistantStream(e,t,r){const s=new en;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new en;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return F(this,va,"f")}currentRun(){return F(this,wa,"f")}currentMessageSnapshot(){return F(this,Kt,"f")}currentRunStepSnapshot(){return F(this,So,"f")}async finalRunSteps(){return await this.done(),Object.values(F(this,pn,"f"))}async finalMessages(){return await this.done(),Object.values(F(this,ya,"f"))}async finalRun(){if(await this.done(),!F(this,Hr,"f"))throw Error("Final run was not received.");return F(this,Hr,"f")}async _createThreadAssistantStream(e,t,r){var l;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},o=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const a of o)F(this,ze,"m",ro).call(this,a);if((l=o.controller.signal)!=null&&l.aborted)throw new Zt;return this._addRun(F(this,ze,"m",so).call(this))}async _createAssistantStream(e,t,r,s){var a;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},l=await e.create(t,o,{...s,signal:this.controller.signal});this._connected();for await(const u of l)F(this,ze,"m",ro).call(this,u);if((a=l.controller.signal)!=null&&a.aborted)throw new Zt;return this._addRun(F(this,ze,"m",so).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Gc(i)&&Gc(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(o=>typeof o=="string"||typeof o=="number")){i.push(...s);continue}for(const o of s){if(!Gc(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const l=o.index;if(l==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof l!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${l}`);const a=i[l];a==null?i.push(o):i[l]=this.accumulateDelta(a,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}ro=function(e){if(!this.ended)switch(bt(this,va,e,"f"),F(this,ze,"m",Ey).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":F(this,ze,"m",Ay).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":F(this,ze,"m",Cy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":F(this,ze,"m",_y).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},so=function(){if(this.ended)throw new X("stream has ended, this shouldn't happen");if(!F(this,Hr,"f"))throw Error("Final run has not been received");return F(this,Hr,"f")},_y=function(e){const[t,r]=F(this,ze,"m",Oy).call(this,e,F(this,Kt,"f"));bt(this,Kt,t,"f"),F(this,ya,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,o=t.content[s.index];if(o&&o.type=="text")this._emit("textDelta",i,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=F(this,qs,"f")){if(F(this,$r,"f"))switch(F(this,$r,"f").type){case"text":this._emit("textDone",F(this,$r,"f").text,F(this,Kt,"f"));break;case"image_file":this._emit("imageFileDone",F(this,$r,"f").image_file,F(this,Kt,"f"));break}bt(this,qs,s.index,"f")}bt(this,$r,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(F(this,qs,"f")!==void 0){const s=e.data.content[F(this,qs,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,F(this,Kt,"f"));break;case"text":this._emit("textDone",s.text,F(this,Kt,"f"));break}}F(this,Kt,"f")&&this._emit("messageDone",e.data),bt(this,Kt,void 0,"f")}},Cy=function(e){const t=F(this,ze,"m",Ty).call(this,e);switch(bt(this,So,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==F(this,au,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(F(this,_t,"f")&&this._emit("toolCallDone",F(this,_t,"f")),bt(this,au,i.index,"f"),bt(this,_t,t.step_details.tool_calls[i.index],"f"),F(this,_t,"f")&&this._emit("toolCallCreated",F(this,_t,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":bt(this,So,void 0,"f"),e.data.step_details.type=="tool_calls"&&F(this,_t,"f")&&(this._emit("toolCallDone",F(this,_t,"f")),bt(this,_t,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Ey=function(e){F(this,Df,"f").push(e),this._emit("event",e)},Ty=function(e){switch(e.event){case"thread.run.step.created":return F(this,pn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=F(this,pn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=en.accumulateDelta(t,r.delta);F(this,pn,"f")[e.data.id]=s}return F(this,pn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":F(this,pn,"f")[e.data.id]=e.data;break}if(F(this,pn,"f")[e.data.id])return F(this,pn,"f")[e.data.id];throw new Error("No snapshot available")},Oy=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let o=t.content[i.index];t.content[i.index]=F(this,ze,"m",My).call(this,i,o)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},My=function(e,t){return en.accumulateDelta(t,e)},Ay=function(e){switch(bt(this,wa,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":bt(this,Hr,e.data,"f"),F(this,_t,"f")&&(this._emit("toolCallDone",F(this,_t,"f")),bt(this,_t,void 0,"f"));break}};class yp extends ne{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return kt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,vp,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class vp extends on{}yp.MessagesPage=vp;class wp extends ne{retrieve(e,t,r,s={},i){return kt(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return kt(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,kp,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class kp extends on{}wp.RunStepsPage=kp;class fl extends ne{constructor(){super(...arguments),this.steps=new wp(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return kt(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,xp,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return en.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:o}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const a=o.headers.get("openai-poll-after-ms");if(a){const u=parseInt(a);isNaN(u)||(l=u)}}await ul(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return en.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return en.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class xp extends on{}fl.RunsPage=xp;fl.Steps=wp;fl.RunStepsPage=kp;class Oi extends ne{constructor(){super(...arguments),this.runs=new fl(this._client),this.messages=new yp(this._client)}create(e={},t){return kt(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return en.createThreadAssistantStream(e,this._client.beta.threads,t)}}Oi.Runs=fl;Oi.RunsPage=xp;Oi.Messages=yp;Oi.MessagesPage=vp;const sP=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Sp=class extends ne{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return kt(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Vu,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),o=i.data;switch(o.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const a=i.response.headers.get("openai-poll-after-ms");if(a){const u=parseInt(a);isNaN(u)||(l=u)}}await ul(l);break;case"failed":case"completed":return o}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class Vu extends on{}Sp.VectorStoreFilesPage=Vu;class Qk extends ne{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return kt(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Vu,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:o}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const a=o.headers.get("openai-poll-after-ms");if(a){const u=parseInt(a);isNaN(u)||(l=u)}}await ul(l);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,o=Math.min(i,t.length),l=this._client,a=t.values(),u=[...r];async function c(f){for(let h of f){const p=await l.files.create({file:h,purpose:"assistants"},s);u.push(p.id)}}const d=Array(o).fill(a).map(c);return await sP(d),await this.createAndPoll(e,{file_ids:u})}}class Mi extends ne{constructor(){super(...arguments),this.files=new Sp(this._client),this.fileBatches=new Qk(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return kt(e)?this.list({},e):this._client.getAPIList("/vector_stores",bp,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class bp extends on{}Mi.VectorStoresPage=bp;Mi.Files=Sp;Mi.VectorStoreFilesPage=Vu;Mi.FileBatches=Qk;class ds extends ne{constructor(){super(...arguments),this.vectorStores=new Mi(this._client),this.chat=new Rf(this._client),this.assistants=new pp(this._client),this.threads=new Oi(this._client)}}ds.VectorStores=Mi;ds.VectorStoresPage=bp;ds.Assistants=pp;ds.AssistantsPage=mp;ds.Threads=Oi;class Xk extends ne{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class Yk extends ne{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class _p extends ne{create(e,t){return this._client.post("/files",xi({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return kt(e)?this.list({},e):this._client.getAPIList("/files",Cp,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let o=await this.retrieve(e);for(;!o.status||!s.has(o.status);)if(await ul(t),o=await this.retrieve(e),Date.now()-i>r)throw new cp({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}}class Cp extends on{}_p.FileObjectsPage=Cp;class Ep extends ne{list(e,t={},r){return kt(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Tp,{query:t,...r})}}class Tp extends on{}Ep.FineTuningJobCheckpointsPage=Tp;class Ai extends ne{constructor(){super(...arguments),this.checkpoints=new Ep(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return kt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Op,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return kt(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Mp,{query:t,...r})}}class Op extends on{}class Mp extends on{}Ai.FineTuningJobsPage=Op;Ai.FineTuningJobEventsPage=Mp;Ai.Checkpoints=Ep;Ai.FineTuningJobCheckpointsPage=Tp;class hl extends ne{constructor(){super(...arguments),this.jobs=new Ai(this._client)}}hl.Jobs=Ai;hl.FineTuningJobsPage=Op;hl.FineTuningJobEventsPage=Mp;class Zk extends ne{createVariation(e,t){return this._client.post("/images/variations",xi({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",xi({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Ap extends ne{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Np,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Np extends qN{}Ap.ModelsPage=Np;class ex extends ne{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class tx extends ne{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,xi({body:t,...r}))}}class Pp extends ne{constructor(){super(...arguments),this.parts=new tx(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Pp.Parts=tx;var nx;class Y extends IN{constructor({baseURL:e=Ul("OPENAI_BASE_URL"),apiKey:t=Ul("OPENAI_API_KEY"),organization:r=Ul("OPENAI_ORG_ID")??null,project:s=Ul("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new X("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&HN())throw new X(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Xk(this),this.chat=new dp(this),this.embeddings=new Yk(this),this.files=new _p(this),this.images=new Zk(this),this.audio=new cl(this),this.moderations=new ex(this),this.models=new Ap(this),this.fineTuning=new hl(this),this.beta=new ds(this),this.batches=new fp(this),this.uploads=new Pp(this),this._options=o,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return gN(e,{arrayFormat:"brackets"})}}nx=Y;Y.OpenAI=nx;Y.DEFAULT_TIMEOUT=6e5;Y.OpenAIError=X;Y.APIError=We;Y.APIConnectionError=zu;Y.APIConnectionTimeoutError=cp;Y.APIUserAbortError=Zt;Y.NotFoundError=ak;Y.ConflictError=uk;Y.RateLimitError=dk;Y.BadRequestError=ik;Y.AuthenticationError=ok;Y.InternalServerError=fk;Y.PermissionDeniedError=lk;Y.UnprocessableEntityError=ck;Y.toFile=vk;Y.fileFromPath=rk;Y.Completions=Xk;Y.Chat=dp;Y.Embeddings=Yk;Y.Files=_p;Y.FileObjectsPage=Cp;Y.Images=Zk;Y.Audio=cl;Y.Moderations=ex;Y.Models=Ap;Y.ModelsPage=Np;Y.FineTuning=hl;Y.Beta=ds;Y.Batches=fp;Y.BatchesPage=hp;Y.Uploads=Pp;let $f=null,ka=null;const iP=()=>{const n="abc",e="https://sociallyshaped.net",t="meta-llama/Llama-3.3-70B-Instruct";console.log("Initializing OpenAI with:"),console.log("API URL:",e),console.log("Model:",t),$f=new Y({apiKey:n,baseURL:e,dangerouslyAllowBrowser:!0}),ka=t},oP=async n=>{var r,s;if(!$f||!ka)throw new Error("OpenAI client or model not initialized");const e=Object.entries(n.sectionInputs).map(([i,o])=>{const l=o.filter(a=>a.trim()!=="");return l.length===0?"":`${i.charAt(0).toUpperCase()+i.slice(1)}:
${l.map(a=>`- ${a}`).join(`
`)}`}).filter(Boolean).join(`

`),t=`You are a professional writer generating a section of a larger document. Important guidelines:

1. This is a SECTION of a larger document, not a standalone piece.
2. DO NOT include a conclusion unless explicitly requested in the prompt.
3. Focus on smooth transitions and maintaining narrative flow.
4. Write approximately ${n.aiPrompt.wordCount} words.
5. Use a ${n.aiPrompt.tone} tone.
6. Base the content on: "${n.input||"the provided context"}"
${e?`
7. Incorporate this information:
${e}`:""}
${n.aiPrompt.prompt?`
8. Additional instructions: ${n.aiPrompt.prompt}`:""}

Remember: This is part of a larger document - focus on content flow and avoid unnecessary wrapping up or concluding statements unless specifically requested. Generate only the requested section content.`;console.log("Generating text with model:",ka),console.log("System Prompt:",t),console.log("User Input:",n.input||"Please generate appropriate content based on the instructions.");try{const i=await $f.chat.completions.create({model:ka,messages:[{role:"system",content:t},{role:"user",content:n.input||"Please generate appropriate content based on the instructions."}],temperature:.7});console.log("OpenAI API Response:",i);const o=(s=(r=i.choices[0])==null?void 0:r.message)==null?void 0:s.content;return o||(console.error("No content received from OpenAI API."),"Error: No content received from API.")}catch(i){return console.error("Error calling OpenAI API:",i),i instanceof Error?`Error generating text: ${i.message}`:"An unknown error occurred while generating text."}},lP="modulepreload",aP=function(n){return"/"+n},Ny={},Si=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(a=>{if(a=aP(a),a in Ny)return;Ny[a]=!0;const u=a.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":lP,u||(d.as="script"),d.crossOrigin="",d.href=a,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,h)=>{d.addEventListener("load",f),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${a}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},uP=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Si(async()=>{const{default:r}=await Promise.resolve().then(()=>Ni);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Ip extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class cP extends Ip{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class dP extends Ip{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class fP extends Ip{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Lf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Lf||(Lf={}));var hP=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};class pP{constructor(e,{headers:t={},customFetch:r,region:s=Lf.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=uP(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return hP(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let l={},{region:a}=t;a||(a=this.region),a&&a!=="any"&&(l["x-region"]=a);let u;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:u}).catch(p=>{throw new cP(p)}),d=c.headers.get("x-relay-error");if(d&&d==="true")throw new dP(c);if(!c.ok)throw new fP(c);let f=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),h;return f==="application/json"?h=yield c.json():f==="application/octet-stream"?h=yield c.blob():f==="text/event-stream"?h=c:f==="multipart/form-data"?h=yield c.formData():h=yield c.text(),{data:h,error:null}}catch(s){return{data:null,error:s}}})}}var ht={},Rp={},Hu={},pl={},Wu={},qu={},mP=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},bi=mP();const gP=bi.fetch,rx=bi.fetch.bind(bi),sx=bi.Headers,yP=bi.Request,vP=bi.Response,Ni=Object.freeze(Object.defineProperty({__proto__:null,Headers:sx,Request:yP,Response:vP,default:rx,fetch:gP},Symbol.toStringTag,{value:"Module"})),wP=Px(Ni);var Ju={};Object.defineProperty(Ju,"__esModule",{value:!0});let kP=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ju.default=kP;var ix=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qu,"__esModule",{value:!0});const xP=ix(wP),SP=ix(Ju);let bP=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=xP.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,a;let u=null,c=null,d=null,f=i.status,h=i.statusText;if(i.ok){if(this.method!=="HEAD"){const y=await i.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=y:c=JSON.parse(y))}const m=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");m&&v&&v.length>1&&(d=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(u={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,d=null,f=406,h="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const m=await i.text();try{u=JSON.parse(m),Array.isArray(u)&&i.status===404&&(c=[],u=null,f=200,h="OK")}catch{i.status===404&&m===""?(f=204,h="No Content"):u={message:m}}if(u&&this.isMaybeSingle&&(!((a=u==null?void 0:u.details)===null||a===void 0)&&a.includes("0 rows"))&&(u=null,f=200,h="OK"),u&&this.shouldThrowOnError)throw new SP.default(u)}return{error:u,data:c,count:d,status:f,statusText:h}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,l,a;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(a=i==null?void 0:i.code)!==null&&a!==void 0?a:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};qu.default=bP;var _P=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wu,"__esModule",{value:!0});const CP=_P(qu);let EP=class extends CP.default{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const i=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){var l;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Wu.default=EP;var TP=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pl,"__esModule",{value:!0});const OP=TP(Wu);let MP=class extends OP.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};pl.default=MP;var AP=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hu,"__esModule",{value:!0});const Hi=AP(pl);let NP=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new Hi.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((l,a)=>l.concat(Object.keys(a)),[]);if(o.length>0){const l=[...new Set(o)].map(a=>`"${a}"`);this.url.searchParams.set("columns",l.join(","))}}return new Hi.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),s&&l.push(`count=${s}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const a=e.reduce((u,c)=>u.concat(Object.keys(c)),[]);if(a.length>0){const u=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",u.join(","))}}return new Hi.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Hi.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Hi.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Hu.default=NP;var Ku={},Gu={};Object.defineProperty(Gu,"__esModule",{value:!0});Gu.version=void 0;Gu.version="0.0.0-automated";Object.defineProperty(Ku,"__esModule",{value:!0});Ku.DEFAULT_HEADERS=void 0;const PP=Gu;Ku.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${PP.version}`};var ox=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rp,"__esModule",{value:!0});const IP=ox(Hu),RP=ox(pl),DP=Ku;let $P=class lx{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},DP.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new IP.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new lx(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){let o;const l=new URL(`${this.url}/rpc/${e}`);let a;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([c,d])=>d!==void 0).map(([c,d])=>[c,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([c,d])=>{l.searchParams.append(c,d)})):(o="POST",a=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new RP.default({method:o,url:l,headers:u,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};Rp.default=$P;var Pi=Ut&&Ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ht,"__esModule",{value:!0});ht.PostgrestError=ht.PostgrestBuilder=ht.PostgrestTransformBuilder=ht.PostgrestFilterBuilder=ht.PostgrestQueryBuilder=ht.PostgrestClient=void 0;const ax=Pi(Rp);ht.PostgrestClient=ax.default;const ux=Pi(Hu);ht.PostgrestQueryBuilder=ux.default;const cx=Pi(pl);ht.PostgrestFilterBuilder=cx.default;const dx=Pi(Wu);ht.PostgrestTransformBuilder=dx.default;const fx=Pi(qu);ht.PostgrestBuilder=fx.default;const hx=Pi(Ju);ht.PostgrestError=hx.default;var LP=ht.default={PostgrestClient:ax.default,PostgrestQueryBuilder:ux.default,PostgrestFilterBuilder:cx.default,PostgrestTransformBuilder:dx.default,PostgrestBuilder:fx.default,PostgrestError:hx.default};const{PostgrestClient:jP,PostgrestQueryBuilder:FR,PostgrestFilterBuilder:zR,PostgrestTransformBuilder:BR,PostgrestBuilder:UR,PostgrestError:VR}=LP,FP="2.11.2",zP={"X-Client-Info":`realtime-js/${FP}`},BP="1.0.0",px=1e4,UP=1e3;var oi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(oi||(oi={}));var Ct;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Ct||(Ct={}));var Qt;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Qt||(Qt={}));var jf;(function(n){n.websocket="websocket"})(jf||(jf={}));var Lr;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Lr||(Lr={}));class VP{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(e.slice(o,o+s));o=o+s;const a=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:a,payload:u}}}class mx{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ie;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ie||(ie={}));const Py=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=HP(o,n,e,s),i),{})},HP=(n,e,t,r)=>{const s=e.find(l=>l.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?gx(i,o):Ff(o)},gx=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return KP(e,t)}switch(n){case ie.bool:return WP(e);case ie.float4:case ie.float8:case ie.int2:case ie.int4:case ie.int8:case ie.numeric:case ie.oid:return qP(e);case ie.json:case ie.jsonb:return JP(e);case ie.timestamp:return GP(e);case ie.abstime:case ie.date:case ie.daterange:case ie.int4range:case ie.int8range:case ie.money:case ie.reltime:case ie.text:case ie.time:case ie.timestamptz:case ie.timetz:case ie.tsrange:case ie.tstzrange:return Ff(e);default:return Ff(e)}},Ff=n=>n,WP=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},qP=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},JP=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},KP=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>gx(e,l))}return n},GP=n=>typeof n=="string"?n.replace(" ","T"):n,yx=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class td{constructor(e,t,r={},s=px){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Iy;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Iy||(Iy={}));class bo{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=bo.syncState(this.state,s,i,o),this.pendingDiffs.forEach(a=>{this.state=bo.syncDiff(this.state,a,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=bo.syncDiff(this.state,s,i,o),l())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),l={},a={};return this.map(i,(u,c)=>{o[u]||(a[u]=c)}),this.map(o,(u,c)=>{const d=i[u];if(d){const f=c.map(v=>v.presence_ref),h=d.map(v=>v.presence_ref),p=c.filter(v=>h.indexOf(v.presence_ref)<0),m=d.filter(v=>f.indexOf(v.presence_ref)<0);p.length>0&&(l[u]=p),m.length>0&&(a[u]=m)}else l[u]=c}),this.syncDiff(i,{joins:l,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(l,a)=>{var u;const c=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(a),c.length>0){const d=e[l].map(h=>h.presence_ref),f=c.filter(h=>d.indexOf(h.presence_ref)<0);e[l].unshift(...f)}r(l,c,a)}),this.map(o,(l,a)=>{let u=e[l];if(!u)return;const c=a.map(d=>d.presence_ref);u=u.filter(d=>c.indexOf(d.presence_ref)<0),e[l]=u,s(l,u,a),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ry;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ry||(Ry={}));var Dy;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Dy||(Dy={}));var An;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(An||(An={}));class Dp{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=Ct.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new td(this,Qt.join,this.params,this.timeout),this.rejoinTimer=new mx(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ct.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ct.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Ct.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ct.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qt.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new bo(this),this.broadcastEndpointURL=yx(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:l}}=this.params;this._onError(c=>e==null?void 0:e(An.CHANNEL_ERROR,c)),this._onClose(()=>e==null?void 0:e(An.CLOSED));const a={},u={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&s!==void 0?s:[],private:l};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var d;if(this.socket.setAuth(),c===void 0){e==null||e(An.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,h=(d=f==null?void 0:f.length)!==null&&d!==void 0?d:0,p=[];for(let m=0;m<h;m++){const v=f[m],{filter:{event:y,schema:g,table:w,filter:k}}=v,S=c&&c[m];if(S&&S.event===y&&S.schema===g&&S.table===w&&S.filter===k)p.push(Object.assign(Object.assign({},v),{id:S.id}));else{this.unsubscribe(),e==null||e(An.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(An.SUBSCRIBED);return}}).receive("error",c=>{e==null||e(An.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(An.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,a;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((a=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||a===void 0)&&a.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ct.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qt.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new td(this,Qt.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new td(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:l,error:a,leave:u,join:c}=Qt;if(r&&[l,a,u,c].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(h=>{var p,m,v;return((p=h.filter)===null||p===void 0?void 0:p.event)==="*"||((v=(m=h.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(h=>h.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(h=>{var p,m,v,y,g,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in h){const k=h.id,S=(p=h.filter)===null||p===void 0?void 0:p.event;return k&&((m=t.ids)===null||m===void 0?void 0:m.includes(k))&&(S==="*"||(S==null?void 0:S.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const k=(g=(y=h==null?void 0:h.filter)===null||y===void 0?void 0:y.event)===null||g===void 0?void 0:g.toLocaleLowerCase();return k==="*"||k===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===o}).map(h=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:v,commit_timestamp:y,type:g,errors:w}=p;f=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:y,eventType:g,new:{},old:{},errors:w}),this._getPayloadRecords(p))}h.callback(f,r)})}_isClosed(){return this.state===Ct.closed}_isJoined(){return this.state===Ct.joined}_isJoining(){return this.state===Ct.joining}_isLeaving(){return this.state===Ct.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Dp.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Qt.close,{},e)}_onError(e){this._on(Qt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ct.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Py(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Py(e.columns,e.old_record)),t}}const QP=()=>{},XP=typeof WebSocket<"u",YP=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ZP{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=zP,this.params={},this.timeout=px,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=QP,this.conn=null,this.sendBuffer=[],this.serializer=new VP,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...l)=>Si(async()=>{const{default:a}=await Promise.resolve().then(()=>Ni);return{default:a}},void 0).then(({default:a})=>a(...l)):o=fetch,(...l)=>o(...l)},this.endPoint=`${e}/${jf.websocket}`,this.httpEndpoint=yx(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mx(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(XP){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new eI(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Si(async()=>{const{default:e}=await import("./browser-BR_97WAG.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:BP}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case oi.connecting:return Lr.Connecting;case oi.open:return Lr.Open;case oi.closing:return Lr.Closing;default:return Lr.Closed}}isConnected(){return this.connectionState()===Lr.Open}channel(e,t={config:{}}){const r=new Dp(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,l=>{var a;(a=this.conn)===null||a===void 0||a.send(l)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let r=null;try{r=JSON.parse(atob(t.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(Qt.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(UP,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Qt.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([YP],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class eI{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=oi.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class $p extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Me(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class tI extends $p{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class zf extends $p{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var nI=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};const vx=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Si(async()=>{const{default:r}=await Promise.resolve().then(()=>Ni);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},rI=()=>nI(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Si(()=>Promise.resolve().then(()=>Ni),void 0)).Response:Response}),Bf=n=>{if(Array.isArray(n))return n.map(t=>Bf(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Bf(r)}),e};var fs=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};const nd=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),sI=(n,e,t)=>fs(void 0,void 0,void 0,function*(){const r=yield rI();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{e(new tI(nd(s),n.status||500))}).catch(s=>{e(new zf(nd(s),s))}):e(new zf(nd(n),n))}),iI=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function ml(n,e,t,r,s,i){return fs(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,iI(e,r,s,i)).then(a=>{if(!a.ok)throw a;return r!=null&&r.noResolveJson?a:a.json()}).then(a=>o(a)).catch(a=>sI(a,l,r))})})}function uu(n,e,t,r){return fs(this,void 0,void 0,function*(){return ml(n,"GET",e,t,r)})}function Yn(n,e,t,r,s){return fs(this,void 0,void 0,function*(){return ml(n,"POST",e,r,s,t)})}function oI(n,e,t,r,s){return fs(this,void 0,void 0,function*(){return ml(n,"PUT",e,r,s,t)})}function lI(n,e,t,r){return fs(this,void 0,void 0,function*(){return ml(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function wx(n,e,t,r,s){return fs(this,void 0,void 0,function*(){return ml(n,"DELETE",e,r,s,t)})}var ct=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};const aI={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$y={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class uI{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=vx(s)}uploadOrUpdate(e,t,r,s){return ct(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},$y),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const a=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,a&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const u=this._removeEmptyFolders(t),c=this._getFinalPath(u),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield d.json();return d.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(Me(i))return{data:null,error:i};throw i}})}upload(e,t,r){return ct(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return ct(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let a;const u=Object.assign({upsert:$y.upsert},s),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",u.cacheControl),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.append("cacheControl",u.cacheControl)):(a=r,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const d=yield this.fetch(l.toString(),{method:"PUT",body:a,headers:c}),f=yield d.json();return d.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(a){if(Me(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return ct(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield Yn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new $p("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(r){if(Me(r))return{data:null,error:r};throw r}})}update(e,t,r){return ct(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return ct(this,void 0,void 0,function*(){try{return{data:yield Yn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Me(s))return{data:null,error:s};throw s}})}copy(e,t,r){return ct(this,void 0,void 0,function*(){try{return{data:{path:(yield Yn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Me(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return ct(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Yn(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(Me(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return ct(this,void 0,void 0,function*(){try{const s=yield Yn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(Me(s))return{data:null,error:s};throw s}})}download(e,t){return ct(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield uu(this.fetch,`${this.url}/${s}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(Me(l))return{data:null,error:l};throw l}})}info(e){return ct(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield uu(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Bf(r),error:null}}catch(r){if(Me(r))return{data:null,error:r};throw r}})}exists(e){return ct(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield lI(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Me(r)&&r instanceof zf){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});a!==""&&s.push(a);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${u}`)}}}remove(e){return ct(this,void 0,void 0,function*(){try{return{data:yield wx(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}})}list(e,t,r){return ct(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},aI),t),{prefix:e||""});return{data:yield Yn(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Me(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const cI="2.7.1",dI={"X-Client-Info":`storage-js/${cI}`};var _s=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};class fI{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},dI),t),this.fetch=vx(r)}listBuckets(){return _s(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Me(e))return{data:null,error:e};throw e}})}getBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield uu(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return _s(this,void 0,void 0,function*(){try{return{data:yield Yn(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Me(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return _s(this,void 0,void 0,function*(){try{return{data:yield oI(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Me(r))return{data:null,error:r};throw r}})}emptyBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield Yn(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield wx(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Me(t))return{data:null,error:t};throw t}})}}class hI extends fI{constructor(e,t={},r){super(e,t,r)}from(e){return new uI(this.url,this.headers,e,this.fetch)}}const pI="2.49.4";let io="";typeof Deno<"u"?io="deno":typeof document<"u"?io="web":typeof navigator<"u"&&navigator.product==="ReactNative"?io="react-native":io="node";const mI={"X-Client-Info":`supabase-js-${io}/${pI}`},gI={headers:mI},yI={schema:"public"},vI={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wI={};var kI=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};const xI=n=>{let e;return n?e=n:typeof fetch>"u"?e=rx:e=fetch,(...t)=>e(...t)},SI=()=>typeof Headers>"u"?sx:Headers,bI=(n,e,t)=>{const r=xI(t),s=SI();return(i,o)=>kI(void 0,void 0,void 0,function*(){var l;const a=(l=yield e())!==null&&l!==void 0?l:n;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${a}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var _I=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};function CI(n){return n.replace(/\/$/,"")}function EI(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:l,realtime:a,global:u}=e,c={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},l),r),realtime:Object.assign(Object.assign({},a),s),global:Object.assign(Object.assign({},u),i),accessToken:()=>_I(this,void 0,void 0,function*(){return""})};return n.accessToken?c.accessToken=n.accessToken:delete c.accessToken,c}const kx="2.69.1",Ns=30*1e3,Uf=3,rd=Uf*Ns,TI="http://localhost:9999",OI="supabase.auth.token",MI={"X-Client-Info":`gotrue-js/${kx}`},Vf="X-Supabase-Api-Version",xx={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},AI=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,NI=6e5;class Lp extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function H(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class PI extends Lp{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function II(n){return H(n)&&n.name==="AuthApiError"}class Sx extends Lp{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Mr extends Lp{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class qn extends Mr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function RI(n){return H(n)&&n.name==="AuthSessionMissingError"}class sd extends Mr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ql extends Mr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Jl extends Mr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function DI(n){return H(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ly extends Mr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Hf extends Mr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function id(n){return H(n)&&n.name==="AuthRetryableFetchError"}class jy extends Mr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class _o extends Mr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Fy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),zy=` 	
\r=`.split(""),$I=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<zy.length;e+=1)n[zy[e].charCodeAt(0)]=-2;for(let e=0;e<Fy.length;e+=1)n[Fy[e].charCodeAt(0)]=e;return n})();function bx(n,e,t){const r=$I[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function By(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{FI(o,r,t)};for(let o=0;o<n.length;o+=1)bx(n.charCodeAt(o),s,i);return e.join("")}function LI(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function jI(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}LI(r,e)}}function FI(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function zI(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)bx(n.charCodeAt(s),t,r);return new Uint8Array(e)}function BI(n){const e=[];return jI(n,t=>e.push(t)),new Uint8Array(e)}function UI(n){return Math.round(Date.now()/1e3)+n}function VI(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const cn=()=>typeof window<"u"&&typeof document<"u",Ar={tested:!1,writable:!1},Co=()=>{if(!cn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ar.tested)return Ar.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ar.tested=!0,Ar.writable=!0}catch{Ar.tested=!0,Ar.writable=!1}return Ar.writable};function HI(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const _x=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Si(async()=>{const{default:r}=await Promise.resolve().then(()=>Ni);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},WI=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Cx=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Kl=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Gl=async(n,e)=>{await n.removeItem(e)};class Qu{constructor(){this.promise=new Qu.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Qu.promiseConstructor=Promise;function od(n){const e=n.split(".");if(e.length!==3)throw new _o("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!AI.test(e[r]))throw new _o("JWT not in base64url format");return{header:JSON.parse(By(e[0])),payload:JSON.parse(By(e[1])),signature:zI(e[2]),raw:{header:e[0],payload:e[1]}}}async function qI(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function JI(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function KI(n){return("0"+n.toString(16)).substr(-2)}function GI(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,KI).join("")}async function QI(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function XI(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await QI(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Cs(n,e,t=!1){const r=GI();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Cx(n,`${e}-code-verifier`,s);const i=await XI(r);return[i,r===i?"plain":"s256"]}const YI=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ZI(n){const e=n.headers.get(Vf);if(!e||!e.match(YI))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function eR(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function tR(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var nR=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Ir=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),rR=[502,503,504];async function Uy(n){var e;if(!WI(n))throw new Hf(Ir(n),0);if(rR.includes(n.status))throw new Hf(Ir(n),n.status);let t;try{t=await n.json()}catch(i){throw new Sx(Ir(i),i)}let r;const s=ZI(n);if(s&&s.getTime()>=xx["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new jy(Ir(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new qn}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new jy(Ir(t),n.status,t.weak_password.reasons);throw new PI(Ir(t),n.status||500,r)}const sR=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function Q(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[Vf]||(i[Vf]=xx["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",a=await iR(n,e,t+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(a):{data:Object.assign({},a),error:null}}async function iR(n,e,t,r,s,i){const o=sR(e,r,s,i);let l;try{l=await n(t,Object.assign({},o))}catch(a){throw console.error(a),new Hf(Ir(a),0)}if(l.ok||await Uy(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(a){await Uy(a)}}function Jn(n){var e;let t=null;uR(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=UI(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Vy(n){const e=Jn(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function nr(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function oR(n){return{data:n,error:null}}function lR(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=nR(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},a=Object.assign({},o);return{data:{properties:l,user:a},error:null}}function aR(n){return n}function uR(n){return n.access_token&&n.refresh_token&&n.expires_in}var cR=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class dR{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=_x(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Q(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Q(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:nr})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=cR(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await Q(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:lR,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(H(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Q(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:nr})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,l,a;try{const u={nextPage:null,lastPage:0,total:0},c=await Q(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:aR});if(c.error)throw c.error;const d=await c.json(),f=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(a=(l=c.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&a!==void 0?a:[];return h.length>0&&(h.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(p.split(";")[1].split("=")[1]);u[`${v}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(H(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await Q(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:nr})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Q(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:nr})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await Q(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:nr})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await Q(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(H(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Q(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}}const fR={getItem:n=>Co()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Co()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Co()&&globalThis.localStorage.removeItem(n)}};function Hy(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function hR(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Es={debug:!!(globalThis&&Co()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ex extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class pR extends Ex{}async function mR(n,e,t){Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Es.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new pR(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Es.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}hR();const gR={url:TI,storageKey:OI,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:MI,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Wy(n,e,t){return await t()}class el{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=el.nextInstanceID,el.nextInstanceID+=1,this.instanceID>0&&cn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},gR),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new dR({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=_x(s.fetch),this.lock=s.lock||Wy,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:cn()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=mR:this.lock=Wy,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Co()?this.storage=fR:(this.memoryStorage={},this.storage=Hy(this.memoryStorage)):(this.memoryStorage={},this.storage=Hy(this.memoryStorage)),cn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${kx}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=HI(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),cn()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),DI(i)){const a=(e=i.details)===null||e===void 0?void 0:e.code;if(a==="identity_already_exists"||a==="identity_not_found"||a==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return H(t)?{error:t}:{error:new Sx("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await Q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Jn}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:u,session:a},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:c,password:d,options:f}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await Cs(this.storage,this.storageKey)),i=await Q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:c,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:p},xform:Jn})}else if("phone"in e){const{phone:c,password:d,options:f}=e;i=await Q(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Jn})}else throw new ql("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const a=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:u,session:a},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await Q(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Vy})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await Q(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Vy})}else throw new ql("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new sd}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Kl(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await Q(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Jn});if(await Gl(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new sd}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(H(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,l=await Q(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Jn}),{data:a,error:u}=l;return u?{data:{user:null,session:null},error:u}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new sd}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:u})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:l,options:a}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Cs(this.storage,this.storageKey));const{error:d}=await Q(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=a==null?void 0:a.data)!==null&&t!==void 0?t:{},create_user:(r=a==null?void 0:a.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:a==null?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:l,options:a}=e,{data:u,error:c}=await Q(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=a==null?void 0:a.data)!==null&&s!==void 0?s:{},create_user:(i=a==null?void 0:a.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken},channel:(o=a==null?void 0:a.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:c}}throw new ql("You must provide either an email or phone number.")}catch(l){if(H(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await Q(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Jn});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const a=o.session,u=o.user;return a!=null&&a.access_token&&(await this._saveSession(a),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:u,session:a},error:null}}catch(s){if(H(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await Cs(this.storage,this.storageKey)),await Q(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:oR})}catch(i){if(H(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new qn;const{error:s}=await Q(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(H(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await Q(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:l}=await Q(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new ql("You must provide either an email or phone number and a type")}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Kl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<rd:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(a,u,c)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,u,c))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Q(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:nr}):await this._useSession(async t=>{var r,s,i;const{data:o,error:l}=t;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new qn}:await Q(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:nr})})}catch(t){if(H(t))return RI(t)&&(await this._removeSession(),await Gl(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new qn;const o=s.session;let l=null,a=null;this.flowType==="pkce"&&e.email!=null&&([l,a]=await Cs(this.storage,this.storageKey));const{data:u,error:c}=await Q(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:a}),jwt:o.access_token,xform:nr});if(c)throw c;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new qn;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=od(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:l,error:a}=await this._callRefreshToken(e.refresh_token);if(a)return{data:{user:null,session:null},error:a};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:a}=await this._getUser(e.access_token);if(a)throw a;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(H(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new qn;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!cn())throw new Jl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Jl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ly("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Jl("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ly("No code detected.");const{data:g,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:g.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:l,expires_at:a,token_type:u}=e;if(!i||!l||!o||!u)throw new Jl("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(l);let f=c+d;a&&(f=parseInt(a));const h=f-c;h*1e3<=Ns&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const p=f-d;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,c);const{data:m,error:v}=await this._getUser(i);if(v)throw v;const y={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(r){if(H(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Kl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(II(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Gl(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=VI(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await Cs(this.storage,this.storageKey,!0));try{return await Q(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(H(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,l,a,u,c;const{data:d,error:f}=i;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:!0});return await Q(this.fetch,"GET",h,{headers:this.headers,jwt:(c=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(s)throw s;return cn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(H(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await Q(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await JI(async s=>(s>0&&await qI(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Q(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Jn})),(s,i)=>{const o=200*Math.pow(2,s);return i&&id(i)&&Date.now()+o-r<Ns})}catch(r){if(this._debug(t,"error",r),H(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),cn()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Kl(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<rd;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${rd}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),id(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new qn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Qu;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new qn;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(s,"error",i),H(i)){const o={session:null,error:i};return id(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(a){i.push(a)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Cx(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Gl(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&cn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ns);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ns);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ns}ms, refresh threshold is ${Uf} ticks`),s<=Uf&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ex)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!cn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await Cs(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await Q(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:u}=await Q(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=a==null?void 0:a.totp)===null||s===void 0)&&s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await Q(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await Q(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=od(s.access_token);let l=null;o.aal&&(l=o.aal);let a=l;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const c=o.amr||[];return{data:{currentLevel:l,nextLevel:a,currentAuthenticationMethods:c},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+NI>Date.now()))return r;const{data:s,error:i}=await Q(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new _o("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new _o("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:h,error:p}=await this.getSession();if(p||!h.session)return{data:null,error:p};r=h.session.access_token}const{header:s,payload:i,signature:o,raw:{header:l,payload:a}}=od(r);if(eR(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:h}=await this.getUser(r);if(h)throw h;return{data:{claims:i,header:s,signature:o},error:null}}const u=tR(s.alg),c=await this.fetchJwk(s.kid,t),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,BI(`${l}.${a}`)))throw new _o("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}}el.nextInstanceID=0;const yR=el;class vR extends yR{constructor(e){super(e)}}var wR=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(c){try{u(r.next(c))}catch(d){o(d)}}function a(c){try{u(r.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):s(c.value).then(l,a)}u((r=r.apply(n,e||[])).next())})};class kR{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=CI(e);this.realtimeUrl=`${l}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${l}/auth/v1`,this.storageUrl=`${l}/storage/v1`,this.functionsUrl=`${l}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:yI,realtime:wI,auth:Object.assign(Object.assign({},vI),{storageKey:a}),global:gI},c=EI(r??{},u);this.storageKey=(s=c.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=c.auth)!==null&&o!==void 0?o:{},this.headers,c.global.fetch),this.fetch=bI(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new jP(`${l}/rest/v1`,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new pP(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new hI(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return wR(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:l,debug:a},u,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new vR({url:this.authUrl,headers:Object.assign(Object.assign({},d),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:l,debug:a,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ZP(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const xR=(n,e,t)=>new kR(n,e,t),SR=async()=>{};function bR({appId:n,initialize:e=SR}={}){const[t,r]=z.useState(null),[s,i]=z.useState(null),[o,l]=z.useState(!0),[a,u]=z.useState(!1);return z.useEffect(()=>{async function c(){try{const d=new URLSearchParams(window.location.search),f=d.get("supabaseUrl"),h=d.get("supabaseKey"),p=d.get("accessToken"),m=d.get("refreshToken");if(!f||!h||!p||!m)throw new Error("Missing required URL parameters: supabaseUrl, supabaseKey, accessToken, or refreshToken");const v=xR(f,h);await v.auth.setSession({access_token:p,refresh_token:m});const{data:y,error:g}=await v.from("app_installations").select("initialized").eq("app_id",appID).single();if(g&&g.code!=="PGRST116")throw g;if((y==null?void 0:y.initialized)||!1)u(!0);else{await e(v);const{error:k}=await v.from("app_installations").upsert({app_id:n,initialized:!0},{onConflict:"app_id"});if(k)throw k;u(!0)}r(v)}catch(d){i(d)}finally{l(!1)}}c()},[n,e]),{supabase:t,error:s,loading:o,isInitialized:a}}function Ql(n,e){try{const t=window.localStorage.getItem(n);return t?JSON.parse(t):e}catch(t){return console.error(`Error reading localStorage key ${n}:`,t),e}}function Wi(n,e){try{window.localStorage.setItem(n,JSON.stringify(e))}catch(t){console.error(`Error setting localStorage key ${n}:`,t)}}const _R=n=>({id:n.id,title:n.title,rows:n.rows,createdAt:n.created_at,updatedAt:n.updated_at}),un=(n=Date.now().toString(),e="",t="")=>({id:n,title:t||`Section ${n.substring(0,4)}`,input:e,aiPrompt:{wordCount:100,tone:"professional",prompt:""},output:"",isExpanded:!0,isLoading:!1,sectionInputs:{facts:[""],concepts:[""],opinions:[""],examples:[""],other:[""]},expandedInputs:{facts:!1,concepts:!1,opinions:!1,examples:!1,other:!1}}),qy="document-rows",Jy="saved-documents",ld="current-document-id";function CR(){const[n,e]=z.useState(()=>Ql("theme","dark")),[t,r]=z.useState(!1),[s,i]=z.useState(!1),[o,l]=z.useState("loading"),[a,u]=z.useState(null),[c,d]=z.useState([un()]),[f,h]=z.useState([]),[p,m]=z.useState(null),[v,y]=z.useState(!1),[g,w]=z.useState(null),{supabase:k,error:S,loading:b,isInitialized:_}=bR({appId:"business-writer"});z.useEffect(()=>{try{iP(),y(!0),w(null),console.log("OpenAI initialized successfully.")}catch(M){console.error("Failed to initialize OpenAI:",M),w(M instanceof Error?M.message:"An unknown error occurred during OpenAI initialization."),y(!1)}},[]);const C=M=>{e(M),Wi("theme",M),M==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};z.useEffect(()=>{n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[n]);const T=z.useCallback(async M=>{console.log("Attempting to load data from Supabase..."),l("loading");try{const{data:D,error:j}=await M.auth.getUser();if(j||!(D!=null&&D.user))throw j||new Error("User not authenticated.");const{data:$,error:J}=await M.from("documents").select("*").order("updated_at",{ascending:!1});if(J)throw J;console.log("Successfully loaded documents from Supabase:",$);const Se=$.map(_R);h(Se),d([un()]),m(null),l("supabase"),u(null)}catch(D){console.error("Error loading data from Supabase:",D),u(`Failed to load data from Supabase: ${D instanceof Error?D.message:String(D)}`),l("error")}},[]),A=z.useCallback(()=>{console.log("Supabase connection failed or unavailable. Loading data from LocalStorage..."),l("loading");try{const M=Ql(qy,[un()]),D=Ql(Jy,[]),j=Ql(ld,null);if(d(M),h(D),m(j),j){const $=D.find(J=>J.id===j);$?d($.rows):(m(null),d([un()]),Wi(ld,null))}else(M.length===0||M.length===1&&!M[0].input&&!M[0].output)&&d([un()]);console.log("Loaded data from LocalStorage."),l("local"),u(null)}catch(M){console.error("Error loading data from LocalStorage:",M),u(`Failed to load data from LocalStorage: ${M instanceof Error?M.message:String(M)}`),l("error")}},[]);z.useEffect(()=>{if(b){l("loading");return}k&&_?T(k):(S?(console.warn("Supabase SDK Error:",S.message),u(`Supabase SDK Error: ${S.message}. Falling back to local storage.`)):(console.warn("Supabase client not available or not initialized. Falling back to local storage."),u("Supabase connection unavailable. Using local storage.")),A())},[k,b,S,_]);const P=z.useCallback(()=>{console.log("Saving state to LocalStorage..."),Wi(qy,c),Wi(Jy,f),Wi(ld,p)},[c,f,p]);z.useEffect(()=>{o==="local"&&P()},[o,P]);const ye=()=>{const M=un();d(D=>[...D,M])},Le=M=>{c.length>1&&d(D=>D.filter(j=>j.id!==M))},hs=(M,D)=>{d(j=>j.map($=>$.id===M?{...$,title:D}:$))},ps=(M,D)=>{d(j=>j.map($=>$.id===M?{...$,input:D}:$))},Ii=(M,D,j)=>{d($=>$.map(J=>J.id===M?{...J,aiPrompt:{...J.aiPrompt,[D]:j}}:J))},ms=(M,D)=>{d(j=>j.map($=>$.id===M?{...$,output:D}:$))},I=M=>{d(M)},V=M=>{d(D=>D.map(j=>j.id===M?{...j,isExpanded:!j.isExpanded}:j))},q=(M,D)=>{d(j=>j.map($=>$.id===M?{...$,expandedInputs:{...$.expandedInputs,[D]:!$.expandedInputs[D]}}:$))},ce=(M,D,j,$)=>{d(J=>J.map(Se=>Se.id===M?{...Se,sectionInputs:{...Se.sectionInputs,[D]:Se.sectionInputs[D].map((St,tt)=>tt===j?$:St)}}:Se))},we=(M,D)=>{d(j=>j.map($=>$.id===M?{...$,sectionInputs:{...$.sectionInputs,[D]:[...$.sectionInputs[D],""]}}:$))},gs=(M,D,j)=>{d($=>$.map(J=>J.id===M?{...J,sectionInputs:{...J.sectionInputs,[D]:J.sectionInputs[D].filter((Se,St)=>St!==j)}}:J))},bn=async M=>{if(!v){d(j=>j.map($=>$.id===M?{...$,error:"OpenAI client not initialized.",isLoading:!1}:$));return}const D=c.find(j=>j.id===M);if(D){d(j=>j.map($=>$.id===M?{...$,isLoading:!0,error:void 0}:$));try{const j=await oP(D);d($=>$.map(J=>J.id===M?{...J,output:j,isLoading:!1}:J))}catch(j){console.error("Error in handleGenerateText:",j),d($=>$.map(J=>J.id===M?{...J,error:j instanceof Error?j.message:"An unknown error occurred",isLoading:!1}:J))}}},Ri=M=>{d(D=>{const j=D[D.length-1];if(j&&!j.input.trim())return D.map(($,J)=>J===D.length-1?{...$,input:M}:$);{const $=un(Date.now().toString(),M);return[...D,$]}})},_n=async M=>{const D=M.trim();if(D)if(o==="supabase"&&k){l("loading");try{const{data:{user:j},error:$}=await k.auth.getUser();if($||!j)throw $||new Error("User not authenticated.");const J={user_id:j.id,title:D,rows:c};let Se=null;if(p){const{data:St,error:tt}=await k.from("documents").update(J).eq("id",p).select().single();if(tt)throw tt;Se=St,console.log("Document updated in Supabase:",Se)}else{const{data:St,error:tt}=await k.from("documents").insert(J).select().single();if(tt)throw tt;Se=St,m(Se.id),console.log("Document created in Supabase:",Se)}await T(k),i(!1)}catch(j){console.error("Error saving document to Supabase:",j),u(j instanceof Error?j.message:"Failed to save document to Supabase."),l("error")}}else if(o==="local"){const j=new Date().toISOString();let $=p;h(J=>{const Se=p?J.findIndex(tt=>tt.id===p):-1;let St;if(Se>-1)St=[...J],St[Se]={...J[Se],title:D,rows:c,updatedAt:j},console.log("Document updated in LocalStorage:",St[Se]);else{const tt={id:Date.now().toString(),title:D,rows:c,createdAt:j,updatedAt:j};$=tt.id,St=[...J,tt],console.log("Document created in LocalStorage:",tt)}return St.sort((tt,Nx)=>new Date(Nx.updatedAt).getTime()-new Date(tt.updatedAt).getTime())}),$!==p&&m($),i(!1)}else u("Cannot save document. Application is not in a valid state.")},ys=M=>{d(M.rows),m(M.id),i(!1)},Tx=async M=>{if(o==="supabase"&&k){l("loading");try{const{error:D}=await k.from("documents").delete().eq("id",M);if(D)throw D;console.log("Document deleted from Supabase:",M),p===M&&(m(null),d([un()])),await T(k)}catch(D){console.error("Error deleting document from Supabase:",D),u(D instanceof Error?D.message:"Failed to delete document from Supabase."),l("error")}}else o==="local"?(h(D=>D.filter(j=>j.id!==M)),p===M&&(m(null),d([un()]))):u("Cannot delete document. Application is not in a valid state.")},Ox=()=>{m(null),d([un()])},Mx=()=>o==="loading"?x.jsx("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50",children:x.jsx(Gm,{className:"w-12 h-12 text-blue-500 animate-spin"})}):a&&o==="error"?x.jsx("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50 flex items-center justify-between",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx(ua,{className:"w-5 h-5 mr-2 text-red-600"}),x.jsxs("span",{children:["Error: ",a]})]})}):g?x.jsxs("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded shadow-lg z-50 flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center",children:[x.jsx(ua,{className:"w-5 h-5 mr-2 text-yellow-600"}),x.jsxs("span",{children:["OpenAI Error: ",g]})]}),x.jsx("button",{onClick:()=>w(null),className:"ml-4 text-yellow-700 hover:text-yellow-900",children:x.jsx(Eu,{className:"w-5 h-5"})})]}):null,Ax=()=>{let M=Gm,D="Loading...",j="text-gray-500",$="bg-gray-700",J="Attempting to connect and load data...";return o==="supabase"?(M=T_,D="Online",j="text-green-400",$="bg-green-900",J="Connected to Supabase"):o==="local"?(M=E_,D="Offline",j="text-yellow-400",$="bg-yellow-900",J="Using Local Storage (Supabase connection unavailable)"):o==="error"&&(M=ua,D="Error",j="text-red-400",$="bg-red-900",J=`Error: ${a||"Unknown error"}`),x.jsxs("div",{title:J,className:`fixed bottom-4 left-4 px-3 py-1.5 rounded-full text-xs font-medium flex items-center shadow-lg ${$} ${j} z-40`,children:[x.jsx(M,{className:`w-3.5 h-3.5 mr-1.5 ${o==="loading"?"animate-spin":""}`}),D]})};return x.jsx("div",{className:n,children:x.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 transition-colors relative pb-16",children:[" ",x.jsx(A_,{theme:n,onThemeChange:C}),Ax()," ",Mx()," ",x.jsxs("div",{className:"container mx-auto py-8 px-4",children:[x.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-end mb-8 gap-4",children:x.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[x.jsx("button",{onClick:Ox,disabled:o==="loading"||o==="error",className:"px-3 py-2 sm:px-4 sm:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed",children:"New Doc"}),x.jsxs("button",{onClick:()=>i(!0),disabled:o==="loading"||o==="error",className:"px-3 py-2 sm:px-4 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed",children:[x.jsx(dw,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"}),"Save/Open"]}),x.jsxs("button",{onClick:()=>r(!0),disabled:o==="loading"||o==="error",className:"flex items-center px-3 py-2 sm:px-4 sm:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm sm:text-base disabled:opacity-50 disabled:cursor-not-allowed",children:[x.jsx(uw,{className:"w-4 h-4 sm:w-5 sm:h-5 mr-1 sm:mr-2"}),"View Full"]})]})}),o==="supabase"||o==="local"?x.jsx(M_,{rows:c,onAddRow:ye,onDeleteRow:Le,onUpdateTitle:hs,onUpdateInput:ps,onUpdatePrompt:Ii,onUpdateOutput:ms,onToggleExpand:V,onToggleInputExpand:q,onUpdateSectionInput:ce,onAddSectionInput:we,onRemoveSectionInput:gs,onGenerateText:bn,onImportDocument:Ri,isGeneratingDisabled:!v}):x.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400"})]}),(o==="supabase"||o==="local")&&x.jsxs(x.Fragment,{children:[x.jsx(iN,{isOpen:t,onClose:()=>r(!1),rows:c,onUpdateRow:ms,onUpdateAllRows:I}),x.jsx(oN,{isOpen:s,onClose:()=>i(!1),onSave:_n,onOpen:ys,onDelete:Tx,savedDocuments:f,currentDocument:f.find(M=>M.id===p)})]})]})})}aw(document.getElementById("root")).render(x.jsx(z.StrictMode,{children:x.jsx(CR,{})}));export{Ky as g};
